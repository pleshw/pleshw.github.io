var MovableElement;(()=>{"use strict";var t={7930:(t,e,o)=>{o.d(e,{ObjectEventListener:()=>n});class n{eventsByName=new Map;addEventListener(t,e){this.eventsByName.has(t.toLowerCase())?this.eventsByName.get(t.toLowerCase()).push(e):this.eventsByName.set(t.toLowerCase(),[e])}getEventsByName(t){return this.eventsByName.has(t.toLowerCase())||this.eventsByName.set(t.toLowerCase(),[]),this.eventsByName.get(t.toLowerCase())}callEventsByName(t,...e){this.getEventsByName(t).forEach((t=>t(...e)))}}},1319:(t,e,o)=>{o.d(e,{getDistanceFromBorder:()=>v,getTransformCoordsFromElement:()=>u,regexRemoveTranslateFromTransform:()=>s});var n=o(739);const s=/translate\([^)]*\)/g,r=/rotate\((-?\d+\.?\d*)deg\)/,a=/rotateX\((-?\d+\.?\d*)deg\)/,i=/rotateY\((-?\d+\.?\d*)deg\)/,h=/rotateZ\((-?\d+\.?\d*)deg\)/,m=new Map,l=new Map,d=new Map;function c(t){const e=t.getBoundingClientRect(),o=e.left+e.width/2,n=e.top+e.height/2,s=function(){const t=function(t){switch(t){case"x":return a;case"y":return i;case"z":return h;default:return r}}(g(document.body)).exec(document.body.style.transform);return t?parseFloat(t[1]):0}(),m=Math.PI/180*s,l=Math.cos(m),d=Math.sin(m),c=o+(e.left-o)*l-(e.top-n)*d,v=n+(e.left-o)*d+(e.top-n)*l,u=o+(e.right-o)*l-(e.bottom-n)*d,f=n+(e.right-o)*d+(e.bottom-n)*l,y=Math.min(c,u),p=Math.min(v,f),x=Math.max(v,f),M=Math.max(c,u);return{x:y,y:p,width:e.width,height:e.height,toJSON:e.toJSON,left:y,top:p,bottom:x,right:M}}function v(t,e,o=!1){const n=o?c(t):t.getBoundingClientRect(),s=o?c(e):e.getBoundingClientRect(),r=n.left+n.width/2,a=n.top+n.height/2;return{top:a-s.top,right:s.right-r,bottom:s.bottom-a,left:r-s.left}}function g(t){const e=t.style.transform.toLowerCase();return e.includes("x")?"x":e.includes("y")?"y":"z"}function u(t,e=!1){const o=(window.getComputedStyle(t).transform.match(n.regexNumberPattern)??[0,0]).map((t=>+t));let s={x:void 0!==o[4]?Math.round(o[4]):0,y:void 0!==o[5]?Math.round(o[5]):0};if(e){const e=function(t,e="x"){let o;switch(e){case"x":o=a;break;case"y":o=i;break;case"z":o=h;break;default:o=r}const n=o.exec(t.style.transform);return n?parseFloat(n[1]):0}(document.body,g(t))||0;return(0,n.rotateCoordinates)(s.x,s.y,e)}return s}new Map,window.addEventListener("keydown",(t=>{t.repeat||function(t){for(const e of m)t.code===e[0]&&e[1].forEach((e=>e(t)))}(t),function(t){for(const e of l)t.code===e[0]&&e[1].forEach((e=>e(t)))}(t)})),window.addEventListener("keyup",(t=>{for(const e of d)t.code===e[0]&&e[1].forEach((e=>e(t)))}))},739:(t,e,o)=>{o.d(e,{regexNumberPattern:()=>n,rotateCoordinates:()=>s});const n=/-?\d+\.?\d*/g;function s(t,e,o){const n=Math.PI/180*o;return{x:t*Math.cos(n)-e*Math.sin(n),y:t*Math.sin(n)+e*Math.cos(n)}}}},e={};function o(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,o),r.exports}o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{o.r(n),o.d(n,{MovableElement:()=>s});var t=o(7930),e=o(1319);class s extends t.ObjectEventListener{element;movingState;intervalUpdatePosition;onBeforeMove;onAfterMove;constructor(t){if(super(),!t.element)throw new Error("Null movable element. Please pass a valid element in constructor.");this.element=t.element,this.onBeforeMove=t.onBeforeMove,this.onAfterMove=t.onAfterMove,this.movingState={pos:{x:0,y:0},delta:{dx:0,dy:0}},this.intervalUpdatePosition=setInterval(this.updatePosition.bind(this),200)}get position(){return this.movingState.pos}set position(t){this.moveToPosition(t.x,t.y)}get x(){return this.movingState.pos.x}set x(t){this.moveToPosition(t,this.y)}get y(){return this.movingState.pos.y}set y(t){this.moveToPosition(this.x,t)}setTranslate(t,e){this.callEventsByName("onBeforeMove",this.element,this),this.onBeforeMove&&this.onBeforeMove(this.element,this),this.resetTranslate(),this.element.style.transform+=`translate(${t}px, ${e}px)`,this.callEventsByName("onAfterMove",this.element,this),this.onAfterMove&&this.onAfterMove(this.element,this)}setTranslateByPoint2D(t){this.setTranslate(t.x,t.y)}updatePosition(){this.movingState.pos=(0,e.getTransformCoordsFromElement)(this.element),this.movingState.delta.dx=0,this.movingState.delta.dy=0}resetTranslate(){this.element.style.transform=this.element.style.transform.replace(e.regexRemoveTranslateFromTransform,"")}moveToPosition(t,e){this.movingState.pos={x:t+this.movingState.delta.dx,y:e+this.movingState.delta.dy},this.setTranslateByPoint2D(this.movingState.pos)}moveToPoint2D(t){this.movingState.pos={x:t.x+this.movingState.delta.dx,y:t.y+this.movingState.delta.dy},this.setTranslateByPoint2D(this.movingState.pos)}moveToTargetElement(t){const o=t.getBoundingClientRect(),n=(0,e.getTransformCoordsFromElement)(this.element),s=(0,e.getDistanceFromBorder)(this.element,t),r=n.x+s.right,a=n.y+s.bottom;this.setTranslateByPoint2D({x:Math.round(r-o.width),y:Math.round(a-o.height)})}moveToCenterOfTargetElement(t){const o=t.getBoundingClientRect(),n=(0,e.getTransformCoordsFromElement)(this.element),s=(0,e.getDistanceFromBorder)(this.element,t),r=n.x+s.right,a=n.y+s.bottom;this.setTranslateByPoint2D({x:Math.round(r-o.width/2),y:Math.round(a-o.height/2)})}static makeElementMovable(t){return new s({element:t})}}})(),MovableElement=n})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cyIsIndlYnBhY2s6Ly8vLi9zcmMvVG9vbHMvRE9NVG9vbHMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL1Rvb2xzL01hdGhUb29scy50cyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly8vd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly8vd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly8vLi9zcmMvRXh0cmFzL01vdmFibGVFbGVtZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIlxyXG5leHBvcnQgY2xhc3MgT2JqZWN0RXZlbnRMaXN0ZW5lciB7XHJcbiAgcHVibGljIGV2ZW50c0J5TmFtZTogTWFwPHN0cmluZywgRnVuY3Rpb25bXT4gPSBuZXcgTWFwKCk7XHJcblxyXG4gIHB1YmxpYyBhZGRFdmVudExpc3RlbmVyKCBldmVudE5hbWU6IHN0cmluZywgZXZlbnQ6IEZ1bmN0aW9uICkge1xyXG4gICAgaWYgKCAhdGhpcy5ldmVudHNCeU5hbWUuaGFzKCBldmVudE5hbWUudG9Mb3dlckNhc2UoKSApICkge1xyXG4gICAgICB0aGlzLmV2ZW50c0J5TmFtZS5zZXQoIGV2ZW50TmFtZS50b0xvd2VyQ2FzZSgpLCBbZXZlbnRdICk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmV2ZW50c0J5TmFtZS5nZXQoIGV2ZW50TmFtZS50b0xvd2VyQ2FzZSgpICkhLnB1c2goIGV2ZW50ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0RXZlbnRzQnlOYW1lKCBldmVudE5hbWU6IHN0cmluZyApOiBGdW5jdGlvbltdIHtcclxuICAgIGlmICggIXRoaXMuZXZlbnRzQnlOYW1lLmhhcyggZXZlbnROYW1lLnRvTG93ZXJDYXNlKCkgKSApIHtcclxuICAgICAgdGhpcy5ldmVudHNCeU5hbWUuc2V0KCBldmVudE5hbWUudG9Mb3dlckNhc2UoKSwgW10gKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5ldmVudHNCeU5hbWUuZ2V0KCBldmVudE5hbWUudG9Mb3dlckNhc2UoKSApITtcclxuICB9XHJcblxyXG5cclxuICBwdWJsaWMgY2FsbEV2ZW50c0J5TmFtZSggZXZlbnROYW1lOiBzdHJpbmcsIC4uLmV2ZW50QXJnczogYW55W10gKTogdm9pZCB7XHJcbiAgICB0aGlzLmdldEV2ZW50c0J5TmFtZSggZXZlbnROYW1lICkuZm9yRWFjaCggZSA9PiBlKCAuLi5ldmVudEFyZ3MgKSApO1xyXG4gIH1cclxufSIsImltcG9ydCB7IERpbWVuc2lvbnMsIFBvaW50MkQsIGxlcnAsIHJlZ2V4TnVtYmVyUGF0dGVybiwgcm90YXRlQ29vcmRpbmF0ZXMsIHJvdGF0ZUNvb3JkaW5hdGVzRnJvbVBvaW50MkQgfSBmcm9tICcuL01hdGhUb29scyc7XHJcbmltcG9ydCB7IHRvUGhvbmVOdW1iZXIgfSBmcm9tICcuL1N0cmluZ1Rvb2xzJztcclxuaW1wb3J0IHsgQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2ssIEJvcmRlckRpc3RhbmNlIH0gZnJvbSAnLi4vRXh0cmFzL0NvbGxpc2lvbkV2ZW50cy9UeXBlcyc7XHJcblxyXG5leHBvcnQgdHlwZSBLZXlib2FyZEV2ZW50Q2FsbGJhY2sgPSAoIGV2dDogS2V5Ym9hcmRFdmVudCApID0+IHZvaWQ7XHJcbmV4cG9ydCBjb25zdCByZWdleFJlbW92ZVRyYW5zbGF0ZUZyb21UcmFuc2Zvcm0gPSAvdHJhbnNsYXRlXFwoW14pXSpcXCkvZztcclxuZXhwb3J0IGNvbnN0IHJlZ2V4R3JvdXBSb3RhdGVWYWx1ZSA9IC9yb3RhdGVcXCgoLT9cXGQrXFwuP1xcZCopZGVnXFwpLztcclxuZXhwb3J0IGNvbnN0IHJlZ2V4R3JvdXBSb3RhdGVYVmFsdWUgPSAvcm90YXRlWFxcKCgtP1xcZCtcXC4/XFxkKilkZWdcXCkvO1xyXG5leHBvcnQgY29uc3QgcmVnZXhHcm91cFJvdGF0ZVlWYWx1ZSA9IC9yb3RhdGVZXFwoKC0/XFxkK1xcLj9cXGQqKWRlZ1xcKS87XHJcbmV4cG9ydCBjb25zdCByZWdleEdyb3VwUm90YXRlWlZhbHVlID0gL3JvdGF0ZVpcXCgoLT9cXGQrXFwuP1xcZCopZGVnXFwpLztcclxuXHJcbmV4cG9ydCBjb25zdCBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93bk9uY2UgPSBuZXcgTWFwPHN0cmluZywgS2V5Ym9hcmRFdmVudENhbGxiYWNrW10+KCk7XHJcbmV4cG9ydCBjb25zdCBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93blJlcGVhdCA9IG5ldyBNYXA8c3RyaW5nLCBLZXlib2FyZEV2ZW50Q2FsbGJhY2tbXT4oKTtcclxuZXhwb3J0IGNvbnN0IGRpY3RLZXlzQnlBY3Rpb25LZXl1cCA9IG5ldyBNYXA8c3RyaW5nLCBLZXlib2FyZEV2ZW50Q2FsbGJhY2tbXT4oKTtcclxuZXhwb3J0IGZ1bmN0aW9uIGFkZEFjdGlvbktleSggeyBrZXksIGtleWRvd246IGV2ZW50S2V5ZG93biwga2V5dXA6IGV2ZW50S2V5dXAsIGV4ZWN1dGVPbmx5T25jZSA9IHRydWUgfTogeyBrZXk6IHN0cmluZzsga2V5ZG93bjogS2V5Ym9hcmRFdmVudENhbGxiYWNrOyBrZXl1cD86IEtleWJvYXJkRXZlbnRDYWxsYmFjazsgZXhlY3V0ZU9ubHlPbmNlPzogYm9vbGVhbjsgfSApIHtcclxuICBpZiAoIGV4ZWN1dGVPbmx5T25jZSApIHtcclxuICAgIGFkZEFjdGlvbktleVJ1bk9uY2UoIGtleSwgZXZlbnRLZXlkb3duLCBldmVudEtleXVwICk7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICBhZGRBY3Rpb25LZXlSdW5PblJlcGVhdCgga2V5LCBldmVudEtleWRvd24sIGV2ZW50S2V5dXAgKTtcclxufVxyXG5cclxuZXhwb3J0IHR5cGUgU2FmZVByb21pc2U8VD4gPSB7XHJcbiAgZGF0YTogKCkgPT4gVDtcclxuICBlcnJvcjogRXJyb3IgfCBudWxsO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlUHJvbWlzZTxUPiggcHJvbWlzZTogUHJvbWlzZTxUPiApOiBQcm9taXNlPFNhZmVQcm9taXNlPFQ+PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBwcm9taXNlO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGRhdGE6ICgpID0+IGRhdGEsXHJcbiAgICAgIGVycm9yOiBudWxsXHJcbiAgICB9O1xyXG4gIH0gY2F0Y2ggKCBlcnJvciApIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoIGVycm9yICk7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZGF0YTogKCkgPT4geyB0aHJvdyBuZXcgRXJyb3IoIFwiQ291bGRuJ3QgZmV0Y2gsIGNoZWNrIFNhZmVQcm9taXNlLmVycm9yIGZvciBkZXRhaWxzLlwiICk7IH0sXHJcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IgOiBuZXcgRXJyb3IoIFN0cmluZyggZXJyb3IgKSApXHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEVsZW1lbnRGcm9tSFRNTCggaHRtbDogc3RyaW5nLCB0cmltOiBib29sZWFuID0gdHJ1ZSApIHtcclxuICBodG1sID0gdHJpbSA/IGh0bWwudHJpbSgpIDogaHRtbDtcclxuXHJcbiAgaWYgKCAhaHRtbCApIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAndGVtcGxhdGUnICk7XHJcbiAgdGVtcGxhdGUuaW5uZXJIVE1MID0gaHRtbDtcclxuICBjb25zdCByZXN1bHQgPSB0ZW1wbGF0ZS5jb250ZW50LmNoaWxkcmVuO1xyXG5cclxuICBpZiAoIHJlc3VsdC5sZW5ndGggPT09IDEgKSB7XHJcbiAgICByZXR1cm4gcmVzdWx0WzBdIGFzIEhUTUxFbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIEFycmF5LmZyb20oIHJlc3VsdCApIGFzIEhUTUxFbGVtZW50W107XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50RGltZW5zaW9uc0J5SWQoIGVsZW1lbnRJZDogc3RyaW5nICk6IERpbWVuc2lvbnMge1xyXG4gIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggZWxlbWVudElkICk7XHJcblxyXG4gIGlmICggIWVsZW1lbnQgKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoIFwiSW52YWxpZCBlbGVtZW50IGF0IGdldEVsZW1lbnREaW1lbnNpb25zQnlJZCB3aXRoIGlkOiBcIiArIGVsZW1lbnRJZCApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGdldEVsZW1lbnREaW1lbnNpb25zKCBlbGVtZW50ICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50RGltZW5zaW9ucyggZWxlbWVudDogSFRNTEVsZW1lbnQgKTogRGltZW5zaW9ucyB7XHJcbiAgdmFyIHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgd2lkdGg6IHJlY3Qud2lkdGgsXHJcbiAgICBoZWlnaHQ6IHJlY3QuaGVpZ2h0XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Um90YXRlZEJvdW5kaW5nQm94QmFzZWRPbkJvZHlSb3RhdGlvbiggZWxlbWVudDogSFRNTEVsZW1lbnQgKTogRE9NUmVjdCB7XHJcbiAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgY29uc3QgY2VudGVyWCA9IHJlY3QubGVmdCArIHJlY3Qud2lkdGggLyAyO1xyXG4gIGNvbnN0IGNlbnRlclkgPSByZWN0LnRvcCArIHJlY3QuaGVpZ2h0IC8gMjtcclxuXHJcbiAgLy8gUm90YXRpb24gYW5nbGUgaW4gZGVncmVlcyAoZXh0cmFjdGVkIGZyb20gc3R5bGUudHJhbnNmb3JtIG9yIGFueSBvdGhlciBzb3VyY2UpXHJcbiAgY29uc3Qgcm90YXRpb25BbmdsZSA9IGdldEJvZHlSb3RhdGlvbkluRGVncmVlcygpO1xyXG5cclxuICBjb25zdCByYWRpYW5zID0gKCBNYXRoLlBJIC8gMTgwICkgKiByb3RhdGlvbkFuZ2xlO1xyXG4gIGNvbnN0IGNvc1RoZXRhID0gTWF0aC5jb3MoIHJhZGlhbnMgKTtcclxuICBjb25zdCBzaW5UaGV0YSA9IE1hdGguc2luKCByYWRpYW5zICk7XHJcblxyXG4gIC8vIENhbGN1bGF0ZSB0aGUgcm90YXRlZCBjb29yZGluYXRlc1xyXG4gIGNvbnN0IHJvdGF0ZWRYMSA9IGNlbnRlclggKyAoIHJlY3QubGVmdCAtIGNlbnRlclggKSAqIGNvc1RoZXRhIC0gKCByZWN0LnRvcCAtIGNlbnRlclkgKSAqIHNpblRoZXRhO1xyXG4gIGNvbnN0IHJvdGF0ZWRZMSA9IGNlbnRlclkgKyAoIHJlY3QubGVmdCAtIGNlbnRlclggKSAqIHNpblRoZXRhICsgKCByZWN0LnRvcCAtIGNlbnRlclkgKSAqIGNvc1RoZXRhO1xyXG5cclxuICBjb25zdCByb3RhdGVkWDIgPSBjZW50ZXJYICsgKCByZWN0LnJpZ2h0IC0gY2VudGVyWCApICogY29zVGhldGEgLSAoIHJlY3QuYm90dG9tIC0gY2VudGVyWSApICogc2luVGhldGE7XHJcbiAgY29uc3Qgcm90YXRlZFkyID0gY2VudGVyWSArICggcmVjdC5yaWdodCAtIGNlbnRlclggKSAqIHNpblRoZXRhICsgKCByZWN0LmJvdHRvbSAtIGNlbnRlclkgKSAqIGNvc1RoZXRhO1xyXG5cclxuICAvLyBDYWxjdWxhdGUgbGVmdCwgdG9wLCBib3R0b20sIGFuZCByaWdodCBjb29yZGluYXRlc1xyXG4gIGNvbnN0IHJvdGF0ZWRMZWZ0ID0gTWF0aC5taW4oIHJvdGF0ZWRYMSwgcm90YXRlZFgyICk7XHJcbiAgY29uc3Qgcm90YXRlZFRvcCA9IE1hdGgubWluKCByb3RhdGVkWTEsIHJvdGF0ZWRZMiApO1xyXG4gIGNvbnN0IHJvdGF0ZWRCb3R0b20gPSBNYXRoLm1heCggcm90YXRlZFkxLCByb3RhdGVkWTIgKTtcclxuICBjb25zdCByb3RhdGVkUmlnaHQgPSBNYXRoLm1heCggcm90YXRlZFgxLCByb3RhdGVkWDIgKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHg6IHJvdGF0ZWRMZWZ0LFxyXG4gICAgeTogcm90YXRlZFRvcCxcclxuICAgIHdpZHRoOiByZWN0LndpZHRoLFxyXG4gICAgaGVpZ2h0OiByZWN0LmhlaWdodCxcclxuICAgIHRvSlNPTjogcmVjdC50b0pTT04sXHJcbiAgICBsZWZ0OiByb3RhdGVkTGVmdCxcclxuICAgIHRvcDogcm90YXRlZFRvcCxcclxuICAgIGJvdHRvbTogcm90YXRlZEJvdHRvbSxcclxuICAgIHJpZ2h0OiByb3RhdGVkUmlnaHQsXHJcbiAgfSBhcyBET01SZWN0O1xyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRBY3Rpb25LZXlSdW5PbmNlKCBrZXk6IHN0cmluZywgZXZlbnRLZXlkb3duOiBLZXlib2FyZEV2ZW50Q2FsbGJhY2ssIGV2ZW50S2V5dXA/OiBLZXlib2FyZEV2ZW50Q2FsbGJhY2sgKSB7XHJcbiAgaWYgKCBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93bk9uY2UuaGFzKCBrZXkgKSApIHtcclxuICAgIGRpY3RLZXlzQnlBY3Rpb25LZXlkb3duT25jZS5zZXQoIGtleSwgW2V2ZW50S2V5ZG93biwgLi4uZGljdEtleXNCeUFjdGlvbktleWRvd25PbmNlLmdldCgga2V5ICkhXSApXHJcbiAgfSBlbHNlIHtcclxuICAgIGRpY3RLZXlzQnlBY3Rpb25LZXlkb3duT25jZS5zZXQoIGtleSwgW2V2ZW50S2V5ZG93bl0gKVxyXG4gIH1cclxuXHJcbiAgaWYgKCBldmVudEtleXVwICkge1xyXG4gICAgaWYgKCBkaWN0S2V5c0J5QWN0aW9uS2V5dXAuaGFzKCBrZXkgKSApIHtcclxuICAgICAgZGljdEtleXNCeUFjdGlvbktleXVwLnNldCgga2V5LCBbZXZlbnRLZXl1cCwgLi4uZGljdEtleXNCeUFjdGlvbktleXVwLmdldCgga2V5ICkhXSApXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBkaWN0S2V5c0J5QWN0aW9uS2V5dXAuc2V0KCBrZXksIFtldmVudEtleXVwXSApXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBhZGRBY3Rpb25LZXlSdW5PblJlcGVhdCgga2V5OiBzdHJpbmcsIGV2ZW50S2V5ZG93bjogS2V5Ym9hcmRFdmVudENhbGxiYWNrLCBldmVudEtleXVwPzogS2V5Ym9hcmRFdmVudENhbGxiYWNrICkge1xyXG4gIGlmICggZGljdEtleXNCeUFjdGlvbktleWRvd25SZXBlYXQuaGFzKCBrZXkgKSApIHtcclxuICAgIGRpY3RLZXlzQnlBY3Rpb25LZXlkb3duUmVwZWF0LnNldCgga2V5LCBbZXZlbnRLZXlkb3duLCAuLi5kaWN0S2V5c0J5QWN0aW9uS2V5ZG93blJlcGVhdC5nZXQoIGtleSApIV0gKVxyXG4gIH0gZWxzZSB7XHJcbiAgICBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93blJlcGVhdC5zZXQoIGtleSwgW2V2ZW50S2V5ZG93bl0gKVxyXG4gIH1cclxuXHJcbiAgaWYgKCBldmVudEtleXVwICkge1xyXG4gICAgaWYgKCBkaWN0S2V5c0J5QWN0aW9uS2V5dXAuaGFzKCBrZXkgKSApIHtcclxuICAgICAgZGljdEtleXNCeUFjdGlvbktleXVwLnNldCgga2V5LCBbZXZlbnRLZXl1cCwgLi4uZGljdEtleXNCeUFjdGlvbktleXVwLmdldCgga2V5ICkhXSApXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBkaWN0S2V5c0J5QWN0aW9uS2V5dXAuc2V0KCBrZXksIFtldmVudEtleXVwXSApXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tFbGVtZW50Q29sbGlzaW9uKCBlbGVtZW50MTogSFRNTEVsZW1lbnQsIGVsZW1lbnQyOiBIVE1MRWxlbWVudCwgY2hlY2tCb2R5Um90YXRpb246IGJvb2xlYW4gPSBmYWxzZSApOiBib29sZWFuIHtcclxuICBjb25zdCByZWN0MSA9ICFjaGVja0JvZHlSb3RhdGlvbiA/IGVsZW1lbnQxLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpIDogZ2V0Um90YXRlZEJvdW5kaW5nQm94QmFzZWRPbkJvZHlSb3RhdGlvbiggZWxlbWVudDEgKTtcclxuICBjb25zdCByZWN0MiA9ICFjaGVja0JvZHlSb3RhdGlvbiA/IGVsZW1lbnQyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpIDogZ2V0Um90YXRlZEJvdW5kaW5nQm94QmFzZWRPbkJvZHlSb3RhdGlvbiggZWxlbWVudDIgKTtcclxuXHJcbiAgY29uc3QgcmVzdWx0ID0gIShcclxuICAgIHJlY3QxLnRvcCA+IHJlY3QyLmJvdHRvbSB8fFxyXG4gICAgcmVjdDEucmlnaHQgPCByZWN0Mi5sZWZ0IHx8XHJcbiAgICByZWN0MS5ib3R0b20gPCByZWN0Mi50b3AgfHxcclxuICAgIHJlY3QxLmxlZnQgPiByZWN0Mi5yaWdodFxyXG4gICk7XHJcblxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwb2xsRm9yVmFyaWFibGU8VD4oIHZhcmlhYmxlTmFtZTogc3RyaW5nLCByZWFkeUNvbmRpdGlvbjogKCB2YWx1ZTogVCApID0+IGJvb2xlYW4sIGNhbGxiYWNrOiAoIHZhbHVlOiBUICkgPT4gdm9pZCApIHtcclxuICBjb25zdCBwb2xsSW50ZXJ2YWwgPSAxMDA7XHJcbiAgY29uc3QgcG9sbCA9IHNldEludGVydmFsKCAoKSA9PiB7XHJcbiAgICBpZiAoICggd2luZG93IGFzIGFueSApW3ZhcmlhYmxlTmFtZV0gIT09IHVuZGVmaW5lZCAmJiByZWFkeUNvbmRpdGlvbiggKCB3aW5kb3cgYXMgYW55IClbdmFyaWFibGVOYW1lXSApICkge1xyXG4gICAgICAvLyBJZiBib3RoIGNvbmRpdGlvbnMgYXJlIG1ldCwgZXhlY3V0ZSB0aGUgY2FsbGJhY2sgYW5kIHN0b3AgcG9sbGluZ1xyXG4gICAgICBjbGVhckludGVydmFsKCBwb2xsICk7XHJcbiAgICAgIGNhbGxiYWNrKCAoIHdpbmRvdyBhcyBhbnkgKVt2YXJpYWJsZU5hbWVdICk7XHJcbiAgICB9XHJcbiAgfSwgcG9sbEludGVydmFsICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB3YWl0VW50aWxFbGVtZW50RXhpc3RzKCBzZWxlY3Rvcjogc3RyaW5nICkge1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZSggcmVzb2x2ZSA9PiB7XHJcbiAgICBpZiAoIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIHNlbGVjdG9yICkgKSB7XHJcbiAgICAgIHJldHVybiByZXNvbHZlKCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBzZWxlY3RvciApICk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlciggbXV0YXRpb25zID0+IHtcclxuICAgICAgaWYgKCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBzZWxlY3RvciApICkge1xyXG4gICAgICAgIG9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICByZXNvbHZlKCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBzZWxlY3RvciApICk7XHJcbiAgICAgIH1cclxuICAgIH0gKTtcclxuXHJcbiAgICBvYnNlcnZlci5vYnNlcnZlKCBkb2N1bWVudC5ib2R5LCB7XHJcbiAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcclxuICAgICAgc3VidHJlZTogdHJ1ZVxyXG4gICAgfSApO1xyXG4gIH0gKTtcclxufVxyXG5cclxuLy8vIEdldCB0aGUgZGVmYXVsdCBhdHRyaWJ1dGVzIGZyb20gdGhlIHRhcmdldCBlbGVtZW50XHJcbi8vLyBJZiBoYXZlIG5vdCBkZWZhdWx0IGF0dHJpYnV0ZSB3aXRoIHRoaXMgQGF0dHJpYnV0ZU5hbWUgb24gbWFwIHdpbGwgc2V0IHRoZSBjdXJyZW50IGF0dHJpYnV0ZSBhcyBkZWZhdWx0XHJcbi8vLyBJZiBoYXZlIG5vdCBkZWZhdWx0IGF0dHJpYnV0ZSB3aXRoIHRoaXMgQGF0dHJpYnV0ZU5hbWUgd2lsbCByZXR1cm4gYW4gZW1wdHkgc3RyaW5nXHJcbmV4cG9ydCBjb25zdCBtYXBEZWZhdWx0QXR0cmlidXRlc0J5RWxlbWVudCA9IG5ldyBNYXA8SFRNTEVsZW1lbnQsIE1hcDxzdHJpbmcsIHN0cmluZz4+KCk7XHJcbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0QXR0cmlidXRlRm9yVGFyZ2V0KCB0YXJnZXQ6IEhUTUxFbGVtZW50LCBhdHRyaWJ1dGVOYW1lOiBzdHJpbmcgKTogc3RyaW5nIHtcclxuICBpZiAoICFtYXBEZWZhdWx0QXR0cmlidXRlc0J5RWxlbWVudC5oYXMoIHRhcmdldCApICkge1xyXG4gICAgbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuc2V0KCB0YXJnZXQsIG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCkgKTtcclxuICB9XHJcblxyXG4gIGxldCByZXN1bHQ6IHN0cmluZyA9ICcnO1xyXG4gIGNvbnN0IGRlZmF1bHRBdHRyaWJ1dGVWYWx1ZXNCeU5hbWUgPSBtYXBEZWZhdWx0QXR0cmlidXRlc0J5RWxlbWVudC5nZXQoIHRhcmdldCApITtcclxuICBjb25zdCB0YXJnZXREZWZhdWx0QXR0cmlidXRlID0gIWRlZmF1bHRBdHRyaWJ1dGVWYWx1ZXNCeU5hbWUuaGFzKCBhdHRyaWJ1dGVOYW1lICkgPyB0YXJnZXQuZ2V0QXR0cmlidXRlKCBhdHRyaWJ1dGVOYW1lICkgOiBkZWZhdWx0QXR0cmlidXRlVmFsdWVzQnlOYW1lLmdldCggYXR0cmlidXRlTmFtZSApITtcclxuXHJcbiAgcmVzdWx0ID0gdGFyZ2V0RGVmYXVsdEF0dHJpYnV0ZSA/IHRhcmdldERlZmF1bHRBdHRyaWJ1dGUgOiAnJztcclxuICBzZXREZWZhdWx0QXR0cmlidXRlRm9yVGFyZ2V0KCB0YXJnZXQsIGF0dHJpYnV0ZU5hbWUsIHJlc3VsdCApO1xyXG5cclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2V0RGVmYXVsdEF0dHJpYnV0ZUZvclRhcmdldCggdGFyZ2V0OiBIVE1MRWxlbWVudCwgYXR0cmlidXRlTmFtZTogc3RyaW5nLCBuZXdEZWZhdWx0QXR0cmlidXRlOiBzdHJpbmcgKTogdm9pZCB7XHJcbiAgaWYgKCAhbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuaGFzKCB0YXJnZXQgKSApIHtcclxuICAgIG1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50LnNldCggdGFyZ2V0LCBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpICk7XHJcbiAgfVxyXG5cclxuICBtYXBEZWZhdWx0QXR0cmlidXRlc0J5RWxlbWVudC5nZXQoIHRhcmdldCApIS5zZXQoIGF0dHJpYnV0ZU5hbWUsIG5ld0RlZmF1bHRBdHRyaWJ1dGUgKTtcclxufVxyXG5cclxuLy8vIERpdmlkZSBvIGVsZW1lbnRvIEB0YXJnZXQgZW0gOSBcInF1YWRyYWRvc1wiIGlndWFpcyBlIHJldG9ybmEgZW0gcXVhaXMgcXVhZHJhZG9zIG8gZHJhZ2dhYmxlIGVzdMOhIGNvbGlkaW5kbyBjb20gbyB0YXJnZXRcclxuZXhwb3J0IGZ1bmN0aW9uIGdldENvbGxpc2lvbkRpcmVjdGlvbiggZHJhZ2dhYmxlOiBIVE1MRWxlbWVudCwgdGFyZ2V0OiBIVE1MRWxlbWVudCwgY2hlY2tCb2R5Um90YXRpb246IGJvb2xlYW4gPSBmYWxzZSApOiBDb2xsaXNpb25EaXJlY3Rpb25DaGVjayB7XHJcbiAgY29uc3QgcmVjdDEgPSAhY2hlY2tCb2R5Um90YXRpb24gPyBkcmFnZ2FibGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiBnZXRSb3RhdGVkQm91bmRpbmdCb3hCYXNlZE9uQm9keVJvdGF0aW9uKCBkcmFnZ2FibGUgKTtcclxuICBjb25zdCByZWN0MiA9ICFjaGVja0JvZHlSb3RhdGlvbiA/IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IGdldFJvdGF0ZWRCb3VuZGluZ0JveEJhc2VkT25Cb2R5Um90YXRpb24oIHRhcmdldCApO1xyXG5cclxuICBjb25zdCBpc1RvcCA9IHJlY3QxLmJvdHRvbSA+IHJlY3QyLnRvcCAmJiByZWN0MS50b3AgPCByZWN0Mi50b3AgKyByZWN0Mi5oZWlnaHQgLyAzO1xyXG4gIGNvbnN0IGlzUmlnaHQgPSByZWN0MS5sZWZ0IDwgcmVjdDIucmlnaHQgJiYgcmVjdDEucmlnaHQgPiByZWN0Mi5yaWdodCAtIHJlY3QyLndpZHRoIC8gMztcclxuICBjb25zdCBpc0NlbnRlciA9IHJlY3QxLnRvcCA8IHJlY3QyLmJvdHRvbSAmJiByZWN0MS5ib3R0b20gPiByZWN0Mi50b3AgJiYgcmVjdDEubGVmdCA8IHJlY3QyLnJpZ2h0ICYmIHJlY3QxLnJpZ2h0ID4gcmVjdDIubGVmdDtcclxuICBjb25zdCBpc0JvdHRvbSA9IHJlY3QxLnRvcCA8IHJlY3QyLmJvdHRvbSAtIHJlY3QyLmhlaWdodCAvIDMgJiYgcmVjdDEuYm90dG9tID4gcmVjdDIuYm90dG9tIC0gcmVjdDIuaGVpZ2h0IC8gMztcclxuICBjb25zdCBpc0xlZnQgPSByZWN0MS5yaWdodCA+IHJlY3QyLmxlZnQgJiYgcmVjdDEubGVmdCA8IHJlY3QyLmxlZnQgKyByZWN0Mi53aWR0aCAvIDM7XHJcblxyXG4gIHJldHVybiB7IHRvcDogaXNUb3AsIHJpZ2h0OiBpc1JpZ2h0LCBjZW50ZXI6IGlzQ2VudGVyLCBib3R0b206IGlzQm90dG9tLCBsZWZ0OiBpc0xlZnQgfTtcclxufVxyXG5cclxuLy8vIHJldHVybiB0aGUgZGlzdGFuY2UgZnJvbSB0aGUgY2VudGVyIG9mIHRoZSBkcmFnZ2FibGUgdG8gdGhlIGNlbnRlciBvZiB0aGUgdGFyZ2V0IGVsZW1lbnQgZnJvbSBlYWNoIGJvcmRlciBcclxuZXhwb3J0IGZ1bmN0aW9uIGdldERpc3RhbmNlRnJvbUJvcmRlciggZHJhZ2dhYmxlOiBIVE1MRWxlbWVudCwgdGFyZ2V0OiBIVE1MRWxlbWVudCwgY2hlY2tCb2R5Um90YXRpb246IGJvb2xlYW4gPSBmYWxzZSApOiBCb3JkZXJEaXN0YW5jZSB7XHJcbiAgY29uc3QgcmVjdDEgPSAhY2hlY2tCb2R5Um90YXRpb24gPyBkcmFnZ2FibGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiBnZXRSb3RhdGVkQm91bmRpbmdCb3hCYXNlZE9uQm9keVJvdGF0aW9uKCBkcmFnZ2FibGUgKTtcclxuICBjb25zdCByZWN0MiA9ICFjaGVja0JvZHlSb3RhdGlvbiA/IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IGdldFJvdGF0ZWRCb3VuZGluZ0JveEJhc2VkT25Cb2R5Um90YXRpb24oIHRhcmdldCApO1xyXG5cclxuICBjb25zdCBjZW50ZXIgPSB7XHJcbiAgICB4OiByZWN0MS5sZWZ0ICsgcmVjdDEud2lkdGggLyAyLFxyXG4gICAgeTogcmVjdDEudG9wICsgcmVjdDEuaGVpZ2h0IC8gMixcclxuICB9O1xyXG5cclxuICBjb25zdCBkaXN0YW5jZUZyb21Cb3JkZXI6IEJvcmRlckRpc3RhbmNlID0ge1xyXG4gICAgdG9wOiBjZW50ZXIueSAtIHJlY3QyLnRvcCxcclxuICAgIHJpZ2h0OiByZWN0Mi5yaWdodCAtIGNlbnRlci54LFxyXG4gICAgYm90dG9tOiByZWN0Mi5ib3R0b20gLSBjZW50ZXIueSxcclxuICAgIGxlZnQ6IGNlbnRlci54IC0gcmVjdDIubGVmdCxcclxuICB9O1xyXG5cclxuICByZXR1cm4gZGlzdGFuY2VGcm9tQm9yZGVyO1xyXG59XHJcblxyXG5mdW5jdGlvbiBydW5Pbmx5T25jZUtleWRvd25BY3Rpb25zKCBldnQ6IEtleWJvYXJkRXZlbnQgKSB7XHJcbiAgZm9yICggY29uc3QgcGFpciBvZiBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93bk9uY2UgKSB7XHJcbiAgICBpZiAoIGV2dC5jb2RlID09PSBwYWlyWzBdICkge1xyXG4gICAgICBwYWlyWzFdLmZvckVhY2goIGtiRXZlbnQgPT4ga2JFdmVudCggZXZ0ICkgKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJ1bktleWRvd25BY3Rpb25zUmVwZWF0KCBldnQ6IEtleWJvYXJkRXZlbnQgKSB7XHJcbiAgZm9yICggY29uc3QgcGFpciBvZiBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93blJlcGVhdCApIHtcclxuICAgIGlmICggZXZ0LmNvZGUgPT09IHBhaXJbMF0gKSB7XHJcbiAgICAgIHBhaXJbMV0uZm9yRWFjaCgga2JFdmVudCA9PiBrYkV2ZW50KCBldnQgKSApO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICdrZXlkb3duJywgZXZ0ID0+IHtcclxuICBpZiAoICFldnQucmVwZWF0ICkge1xyXG4gICAgcnVuT25seU9uY2VLZXlkb3duQWN0aW9ucyggZXZ0ICk7XHJcbiAgfVxyXG5cclxuICBydW5LZXlkb3duQWN0aW9uc1JlcGVhdCggZXZ0ICk7XHJcbn0gKTtcclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAna2V5dXAnLCBldnQgPT4ge1xyXG4gIGZvciAoIGNvbnN0IHBhaXIgb2YgZGljdEtleXNCeUFjdGlvbktleXVwICkge1xyXG4gICAgaWYgKCBldnQuY29kZSA9PT0gcGFpclswXSApIHtcclxuICAgICAgcGFpclsxXS5mb3JFYWNoKCBrYkV2ZW50ID0+IGtiRXZlbnQoIGV2dCApICk7XHJcbiAgICB9XHJcbiAgfVxyXG59ICk7XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEVsZW1lbnRSb3RhdGlvbkluRGVncmVlcyggZWxlbWVudDogSFRNTEVsZW1lbnQsIGF4aXM6ICd4JyB8ICd5JyB8ICd6JyA9ICd4JyApOiBudW1iZXIge1xyXG4gIGxldCByZWdleE1hdGNoUm90YXRlVmFsdWU6IFJlZ0V4cDtcclxuICBzd2l0Y2ggKCBheGlzICkge1xyXG4gICAgY2FzZSAneCc6XHJcbiAgICAgIHJlZ2V4TWF0Y2hSb3RhdGVWYWx1ZSA9IHJlZ2V4R3JvdXBSb3RhdGVYVmFsdWU7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAneSc6XHJcbiAgICAgIHJlZ2V4TWF0Y2hSb3RhdGVWYWx1ZSA9IHJlZ2V4R3JvdXBSb3RhdGVZVmFsdWU7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAneic6XHJcbiAgICAgIHJlZ2V4TWF0Y2hSb3RhdGVWYWx1ZSA9IHJlZ2V4R3JvdXBSb3RhdGVaVmFsdWU7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgZGVmYXVsdDpcclxuICAgICAgcmVnZXhNYXRjaFJvdGF0ZVZhbHVlID0gcmVnZXhHcm91cFJvdGF0ZVZhbHVlO1xyXG4gICAgICBicmVhaztcclxuICB9XHJcblxyXG4gIGNvbnN0IG1hdGNoID0gcmVnZXhNYXRjaFJvdGF0ZVZhbHVlLmV4ZWMoIGVsZW1lbnQuc3R5bGUudHJhbnNmb3JtICk7XHJcbiAgaWYgKCBtYXRjaCApIHtcclxuICAgIGNvbnN0IHJvdGF0aW9uVmFsdWUgPSBwYXJzZUZsb2F0KCBtYXRjaFsxXSApO1xyXG4gICAgcmV0dXJuIHJvdGF0aW9uVmFsdWU7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEJvZHlSb3RhdGlvbkluRGVncmVlcygpOiBudW1iZXIge1xyXG4gIGNvbnN0IG1hdGNoID0gZ2V0UmVnZXhSZW1vdmVSb3RhdGlvbkZyb21Cb2R5KCkuZXhlYyggZG9jdW1lbnQuYm9keS5zdHlsZS50cmFuc2Zvcm0gKTtcclxuICBpZiAoIG1hdGNoICkge1xyXG4gICAgY29uc3Qgcm90YXRpb25WYWx1ZSA9IHBhcnNlRmxvYXQoIG1hdGNoWzFdICk7XHJcbiAgICByZXR1cm4gcm90YXRpb25WYWx1ZTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIDA7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVnZXhSZW1vdmVSb3RhdGlvbkZyb21Cb2R5KCkge1xyXG4gIHJldHVybiBnZXRSZWdleFJlbW92ZVJvdGF0aW9uQmFzZWRPbkF4aXMoIGdldEJvZHlSb3RhdGlvbkF4aXMoKSApXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRSZWdleFJlbW92ZVJvdGF0aW9uQmFzZWRPbkF4aXMoIGF4aXM6ICd4JyB8ICd5JyB8ICd6JyApIHtcclxuICBzd2l0Y2ggKCBheGlzICkge1xyXG4gICAgY2FzZSAneCc6XHJcbiAgICAgIHJldHVybiByZWdleEdyb3VwUm90YXRlWFZhbHVlO1xyXG4gICAgY2FzZSAneSc6XHJcbiAgICAgIHJldHVybiByZWdleEdyb3VwUm90YXRlWVZhbHVlO1xyXG4gICAgY2FzZSAneic6XHJcbiAgICAgIHJldHVybiByZWdleEdyb3VwUm90YXRlWlZhbHVlO1xyXG4gICAgZGVmYXVsdDpcclxuICAgICAgcmV0dXJuIHJlZ2V4R3JvdXBSb3RhdGVWYWx1ZTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRCb2R5Um90YXRpb25BeGlzKCk6ICd4JyB8ICd5JyB8ICd6JyB7XHJcbiAgcmV0dXJuIGdldEVsZW1lbnRSb3RhdGlvbkF4aXMoIGRvY3VtZW50LmJvZHkgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEVsZW1lbnRSb3RhdGlvbkF4aXMoIGVsZW1lbnQ6IEhUTUxFbGVtZW50ICk6ICd4JyB8ICd5JyB8ICd6JyB7XHJcbiAgY29uc3QgZWxlbWVudFRyYW5zZm9ybSA9IGVsZW1lbnQuc3R5bGUudHJhbnNmb3JtLnRvTG93ZXJDYXNlKCk7XHJcbiAgaWYgKCBlbGVtZW50VHJhbnNmb3JtLmluY2x1ZGVzKCAneCcgKSApIHtcclxuICAgIHJldHVybiAneCc7XHJcbiAgfSBlbHNlIGlmICggZWxlbWVudFRyYW5zZm9ybS5pbmNsdWRlcyggJ3knICkgKSB7XHJcbiAgICByZXR1cm4gJ3knO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gJ3onO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFRyYW5zZm9ybUNvb3Jkc0Zyb21FbGVtZW50KCBlbGVtZW50OiBIVE1MRWxlbWVudCwgY2hlY2tCb2R5Um90YXRpb246IGJvb2xlYW4gPSBmYWxzZSApOiBQb2ludDJEIHtcclxuICBjb25zdCBhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZSA9ICggd2luZG93LmdldENvbXB1dGVkU3R5bGUoIGVsZW1lbnQgKS50cmFuc2Zvcm0ubWF0Y2goIHJlZ2V4TnVtYmVyUGF0dGVybiApID8/IFswLCAwXSApLm1hcCggbiA9PiArbiApO1xyXG5cclxuICBsZXQgcmVzdWx0ID0ge1xyXG4gICAgeDogYXJyQ29tcHV0ZWREcmFnZ2FibGVUcmFuc2xhdGVbNF0gIT09IHVuZGVmaW5lZCA/IE1hdGgucm91bmQoIGFyckNvbXB1dGVkRHJhZ2dhYmxlVHJhbnNsYXRlWzRdICkgOiAwLFxyXG4gICAgeTogYXJyQ29tcHV0ZWREcmFnZ2FibGVUcmFuc2xhdGVbNV0gIT09IHVuZGVmaW5lZCA/IE1hdGgucm91bmQoIGFyckNvbXB1dGVkRHJhZ2dhYmxlVHJhbnNsYXRlWzVdICkgOiAwXHJcbiAgfVxyXG5cclxuICBpZiAoIGNoZWNrQm9keVJvdGF0aW9uICkge1xyXG4gICAgY29uc3QgYm9keUFuZ2xlID0gZ2V0RWxlbWVudFJvdGF0aW9uSW5EZWdyZWVzKCBkb2N1bWVudC5ib2R5LCBnZXRFbGVtZW50Um90YXRpb25BeGlzKCBlbGVtZW50ICkgKSB8fCAwO1xyXG4gICAgcmV0dXJuIHJvdGF0ZUNvb3JkaW5hdGVzKCByZXN1bHQueCwgcmVzdWx0LnksIGJvZHlBbmdsZSApO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNsaWNrRXZlbnRUb0Nvb3JkaW5hdGVzKCBldmVudDogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQgKSB7XHJcbiAgaWYgKCBldmVudCBpbnN0YW5jZW9mIE1vdXNlRXZlbnQgKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiBldmVudC5jbGllbnRYLFxyXG4gICAgICB5OiBldmVudC5jbGllbnRZXHJcbiAgICB9O1xyXG4gIH0gZWxzZSBpZiAoIGV2ZW50IGluc3RhbmNlb2YgVG91Y2hFdmVudCApIHtcclxuICAgIGNvbnN0IHRvdWNoID0gZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF07XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB4OiB0b3VjaC5jbGllbnRYLFxyXG4gICAgICB5OiB0b3VjaC5jbGllbnRZXHJcbiAgICB9O1xyXG4gIH0gZWxzZSB7XHJcbiAgICB0aHJvdyBcIkV2ZW50IG5vdCBGb3VuZFwiO1xyXG4gIH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVJbnZpc2libGVEaXZBYm92ZVBhcmVudCggeyBwYXJlbnRFbGVtZW50LCBpZCwgcG9zaXRpb24sIGRpbWVuc2lvbnMgfTogeyBwYXJlbnRFbGVtZW50OiBIVE1MRWxlbWVudDsgaWQ6IHN0cmluZzsgcG9zaXRpb24/OiB7IHRvcDogbnVtYmVyOyBsZWZ0OiBudW1iZXI7IH07IGRpbWVuc2lvbnM/OiBEaW1lbnNpb25zOyB9ICkge1xyXG4gIHZhciBpbnZpc2libGVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApO1xyXG5cclxuICBpZiAoICFwYXJlbnRFbGVtZW50LnN0eWxlLnBvc2l0aW9uICkge1xyXG4gICAgcGFyZW50RWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7XHJcbiAgfVxyXG5cclxuICBpbnZpc2libGVEaXYuaWQgPSBpZDtcclxuICBpbnZpc2libGVEaXYuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gIGludmlzaWJsZURpdi5zdHlsZS53aWR0aCA9IGRpbWVuc2lvbnMgJiYgZGltZW5zaW9ucy53aWR0aCA/IGRpbWVuc2lvbnMud2lkdGgudG9TdHJpbmcoKSArICdweCcgOiAnMTAwJSc7XHJcbiAgaW52aXNpYmxlRGl2LnN0eWxlLmhlaWdodCA9IGRpbWVuc2lvbnMgJiYgZGltZW5zaW9ucy5oZWlnaHQgPyBkaW1lbnNpb25zLmhlaWdodC50b1N0cmluZygpICsgJ3B4JyA6ICcxMDAlJztcclxuICBpbnZpc2libGVEaXYuc3R5bGUudG9wID0gKCBwb3NpdGlvbj8udG9wLnRvU3RyaW5nKCkgPz8gJzAnICkgKyAncHgnO1xyXG4gIGludmlzaWJsZURpdi5zdHlsZS5sZWZ0ID0gKCBwb3NpdGlvbj8ubGVmdC50b1N0cmluZygpID8/ICcwJyApICsgJ3B4JztcclxuICBpbnZpc2libGVEaXYuc3R5bGUub3BhY2l0eSA9ICcwJzsgLy8gTWFrZSB0aGUgZGl2IGludmlzaWJsZVxyXG4gIGludmlzaWJsZURpdi5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ2F1dG8nOyAvLyBBbGxvdyB0aGUgZGl2IHRvIGludGVyY2VwdCBtb3VzZSBldmVudHNcclxuXHJcbiAgcGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZCggaW52aXNpYmxlRGl2ICk7XHJcblxyXG4gIHJldHVybiBpbnZpc2libGVEaXY7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBoaWRlRWxlbWVudCggZWxlbWVudDogSFRNTEVsZW1lbnQgKSB7XHJcbiAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICBlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICBlbGVtZW50LnN0eWxlLnpJbmRleCA9ICctMSc7XHJcbiAgZWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gJzAnO1xyXG4gIGVsZW1lbnQuc3R5bGUud2lkdGggPSAnMHB4ICFpbXBvcnRhbnQnO1xyXG4gIGVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gJzBweCAhaW1wb3J0YW50JztcclxuICBlbGVtZW50LnNldEF0dHJpYnV0ZSggJ2hpZGRlbicsICcnICk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzbGVlcEFzeW5jKCBtczogbnVtYmVyICkge1xyXG4gIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZTx2b2lkPiggKCByZXNvbHZlICkgPT4gc2V0VGltZW91dCggKCkgPT4gcmVzb2x2ZSgpLCBtcyApICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBiaW5kRWxlbWVudHNCeUNoZWNrKCB0cmlnZ2VyRWxlbWVudDogSFRNTElucHV0RWxlbWVudCwgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQsIG9uQ2hlY2s6IEZ1bmN0aW9uLCBvblVuY2hlY2s6IEZ1bmN0aW9uICkge1xyXG4gIGlmICggdHJpZ2dlckVsZW1lbnQuY2hlY2tlZCApIHtcclxuICAgIG9uQ2hlY2soIHRhcmdldEVsZW1lbnQgKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHRyaWdnZXJHcm91cCA9IHRyaWdnZXJFbGVtZW50Lm5hbWVcclxuICAgID8gQXJyYXkuZnJvbSggZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCggYFtuYW1lPVwiJHsgdHJpZ2dlckVsZW1lbnQubmFtZSB9XCJdYCApIClcclxuICAgIDogW3RyaWdnZXJFbGVtZW50XTtcclxuXHJcbiAgdHJpZ2dlckdyb3VwLmZvckVhY2goIHQgPT4gdC5hZGRFdmVudExpc3RlbmVyKCAnY2hhbmdlJywgZXZ0ID0+IHtcclxuICAgIGlmICggdHJpZ2dlckVsZW1lbnQuY2hlY2tlZCApIHtcclxuICAgICAgb25DaGVjayggdGFyZ2V0RWxlbWVudCwgZXZ0ICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBvblVuY2hlY2soIHRhcmdldEVsZW1lbnQsIGV2dCApO1xyXG4gICAgfVxyXG4gIH0gKSApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2V0SW5wdXRGb3JjZVBob25lTnVtYmVyRm9ybWF0KCBpbnB1dEVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQgKSB7XHJcbiAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdpbnB1dCcsIGZ1bmN0aW9uICgpIHtcclxuICAgIGxldCBwaG9uZUlucHV0ID0gdGhpcy52YWx1ZTtcclxuXHJcbiAgICBjb25zdCBjbGVhblBob25lSW5wdXQgPSBwaG9uZUlucHV0LnJlcGxhY2UoIC9cXEQvZywgJycgKTtcclxuICAgIGlmICggY2xlYW5QaG9uZUlucHV0Lmxlbmd0aCA+IDExICkge1xyXG4gICAgICBwaG9uZUlucHV0ID0gY2xlYW5QaG9uZUlucHV0LnNsaWNlKCAwLCAxMSApO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBwaG9uZU51bWJlckZvcm1hdHRlZCA9IHRvUGhvbmVOdW1iZXIoIHBob25lSW5wdXQgKTtcclxuXHJcbiAgICBpZiAoIHBob25lTnVtYmVyRm9ybWF0dGVkLmxlbmd0aCA9PT0gMTAgKSB7XHJcbiAgICAgIHBob25lTnVtYmVyRm9ybWF0dGVkID0gcGhvbmVOdW1iZXJGb3JtYXR0ZWQucmVwbGFjZUFsbCggJy0nLCAnJyApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMudmFsdWUgPSBwaG9uZU51bWJlckZvcm1hdHRlZDtcclxuICB9ICk7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNNb2JpbGVCcm93c2VyKCkge1xyXG4gIHJldHVybiAvQW5kcm9pZHxpUGhvbmUvaS50ZXN0KCBuYXZpZ2F0b3IudXNlckFnZW50ICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VyRGV2aWNlVHlwZSgpOiAnYW5kcm9pZCcgfCAnYXBwbGUnIHwgJ2Rlc2t0b3AnIHtcclxuICB2YXIgdXNlckFnZW50ID0gbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCBuYXZpZ2F0b3IudmVuZG9yIHx8ICggd2luZG93IGFzIGFueSApLm9wZXJhO1xyXG5cclxuICBpZiAoIC9hbmRyb2lkL2kudGVzdCggdXNlckFnZW50ICkgKSB7XHJcbiAgICByZXR1cm4gJ2FuZHJvaWQnO1xyXG4gIH0gZWxzZSBpZiAoIC9pUGFkfGlQaG9uZXxpUG9kLy50ZXN0KCB1c2VyQWdlbnQgKSAmJiAhKCB3aW5kb3cgYXMgYW55ICkuTVNTdHJlYW0gKSB7XHJcbiAgICByZXR1cm4gJ2FwcGxlJztcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuICdkZXNrdG9wJztcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc09uU2NyZWVuKCBlbGVtZW50OiBIVE1MRWxlbWVudCApIHtcclxuICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICByZXR1cm4gKFxyXG4gICAgcmVjdC50b3AgPj0gMCAmJlxyXG4gICAgcmVjdC5sZWZ0ID49IDAgJiZcclxuICAgIHJlY3QuYm90dG9tIDw9ICggd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgKSAmJlxyXG4gICAgcmVjdC5yaWdodCA8PSAoIHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCApXHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGJpbmRFbGVtZW50Vmlld0lmQ2hlY2tlZCggdHJpZ2dlckVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQsIHRhcmdldEVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQsIG9wdGlvbnMgPSB7XHJcbiAgb25DaGVjazogKCB0cmlnZ2VyRWxlbWVudDogSFRNTElucHV0RWxlbWVudCwgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQgKSA9PiB7IH0sXHJcbiAgb25VbmNoZWNrOiAoIHRyaWdnZXJFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50LCB0YXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCApID0+IHsgfVxyXG59ICkge1xyXG4gIGJpbmRFbGVtZW50c0J5Q2hlY2soXHJcbiAgICB0cmlnZ2VyRWxlbWVudCxcclxuICAgIHRhcmdldEVsZW1lbnQsXHJcbiAgICAoIGVsOiBIVE1MRWxlbWVudCApID0+IHtcclxuICAgICAgZWwuY2xhc3NMaXN0LmFkZCggJ3Nob3cnICk7XHJcbiAgICAgIG9wdGlvbnMub25DaGVjayggdHJpZ2dlckVsZW1lbnQsIHRhcmdldEVsZW1lbnQgKTtcclxuICAgIH0sXHJcbiAgICAoIGVsOiBIVE1MRWxlbWVudCApID0+IHtcclxuICAgICAgZWwuY2xhc3NMaXN0LnJlbW92ZSggJ3Nob3cnICk7XHJcbiAgICAgIG9wdGlvbnMub25VbmNoZWNrKCB0cmlnZ2VyRWxlbWVudCwgdGFyZ2V0RWxlbWVudCApO1xyXG4gICAgfSxcclxuICApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VmFsdWVGcm9tUmFkaW9Hcm91cCggZ3JvdXBOYW1lOiBzdHJpbmcgKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICBjb25zdCBlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIGBbbmFtZT0keyBncm91cE5hbWUgfV06Y2hlY2tlZGAgKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xyXG4gIGlmICggZWwgKSB7XHJcbiAgICByZXR1cm4gZWwudmFsdWU7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNtb290aFNjcm9sbCggdGFyZ2V0WTogbnVtYmVyLCBkdXJhdGlvbjogbnVtYmVyICk6IHZvaWQge1xyXG4gIGNvbnN0IHN0YXJ0WSA9IHdpbmRvdy5zY3JvbGxZIHx8IHdpbmRvdy5wYWdlWU9mZnNldDtcclxuICBsZXQgc3RhcnRUaW1lOiBudW1iZXIgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgZnVuY3Rpb24gc3RlcCggY3VycmVudFRpbWU6IG51bWJlciApIHtcclxuICAgIGlmICggIXN0YXJ0VGltZSApIHN0YXJ0VGltZSA9IGN1cnJlbnRUaW1lO1xyXG4gICAgY29uc3QgZWxhcHNlZFRpbWUgPSBjdXJyZW50VGltZSAtIHN0YXJ0VGltZTtcclxuICAgIGNvbnN0IHByb2dyZXNzID0gTWF0aC5taW4oIGVsYXBzZWRUaW1lIC8gZHVyYXRpb24sIDEgKTtcclxuICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBsZXJwKCAwLCAxLCBwcm9ncmVzcyApO1xyXG4gICAgd2luZG93LnNjcm9sbFRvKCAwLCBsZXJwKCBzdGFydFksIHRhcmdldFksIGVhc2VkUHJvZ3Jlc3MgKSApO1xyXG4gICAgaWYgKCBlbGFwc2VkVGltZSA8IGR1cmF0aW9uICkge1xyXG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIHN0ZXAgKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZSggc3RlcCApO1xyXG59XHJcblxyXG4vLyBSZXRvcm5hIHVtYSBmdW7Dp8OjbyBxdWUgbsOjbyB2YWkgc2VyIGNvbXBsZXRhZGEgY2FzbyBzZWphIGNoYW1hZGEgbm92YW1lbnRlIGVtIHsgZGVsYXkgfSBtaWxpc3NlZ3VuZG9zXHJcbmV4cG9ydCBmdW5jdGlvbiBkZWJvdW5jZUZhY3RvcnkoIGZ1bmM6IEZ1bmN0aW9uLCBkZWxheTogbnVtYmVyICk6IEZ1bmN0aW9uIHtcclxuICBsZXQgaW5EZWJvdW5jZTogbnVtYmVyO1xyXG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICBjb25zdCBjb250ZXh0ID0gd2luZG93O1xyXG4gICAgY29uc3QgYXJncyA9IGFyZ3VtZW50cztcclxuICAgIGNsZWFyVGltZW91dCggaW5EZWJvdW5jZSApO1xyXG4gICAgaW5EZWJvdW5jZSA9IHdpbmRvdy5zZXRUaW1lb3V0KCAoKSA9PiBmdW5jLmFwcGx5KCBjb250ZXh0LCBhcmdzICksIGRlbGF5ICk7XHJcbiAgfTtcclxufVxyXG5cclxuLy8gUmV0b3JuYSB1bWEgZnVuw6fDo28gcXVlIHPDsyBwb2RlIHNlciBjb21wbGV0YWRhIHVtYSB2ZXogYSBjYWRhIHsgbGltaXQgfSBtaWxpc3NlZ3VuZG9zIFxyXG5leHBvcnQgZnVuY3Rpb24gdGhyb3R0bGVGYWN0b3J5KCBmdW5jOiBGdW5jdGlvbiwgbGltaXQ6IG51bWJlciApOiBGdW5jdGlvbiB7XHJcbiAgbGV0IGxhc3RGdW5jOiBudW1iZXI7XHJcbiAgbGV0IGxhc3RSYW46IG51bWJlcjtcclxuICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgY29udGV4dCA9IHdpbmRvdztcclxuICAgIGNvbnN0IGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICBpZiAoICFsYXN0UmFuICkge1xyXG4gICAgICBmdW5jLmFwcGx5KCBjb250ZXh0LCBhcmdzICk7XHJcbiAgICAgIGxhc3RSYW4gPSBEYXRlLm5vdygpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY2xlYXJUaW1lb3V0KCBsYXN0RnVuYyApO1xyXG4gICAgICBsYXN0RnVuYyA9IHdpbmRvdy5zZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCBEYXRlLm5vdygpIC0gbGFzdFJhbiA+PSBsaW1pdCApIHtcclxuICAgICAgICAgIGZ1bmMuYXBwbHkoIGNvbnRleHQsIGFyZ3MgKTtcclxuICAgICAgICAgIGxhc3RSYW4gPSBEYXRlLm5vdygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSwgbGltaXQgLSAoIERhdGUubm93KCkgLSBsYXN0UmFuICkgKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzbW9vdGhTY3JvbGxUbyggcG9zOiBudW1iZXIgKTogdm9pZCB7XHJcbiAgZG9jdW1lbnQuYm9keS5zY3JvbGxUbygge1xyXG4gICAgdG9wOiBwb3MsXHJcbiAgICBiZWhhdmlvcjogJ3Ntb290aCcsXHJcbiAgfSApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc21vb3RoU2Nyb2xsVG9FbGVtZW50KCBlbGVtZW50OiBIVE1MRWxlbWVudCwgdXNlQnJvd3NlckRlZmF1bHRzOiBib29sZWFuID0gdHJ1ZSApOiB2b2lkIHtcclxuICBpZiAoICF1c2VCcm93c2VyRGVmYXVsdHMgKSB7XHJcbiAgICBjb25zdCB0YXJnZXRZID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgKyB3aW5kb3cuc2Nyb2xsWTtcclxuICAgIGNvbnN0IGR1cmF0aW9uID0gMTAwMDsgLy8gRHVyYcOnw6NvIGZpeGEgZW0gbWlsaXNzZWd1bmRvcyAoMSBzZWd1bmRvKVxyXG4gICAgc21vb3RoU2Nyb2xsKCB0YXJnZXRZLCBkdXJhdGlvbiApO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgZG9jdW1lbnQuYm9keS5zY3JvbGxUbygge1xyXG4gICAgdG9wOiBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnksXHJcbiAgICBsZWZ0OiBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLngsXHJcbiAgICBiZWhhdmlvcjogJ3Ntb290aCcsXHJcbiAgfSApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc2VsZWN0T3B0aW9uQnlUZXh0KCBpZFNlbGVjdEVsZW1lbnQ6IHN0cmluZywgc2VhcmNoVGV4dDogc3RyaW5nLCBjb250YWluczogYm9vbGVhbiA9IGZhbHNlICk6IHZvaWQge1xyXG4gIGNvbnN0IHNlbGVjdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggaWRTZWxlY3RFbGVtZW50ICkgYXMgSFRNTFNlbGVjdEVsZW1lbnQ7XHJcblxyXG4gIGlmICggIXNlbGVjdEVsZW1lbnQgKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICBjb25zdCBvcHRpb25zRWxlbWVudG9TZWxlY3QgPSBbLi4uc2VsZWN0RWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCAnb3B0aW9uJyApXTtcclxuXHJcbiAgbGV0IHNlbGVjdGVkT3B0aW9uO1xyXG4gIGlmICggY29udGFpbnMgKSB7XHJcbiAgICBzZWxlY3RlZE9wdGlvbiA9IG9wdGlvbnNFbGVtZW50b1NlbGVjdFxyXG4gICAgICAuZmlsdGVyKCBlbCA9PiBlbC50ZXh0Q29udGVudCAmJiBlbC50ZXh0Q29udGVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCBzZWFyY2hUZXh0LnRvTG93ZXJDYXNlKCkgKSApWzBdLnZhbHVlO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBzZWxlY3RlZE9wdGlvbiA9IG9wdGlvbnNFbGVtZW50b1NlbGVjdFxyXG4gICAgICAuZmlsdGVyKCBlbCA9PiBlbC50ZXh0Q29udGVudCAmJiBlbC50ZXh0Q29udGVudC50b0xvd2VyQ2FzZSgpID09PSBzZWFyY2hUZXh0LnRvTG93ZXJDYXNlKCkgKVswXS52YWx1ZTtcclxuICB9XHJcblxyXG4gIHNlbGVjdEVsZW1lbnQudmFsdWUgPSBzZWxlY3RlZE9wdGlvbjtcclxufVxyXG5cclxuIiwiZXhwb3J0IGNvbnN0IHJlZ2V4TnVtYmVyUGF0dGVybiA9IC8tP1xcZCtcXC4/XFxkKi9nO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBQb2ludDJEIHtcclxuICB4OiBudW1iZXI7XHJcbiAgeTogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIERpbWVuc2lvbnMge1xyXG4gIHdpZHRoOiBudW1iZXI7XHJcbiAgaGVpZ2h0OiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpbmRleFRvUm93KCBpbmRleDogbnVtYmVyLCBncmlkV2lkdGg6IG51bWJlciApIHtcclxuICByZXR1cm4gTWF0aC5mbG9vciggaW5kZXggLyBncmlkV2lkdGggKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGluZGV4VG9Db2woIGluZGV4OiBudW1iZXIsIGdyaWRXaWR0aDogbnVtYmVyICkge1xyXG4gIHJldHVybiBpbmRleCAlIGdyaWRXaWR0aDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJvd0NvbFRvSW5kZXgoIHJvdzogbnVtYmVyLCBjb2w6IG51bWJlciwgd2lkdGg6IG51bWJlciApIHtcclxuICByZXR1cm4gKCByb3cgKiB3aWR0aCApICsgY29sO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcm90YXRlQ29vcmRpbmF0ZXNGcm9tUG9pbnQyRCggY29vcmRzOiBQb2ludDJELCBhbmdsZTogbnVtYmVyICk6IFBvaW50MkQge1xyXG4gIGNvbnN0IHJhZGlhbnMgPSAoIE1hdGguUEkgLyAxODAgKSAqIGFuZ2xlO1xyXG4gIGNvbnN0IG5ld1ggPSBjb29yZHMueCAqIE1hdGguY29zKCByYWRpYW5zICkgLSBjb29yZHMueSAqIE1hdGguc2luKCByYWRpYW5zICk7XHJcbiAgY29uc3QgbmV3WSA9IGNvb3Jkcy54ICogTWF0aC5zaW4oIHJhZGlhbnMgKSArIGNvb3Jkcy55ICogTWF0aC5jb3MoIHJhZGlhbnMgKTtcclxuICByZXR1cm4geyB4OiBuZXdYLCB5OiBuZXdZIH07XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcm90YXRlQ29vcmRpbmF0ZXMoIHg6IG51bWJlciwgeTogbnVtYmVyLCBhbmdsZTogbnVtYmVyICk6IFBvaW50MkQge1xyXG4gIGNvbnN0IHJhZGlhbnMgPSAoIE1hdGguUEkgLyAxODAgKSAqIGFuZ2xlO1xyXG4gIGNvbnN0IG5ld1ggPSB4ICogTWF0aC5jb3MoIHJhZGlhbnMgKSAtIHkgKiBNYXRoLnNpbiggcmFkaWFucyApO1xyXG4gIGNvbnN0IG5ld1kgPSB4ICogTWF0aC5zaW4oIHJhZGlhbnMgKSArIHkgKiBNYXRoLmNvcyggcmFkaWFucyApO1xyXG4gIHJldHVybiB7IHg6IG5ld1gsIHk6IG5ld1kgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGFyZURpYWdvbmFscyggaW5kZXgxOiBudW1iZXIsIGluZGV4MjogbnVtYmVyLCBncmlkU2l6ZTogbnVtYmVyICk6IGJvb2xlYW4ge1xyXG4gIGlmICggaW5kZXgxIDwgMCB8fCBpbmRleDIgPCAwICkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCAnSW52YWxpZCBjZWxsIGluZGljZXMnICk7XHJcbiAgfVxyXG5cclxuICBjb25zdCByb3cxID0gaW5kZXhUb1JvdyggaW5kZXgxLCBncmlkU2l6ZSApO1xyXG4gIGNvbnN0IGNvbDEgPSBpbmRleFRvQ29sKCBpbmRleDEsIGdyaWRTaXplICk7XHJcblxyXG4gIGNvbnN0IHJvdzIgPSBpbmRleFRvUm93KCBpbmRleDIsIGdyaWRTaXplICk7XHJcbiAgY29uc3QgY29sMiA9IGluZGV4VG9Db2woIGluZGV4MiwgZ3JpZFNpemUgKTtcclxuXHJcbiAgcmV0dXJuIE1hdGguYWJzKCByb3cxIC0gcm93MiApID09PSBNYXRoLmFicyggY29sMSAtIGNvbDIgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGluZGV4VG9Qb2ludDJEKCBpbmRleDogbnVtYmVyLCBncmlkV2lkdGg6IG51bWJlciApOiBQb2ludDJEIHtcclxuICByZXR1cm4ge1xyXG4gICAgeDogaW5kZXhUb0NvbCggaW5kZXgsIGdyaWRXaWR0aCApLFxyXG4gICAgeTogaW5kZXhUb1JvdyggaW5kZXgsIGdyaWRXaWR0aCApXHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbGVycCggbWluOiBudW1iZXIsIG1heDogbnVtYmVyLCBhbW91bnQ6IG51bWJlciApOiBudW1iZXIge1xyXG4gIHJldHVybiAoIDEgLSBhbW91bnQgKSAqIG1pbiArIGFtb3VudCAqIG1heDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGludmVyc2VMZXJwKCBhOiBudW1iZXIsIGI6IG51bWJlciwgdmFsOiBudW1iZXIgKTogbnVtYmVyIHtcclxuICByZXR1cm4gKCB2YWwgLSBhICkgLyAoIGIgLSBhICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByZW1hcCggaW5NaW46IG51bWJlciwgaW5NYXg6IG51bWJlciwgb3V0TWluOiBudW1iZXIsIG91dE1heDogbnVtYmVyLCB2YWw6IG51bWJlciApOiBudW1iZXIge1xyXG4gIHJldHVybiBsZXJwKCBvdXRNaW4sIG91dE1heCwgaW52ZXJzZUxlcnAoIGluTWluLCBpbk1heCwgdmFsICkgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJhbmRvbUludEV4Y2x1c2l2ZSggbWluOiBudW1iZXIsIG1heDogbnVtYmVyICkge1xyXG4gIHJldHVybiBNYXRoLmZsb29yKCBNYXRoLnJhbmRvbSgpICogKCBtYXggLSBtaW4gKSArIG1pbiApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNFcXVhbFNldHM8VD4oIHNldDE6IFNldDxUPiwgc2V0MjogU2V0PFQ+ICkge1xyXG4gIHJldHVybiBzZXQxLnNpemUgPT09IHNldDIuc2l6ZSAmJlxyXG4gICAgWy4uLnNldDFdLmV2ZXJ5KCAoIHggKSA9PiBzZXQyLmhhcyggeCApICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRSYW5kb21JbnRJbmNsdXNpdmUoIG1pbjogbnVtYmVyLCBtYXg6IG51bWJlciApIHtcclxuICBtaW4gPSBNYXRoLmNlaWwoIG1pbiApO1xyXG4gIG1heCA9IE1hdGguZmxvb3IoIG1heCApO1xyXG4gIHJldHVybiBNYXRoLmZsb29yKCBNYXRoLnJhbmRvbSgpICogKCBtYXggLSBtaW4gKyAxICkgKSArIG1pbjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJhbmRvbUZyb21BcnJheTxUPiggYXJyOiBBcnJheTxUPiApIHtcclxuICByZXR1cm4gYXJyW2dldFJhbmRvbUludEV4Y2x1c2l2ZSggMCwgYXJyLmxlbmd0aCApXTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNsYW1wKCBudW06IG51bWJlciA9IDAsIG1pbjogbnVtYmVyID0gMCwgbWF4OiBudW1iZXIgPSAxMDAgKTogbnVtYmVyIHtcclxuICByZXR1cm4gTWF0aC5tYXgoIG1pbiwgTWF0aC5taW4oIG51bSwgbWF4ICkgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1pbnV0ZXNUb01pbGxpc2Vjb25kcyggbXM6IG51bWJlciApIHtcclxuICByZXR1cm4gbXMgKiA2MDAwMDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1pbGxpc2Vjb25kc1RvTWludXRlcyggbXM6IG51bWJlciApIHtcclxuICByZXR1cm4gbXMgLyA2MDAwMDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1pbGxpc2Vjb25kc1RvSG91cnMoIG1zOiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuIG1zIC8gMy42ZSs2O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbWlsbGlzZWNvbmRzVG9EYXlzKCBtczogbnVtYmVyICkge1xyXG4gIHJldHVybiBtcyAvIDguNjRlKzc7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtZWdhYnl0ZVRvQnl0ZSggbWI6IG51bWJlciApIHtcclxuICByZXR1cm4gbWIgKiAxMDI0ICogMTAyNDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGJ5dGVUb01lZ2FieXRlKCBiOiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuIGIgLyAxMDI0IC8gMTAyNDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEFycmF5RnJvbVJhbmdlKCBzaXplOiBudW1iZXIsIHN0YXJ0aW5nRnJvbTogbnVtYmVyID0gMCApOiBudW1iZXJbXSB7XHJcbiAgbGV0IHJlc3VsdCA9IFsuLi5BcnJheSggc2l6ZSApLmtleXMoKV1cclxuXHJcbiAgaWYgKCBzdGFydGluZ0Zyb20gIT0gMCApIHtcclxuICAgIHJlc3VsdCA9IHJlc3VsdC5tYXAoIGkgPT4gaSArIHN0YXJ0aW5nRnJvbSApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlc3VsdDtcclxufSIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiaW1wb3J0IHsgT2JqZWN0RXZlbnRMaXN0ZW5lciB9IGZyb20gJy4vT2JqZWN0RXZlbnRMaXN0ZW5lcic7XHJcbmltcG9ydCB7IGdldERpc3RhbmNlRnJvbUJvcmRlciwgZ2V0VHJhbnNmb3JtQ29vcmRzRnJvbUVsZW1lbnQsIHJlZ2V4UmVtb3ZlVHJhbnNsYXRlRnJvbVRyYW5zZm9ybSB9IGZyb20gJy4uL1Rvb2xzL0RPTVRvb2xzJztcclxuaW1wb3J0IHsgUG9pbnQyRCB9IGZyb20gJy4uL1Rvb2xzL01hdGhUb29scyc7XHJcbmV4cG9ydCBpbnRlcmZhY2UgRWxlbWVudE1vdmluZ1N0YXRlIHtcclxuICBwb3M6IFBvaW50MkQ7XHJcbiAgZGVsdGE6IHtcclxuICAgIGR4OiBudW1iZXIsXHJcbiAgICBkeTogbnVtYmVyXHJcbiAgfTtcclxufVxyXG5cclxuZXhwb3J0IHR5cGUgTW92YWJsZU9wdGlvbnMgPSB7XHJcbiAgZWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcbiAgb25CZWZvcmVNb3ZlPzogT25Nb3ZlRXZlbnQ7XHJcbiAgb25BZnRlck1vdmU/OiBPbk1vdmVFdmVudDtcclxufVxyXG5cclxuXHJcbmV4cG9ydCB0eXBlIE9uTW92ZUV2ZW50ID0gKCAoIGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBkcmFnZ2FibGU6IE1vdmFibGVFbGVtZW50ICkgPT4gdm9pZCApO1xyXG5cclxuZXhwb3J0IGNsYXNzIE1vdmFibGVFbGVtZW50IGV4dGVuZHMgT2JqZWN0RXZlbnRMaXN0ZW5lciB7XHJcbiAgcHVibGljIHJlYWRvbmx5IGVsZW1lbnQ6IEhUTUxFbGVtZW50O1xyXG4gIHByb3RlY3RlZCBtb3ZpbmdTdGF0ZTogRWxlbWVudE1vdmluZ1N0YXRlO1xyXG4gIHB1YmxpYyBpbnRlcnZhbFVwZGF0ZVBvc2l0aW9uOiBOb2RlSlMuVGltZW91dDtcclxuICBwdWJsaWMgb25CZWZvcmVNb3ZlPzogT25Nb3ZlRXZlbnQ7XHJcbiAgcHVibGljIG9uQWZ0ZXJNb3ZlPzogT25Nb3ZlRXZlbnQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCBvcHRpb25zOiBNb3ZhYmxlT3B0aW9ucyApIHtcclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgaWYgKCAhb3B0aW9ucy5lbGVtZW50ICkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoIFwiTnVsbCBtb3ZhYmxlIGVsZW1lbnQuIFBsZWFzZSBwYXNzIGEgdmFsaWQgZWxlbWVudCBpbiBjb25zdHJ1Y3Rvci5cIiApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZWxlbWVudCA9IG9wdGlvbnMuZWxlbWVudDtcclxuICAgIHRoaXMub25CZWZvcmVNb3ZlID0gb3B0aW9ucy5vbkJlZm9yZU1vdmU7XHJcbiAgICB0aGlzLm9uQWZ0ZXJNb3ZlID0gb3B0aW9ucy5vbkFmdGVyTW92ZTtcclxuXHJcbiAgICB0aGlzLm1vdmluZ1N0YXRlID0ge1xyXG4gICAgICBwb3M6IHtcclxuICAgICAgICB4OiAwLFxyXG4gICAgICAgIHk6IDBcclxuICAgICAgfSxcclxuICAgICAgZGVsdGE6IHtcclxuICAgICAgICBkeDogMCxcclxuICAgICAgICBkeTogMFxyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuaW50ZXJ2YWxVcGRhdGVQb3NpdGlvbiA9IHNldEludGVydmFsKCB0aGlzLnVwZGF0ZVBvc2l0aW9uLmJpbmQoIHRoaXMgKSwgMjAwICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IHBvc2l0aW9uKCk6IFBvaW50MkQge1xyXG4gICAgcmV0dXJuIHRoaXMubW92aW5nU3RhdGUucG9zO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldCBwb3NpdGlvbiggbmV3UG9zOiBQb2ludDJEICkge1xyXG4gICAgdGhpcy5tb3ZlVG9Qb3NpdGlvbiggbmV3UG9zLngsIG5ld1Bvcy55IClcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgeCgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMubW92aW5nU3RhdGUucG9zLng7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IHgoIG5ld1g6IG51bWJlciApIHtcclxuICAgIHRoaXMubW92ZVRvUG9zaXRpb24oIG5ld1gsIHRoaXMueSApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCB5KCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5tb3ZpbmdTdGF0ZS5wb3MueTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXQgeSggbmV3WTogbnVtYmVyICkge1xyXG4gICAgdGhpcy5tb3ZlVG9Qb3NpdGlvbiggdGhpcy54LCBuZXdZICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFRyYW5zbGF0ZSggbmV3WDogbnVtYmVyLCBuZXdZOiBudW1iZXIgKSB7XHJcbiAgICB0aGlzLmNhbGxFdmVudHNCeU5hbWUoICdvbkJlZm9yZU1vdmUnLCB0aGlzLmVsZW1lbnQsIHRoaXMgKTtcclxuICAgIGlmICggdGhpcy5vbkJlZm9yZU1vdmUgKSB7XHJcbiAgICAgIHRoaXMub25CZWZvcmVNb3ZlKCB0aGlzLmVsZW1lbnQsIHRoaXMgKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnJlc2V0VHJhbnNsYXRlKCk7XHJcbiAgICB0aGlzLmVsZW1lbnQuc3R5bGUudHJhbnNmb3JtICs9IGB0cmFuc2xhdGUoJHsgbmV3WCB9cHgsICR7IG5ld1kgfXB4KWA7XHJcblxyXG4gICAgdGhpcy5jYWxsRXZlbnRzQnlOYW1lKCAnb25BZnRlck1vdmUnLCB0aGlzLmVsZW1lbnQsIHRoaXMgKTtcclxuICAgIGlmICggdGhpcy5vbkFmdGVyTW92ZSApIHtcclxuICAgICAgdGhpcy5vbkFmdGVyTW92ZSggdGhpcy5lbGVtZW50LCB0aGlzICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNldFRyYW5zbGF0ZUJ5UG9pbnQyRCggcG9pbnQ6IFBvaW50MkQgKSB7XHJcbiAgICB0aGlzLnNldFRyYW5zbGF0ZSggcG9pbnQueCwgcG9pbnQueSApO1xyXG4gIH1cclxuXHJcbiAgcHJvdGVjdGVkIHVwZGF0ZVBvc2l0aW9uKCk6IHZvaWQge1xyXG4gICAgdGhpcy5tb3ZpbmdTdGF0ZS5wb3MgPSBnZXRUcmFuc2Zvcm1Db29yZHNGcm9tRWxlbWVudCggdGhpcy5lbGVtZW50ICk7XHJcbiAgICB0aGlzLm1vdmluZ1N0YXRlLmRlbHRhLmR4ID0gMDtcclxuICAgIHRoaXMubW92aW5nU3RhdGUuZGVsdGEuZHkgPSAwO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZXNldFRyYW5zbGF0ZSgpIHtcclxuICAgIHRoaXMuZWxlbWVudC5zdHlsZS50cmFuc2Zvcm0gPSB0aGlzLmVsZW1lbnQuc3R5bGUudHJhbnNmb3JtLnJlcGxhY2UoIHJlZ2V4UmVtb3ZlVHJhbnNsYXRlRnJvbVRyYW5zZm9ybSwgJycgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBtb3ZlVG9Qb3NpdGlvbiggeDogbnVtYmVyLCB5OiBudW1iZXIgKTogdm9pZCB7XHJcbiAgICB0aGlzLm1vdmluZ1N0YXRlLnBvcyA9IHsgeDogeCArIHRoaXMubW92aW5nU3RhdGUuZGVsdGEuZHgsIHk6IHkgKyB0aGlzLm1vdmluZ1N0YXRlLmRlbHRhLmR5IH07XHJcbiAgICB0aGlzLnNldFRyYW5zbGF0ZUJ5UG9pbnQyRCggdGhpcy5tb3ZpbmdTdGF0ZS5wb3MgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBtb3ZlVG9Qb2ludDJEKCBwb2ludDogUG9pbnQyRCApOiB2b2lkIHtcclxuICAgIHRoaXMubW92aW5nU3RhdGUucG9zID0geyB4OiBwb2ludC54ICsgdGhpcy5tb3ZpbmdTdGF0ZS5kZWx0YS5keCwgeTogcG9pbnQueSArIHRoaXMubW92aW5nU3RhdGUuZGVsdGEuZHkgfTtcclxuICAgIHRoaXMuc2V0VHJhbnNsYXRlQnlQb2ludDJEKCB0aGlzLm1vdmluZ1N0YXRlLnBvcyApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG1vdmVUb1RhcmdldEVsZW1lbnQoIHRhcmdldDogSFRNTEVsZW1lbnQgKSB7XHJcbiAgICBjb25zdCB0YXJnZXRSZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgY29uc3QgZWxlbWVudFRyYW5zZm9ybVBvc2l0aW9uID0gZ2V0VHJhbnNmb3JtQ29vcmRzRnJvbUVsZW1lbnQoIHRoaXMuZWxlbWVudCApO1xyXG4gICAgY29uc3QgZGlzdGFuY2VGcm9tQm9yZGVyID0gZ2V0RGlzdGFuY2VGcm9tQm9yZGVyKCB0aGlzLmVsZW1lbnQsIHRhcmdldCApO1xyXG4gICAgY29uc3QgdGFyZ2V0UmlnaHRQb3NpdGlvbiA9IGVsZW1lbnRUcmFuc2Zvcm1Qb3NpdGlvbi54ICsgZGlzdGFuY2VGcm9tQm9yZGVyLnJpZ2h0O1xyXG4gICAgY29uc3QgdGFyZ2V0Qm90dG9tUG9zaXRpb24gPSBlbGVtZW50VHJhbnNmb3JtUG9zaXRpb24ueSArIGRpc3RhbmNlRnJvbUJvcmRlci5ib3R0b207XHJcblxyXG4gICAgdGhpcy5zZXRUcmFuc2xhdGVCeVBvaW50MkQoIHtcclxuICAgICAgeDogTWF0aC5yb3VuZCggdGFyZ2V0UmlnaHRQb3NpdGlvbiAtIHRhcmdldFJlY3Qud2lkdGggKSxcclxuICAgICAgeTogTWF0aC5yb3VuZCggdGFyZ2V0Qm90dG9tUG9zaXRpb24gLSB0YXJnZXRSZWN0LmhlaWdodCApXHJcbiAgICB9ICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgbW92ZVRvQ2VudGVyT2ZUYXJnZXRFbGVtZW50KCB0YXJnZXQ6IEhUTUxFbGVtZW50ICk6IHZvaWQge1xyXG4gICAgY29uc3QgdGFyZ2V0UmVjdCA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgIGNvbnN0IGVsZW1lbnRUcmFuc2Zvcm1Qb3NpdGlvbiA9IGdldFRyYW5zZm9ybUNvb3Jkc0Zyb21FbGVtZW50KCB0aGlzLmVsZW1lbnQgKTtcclxuICAgIGNvbnN0IGRpc3RhbmNlRnJvbUJvcmRlciA9IGdldERpc3RhbmNlRnJvbUJvcmRlciggdGhpcy5lbGVtZW50LCB0YXJnZXQgKTtcclxuICAgIGNvbnN0IHRhcmdldFJpZ2h0UG9zaXRpb24gPSBlbGVtZW50VHJhbnNmb3JtUG9zaXRpb24ueCArIGRpc3RhbmNlRnJvbUJvcmRlci5yaWdodDtcclxuICAgIGNvbnN0IHRhcmdldEJvdHRvbVBvc2l0aW9uID0gZWxlbWVudFRyYW5zZm9ybVBvc2l0aW9uLnkgKyBkaXN0YW5jZUZyb21Cb3JkZXIuYm90dG9tO1xyXG5cclxuICAgIHRoaXMuc2V0VHJhbnNsYXRlQnlQb2ludDJEKCB7XHJcbiAgICAgIHg6IE1hdGgucm91bmQoIHRhcmdldFJpZ2h0UG9zaXRpb24gLSAoIHRhcmdldFJlY3Qud2lkdGggLyAyICkgKSxcclxuICAgICAgeTogTWF0aC5yb3VuZCggdGFyZ2V0Qm90dG9tUG9zaXRpb24gLSAoIHRhcmdldFJlY3QuaGVpZ2h0IC8gMiApIClcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgbWFrZUVsZW1lbnRNb3ZhYmxlKCBlbGVtZW50OiBIVE1MRWxlbWVudCApOiBNb3ZhYmxlRWxlbWVudCB7XHJcbiAgICByZXR1cm4gbmV3IE1vdmFibGVFbGVtZW50KCB7IGVsZW1lbnQgfSApO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJPYmplY3RFdmVudExpc3RlbmVyIiwiZXZlbnRzQnlOYW1lIiwiTWFwIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50TmFtZSIsImV2ZW50IiwidGhpcyIsImhhcyIsInRvTG93ZXJDYXNlIiwiZ2V0IiwicHVzaCIsInNldCIsImdldEV2ZW50c0J5TmFtZSIsImNhbGxFdmVudHNCeU5hbWUiLCJldmVudEFyZ3MiLCJmb3JFYWNoIiwiZSIsInJlZ2V4UmVtb3ZlVHJhbnNsYXRlRnJvbVRyYW5zZm9ybSIsInJlZ2V4R3JvdXBSb3RhdGVWYWx1ZSIsInJlZ2V4R3JvdXBSb3RhdGVYVmFsdWUiLCJyZWdleEdyb3VwUm90YXRlWVZhbHVlIiwicmVnZXhHcm91cFJvdGF0ZVpWYWx1ZSIsImRpY3RLZXlzQnlBY3Rpb25LZXlkb3duT25jZSIsImRpY3RLZXlzQnlBY3Rpb25LZXlkb3duUmVwZWF0IiwiZGljdEtleXNCeUFjdGlvbktleXVwIiwiZ2V0Um90YXRlZEJvdW5kaW5nQm94QmFzZWRPbkJvZHlSb3RhdGlvbiIsImVsZW1lbnQiLCJyZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiY2VudGVyWCIsImxlZnQiLCJ3aWR0aCIsImNlbnRlclkiLCJ0b3AiLCJoZWlnaHQiLCJyb3RhdGlvbkFuZ2xlIiwibWF0Y2giLCJheGlzIiwiZ2V0UmVnZXhSZW1vdmVSb3RhdGlvbkJhc2VkT25BeGlzIiwiZ2V0RWxlbWVudFJvdGF0aW9uQXhpcyIsImRvY3VtZW50IiwiYm9keSIsImV4ZWMiLCJzdHlsZSIsInRyYW5zZm9ybSIsInBhcnNlRmxvYXQiLCJnZXRCb2R5Um90YXRpb25JbkRlZ3JlZXMiLCJyYWRpYW5zIiwiTWF0aCIsIlBJIiwiY29zVGhldGEiLCJjb3MiLCJzaW5UaGV0YSIsInNpbiIsInJvdGF0ZWRYMSIsInJvdGF0ZWRZMSIsInJvdGF0ZWRYMiIsInJpZ2h0IiwiYm90dG9tIiwicm90YXRlZFkyIiwicm90YXRlZExlZnQiLCJtaW4iLCJyb3RhdGVkVG9wIiwicm90YXRlZEJvdHRvbSIsIm1heCIsInJvdGF0ZWRSaWdodCIsIngiLCJ5IiwidG9KU09OIiwiZ2V0RGlzdGFuY2VGcm9tQm9yZGVyIiwiZHJhZ2dhYmxlIiwidGFyZ2V0IiwiY2hlY2tCb2R5Um90YXRpb24iLCJyZWN0MSIsInJlY3QyIiwiY2VudGVyIiwiZWxlbWVudFRyYW5zZm9ybSIsImluY2x1ZGVzIiwiZ2V0VHJhbnNmb3JtQ29vcmRzRnJvbUVsZW1lbnQiLCJhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZSIsIndpbmRvdyIsImdldENvbXB1dGVkU3R5bGUiLCJyZWdleE51bWJlclBhdHRlcm4iLCJtYXAiLCJuIiwicmVzdWx0IiwidW5kZWZpbmVkIiwicm91bmQiLCJib2R5QW5nbGUiLCJyZWdleE1hdGNoUm90YXRlVmFsdWUiLCJnZXRFbGVtZW50Um90YXRpb25JbkRlZ3JlZXMiLCJyb3RhdGVDb29yZGluYXRlcyIsImV2dCIsInJlcGVhdCIsInBhaXIiLCJjb2RlIiwia2JFdmVudCIsInJ1bk9ubHlPbmNlS2V5ZG93bkFjdGlvbnMiLCJydW5LZXlkb3duQWN0aW9uc1JlcGVhdCIsImFuZ2xlIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJkIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJNb3ZhYmxlRWxlbWVudCIsIm1vdmluZ1N0YXRlIiwiaW50ZXJ2YWxVcGRhdGVQb3NpdGlvbiIsIm9uQmVmb3JlTW92ZSIsIm9uQWZ0ZXJNb3ZlIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwic3VwZXIiLCJFcnJvciIsInBvcyIsImRlbHRhIiwiZHgiLCJkeSIsInNldEludGVydmFsIiwidXBkYXRlUG9zaXRpb24iLCJiaW5kIiwicG9zaXRpb24iLCJuZXdQb3MiLCJtb3ZlVG9Qb3NpdGlvbiIsIm5ld1giLCJuZXdZIiwic2V0VHJhbnNsYXRlIiwicmVzZXRUcmFuc2xhdGUiLCJzZXRUcmFuc2xhdGVCeVBvaW50MkQiLCJwb2ludCIsInJlcGxhY2UiLCJtb3ZlVG9Qb2ludDJEIiwibW92ZVRvVGFyZ2V0RWxlbWVudCIsInRhcmdldFJlY3QiLCJlbGVtZW50VHJhbnNmb3JtUG9zaXRpb24iLCJkaXN0YW5jZUZyb21Cb3JkZXIiLCJ0YXJnZXRSaWdodFBvc2l0aW9uIiwidGFyZ2V0Qm90dG9tUG9zaXRpb24iLCJtb3ZlVG9DZW50ZXJPZlRhcmdldEVsZW1lbnQiLCJtYWtlRWxlbWVudE1vdmFibGUiXSwic291cmNlUm9vdCI6IiJ9
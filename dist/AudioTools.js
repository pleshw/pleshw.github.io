var AudioTools; (() => { "use strict"; var e = { 173: (e, t, n) => { n.d(t, { AudioComponent: () => r }); var o = n(930), s = n(555); class r extends o.ObjectEventListener { src; audioElement; container; constructor(e, t, n, o) { super(), this.src = e, this.container = n, this.audioElement = t, o && (this.audioElement.id = o), this.audioElement.classList.add("audio-component"), this.container.id = o + "Container", this.container.classList.add("audio-container") } get paused() { return this.audioElement.paused } get fileName() { return this.audioElement.src || this.audioElement.querySelector("source")?.src || "" } get currentTime() { return this.audioElement.currentTime } play() { var e = this.audioElement.play(); return void 0 !== e && e.then((e => { })).catch((() => { this.stop() })), this.callEventsByName("onplay", this), this } pause() { return this.audioElement.pause(), this.callEventsByName("onpause", this), this } stop() { return this.pause(), this.audioElement.currentTime = 0, this.callEventsByName("onstop", this), this } toggle() { this.paused ? this.play() : this.pause(), this.callEventsByName("ontoggle", this) } static async createAudioComponent(e, t) { const n = await new s.AudioComponentFactory(e).build(document.body), o = n, i = n.querySelector("audio"); return new r(e, i, o, t) } } }, 555: (e, t, n) => { n.d(t, { AudioComponentFactory: () => r }); var o = n(353), s = n(401); class r extends s.ComponentContainer { constructor(e, t) { super("audioComponent", (0, o.createInvisiblePlayer)([e], t)) } async buildSubComponents(e) { } } }, 401: (e, t, n) => { n.d(t, { ComponentContainer: () => o }); class o { _element = null; templateElement; componentName; subComponentCountByName = new Map; subComponents = []; constructor(e, t) { if ("string" == typeof t) { const e = document.getElementById(t); if (!e) throw new Error("Invalid template for scene component. Template id: " + t); this.templateElement = e } else this.templateElement = document.createElement("template"), this.templateElement.content.appendChild(t), document.body.appendChild(this.templateElement); this.componentName = e } getTemplateCloneNodes() { return this.templateElement.content.cloneNode(!0).children } async buildSingleSubComponent(e, t) { this.subComponentCountByName.has(this.componentName) && this.subComponentCountByName.set(this.componentName, 0); let n = this.subComponentCountByName.get(this.componentName); return this.subComponentCountByName.set(this.componentName, n + 1), await e.build(t, `${ this.componentName }${ e.componentName.capitalizeFirstLetter() }${ n }`) } async build(e, t) { this._element = document.createElement("div"), t && (this._element.id = t); for (let e of this.getTemplateCloneNodes()) this._element.insertAdjacentElement("afterbegin", e); if (!this._element) throw new Error(`Fail building SceneComponent. ElementId: ${ t }`); return await this.buildSubComponents(e), e.insertAdjacentElement("beforeend", this._element), this._element } } }, 976: () => { String.prototype.isNullOrEmpty = function () { return "string" != typeof this && !this && "" !== this }, String.prototype.truncate = function (e, t = "...") { return (this.length > e ? this.substring(0, e) + t : this).toString() }, String.prototype.removeAccents = function () { return this.normalize("NFD").replace(/[\u0300-\u036f]/g, "") }, String.prototype.capitalizeFirstLetter = function () { return "string" != typeof this ? "" : this.charAt(0).toUpperCase() + this.substring(1) }, String.prototype.zeroBefore = function () { return this.padStart(2, "0") } }, 930: (e, t, n) => { n.d(t, { ObjectEventListener: () => o }); class o { eventsByName = new Map; addEventListener(e, t) { this.eventsByName.has(e.toLowerCase()) ? this.eventsByName.get(e.toLowerCase()).push(t) : this.eventsByName.set(e.toLowerCase(), [t]) } getEventsByName(e) { return this.eventsByName.has(e.toLowerCase()) || this.eventsByName.set(e.toLowerCase(), []), this.eventsByName.get(e.toLowerCase()) } callEventsByName(e, ...t) { this.getEventsByName(e).forEach((e => e(...t))) } } }, 353: (e, t, n) => { n.r(t), n.d(t, { audioElementHTML: () => u, createAudioComponent: () => i, createInvisiblePlayer: () => a, playButtonCSS: () => d, sourceElementHTML: () => l }), n(976); var o = n(319), s = n(164), r = n(173); async function i(e, t) { return await r.AudioComponent.createAudioComponent(e, t) } function a(e, t) { const n = document.createElement("div"); n.classList.add("audio-container"), n.insertAdjacentHTML("afterbegin", u(e, t)); const s = n.childNodes[0], r = function (e, t) { const n = document.createElement("button"); return n.classList.add("play-button"), setTimeout((() => { e.paused && n.classList.add("paused") }), 300), n.addEventListener("click", (() => { e.paused ? (e.play(), n.classList.remove("paused")) : (e.pause(), n.classList.add("paused")) })), function (e, t, n) { t.addEventListener("play", (() => { e.classList.remove("paused"), n && n.onPlay && n.onPlay(t), n && n.onplay && n.onplay(t) })), t.addEventListener("pause", (() => { e.classList.add("paused"), n && n.onPause && n.onPause(t), n && n.onpause && n.onpause(t) })) }(n, e, t), n }(s, t); return n.insertAdjacentElement("beforeend", r), document.body.insertAdjacentElement("afterbegin", n), (0, o.hideElement)(s), (0, o.hideElement)(r), n } function u(e, t) { return `<audio controls ${ t ? function (e) { return ` ${ e.id ? 'id="' + e.id + '"' : "" } ${ e.autoPlay || e.autoplay ? "autoplay" : "" } ${ e.muted ? "muted" : "" } ${ e.loop ? "loop" : "" } ${ e.preload ? 'preload="' + e.preload + '"' : "" }`.trimEnd() }(t) : "" }>\n    ${ e.map((e => l(e))).reduce(((e, t) => e + t), "") }\n  </audio>` } function l(e) { return `<source src="${ e }" type="audio/${ (0, s.getFileExtension)(e) }">` } function d() { return "\n    .play-button {\n      margin: 0;\n      padding: 0;\n      display: flex;\n      border: 0;\n      background: transparent;\n      box-sizing: border-box;\n      width: 0;\n      height: 34px;\n      border-color: transparent transparent transparent #202020;\n      transition: 100ms all ease;\n      cursor: pointer;\n      border-style: double;\n      border-width: 0px 0 0px 30px;\n    }\n\n    .play-button.paused {\n      border-style: solid;\n      border-width: 23px 0px 23px 34px;\n    }\n\n    .play-button:hover {\n      border-color: transparent transparent transparent #404040;\n    }\n  " } }, 319: (e, t, n) => { n.d(t, { hideElement: () => i }); const o = new Map, s = new Map, r = new Map; function i(e) { e.style.display = "block", e.style.position = "absolute", e.style.zIndex = "-1", e.style.opacity = "0", e.style.width = "0px !important", e.style.height = "0px !important", e.setAttribute("hidden", "") } new Map, window.addEventListener("keydown", (e => { e.repeat || function (e) { for (const t of o) e.code === t[0] && t[1].forEach((t => t(e))) }(e), function (e) { for (const t of s) e.code === t[0] && t[1].forEach((t => t(e))) }(e) })), window.addEventListener("keyup", (e => { for (const t of r) e.code === t[0] && t[1].forEach((t => t(e))) })) }, 164: (e, t, n) => { n.d(t, { getFileExtension: () => s }); var o = n(843); function s(e) { if ((0, o.isNullOrEmpty)(e)) return ""; const t = e.split(".").pop(); if (t && t !== e) return t; const n = e.split("/").pop(); return n && n !== e ? n : "" } }, 843: (e, t, n) => { function o(e) { return "string" != typeof e || !e || "" === e } n.d(t, { isNullOrEmpty: () => o }) } }, t = {}; function n(o) { var s = t[o]; if (void 0 !== s) return s.exports; var r = t[o] = { exports: {} }; return e[o](r, r.exports, n), r.exports } n.n = e => { var t = e && e.__esModule ? () => e.default : () => e; return n.d(t, { a: t }), t }, n.d = (e, t) => { for (var o in t) n.o(t, o) && !n.o(e, o) && Object.defineProperty(e, o, { enumerable: !0, get: t[o] }) }, n.o = (e, t) => Object.prototype.hasOwnProperty.call(e, t), n.r = e => { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(e, "__esModule", { value: !0 }) }; var o = n(353); AudioTools = o })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YWNrOi8vLy4vc3JjL0NvbXBvbmVudHMvQXVkaW9Db21wb25lbnRGYWN0b3J5LnRzIiwid2VicGFjazovLy8uL3NyYy9Db21wb25lbnRzL0NvbXBvbmVudENvbnRhaW5lci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvRXh0ZW5zaW9ucy9TdHJpbmdFeHRlbnNpb25zLnRzIiwid2VicGFjazovLy8uL3NyYy9FeHRyYXMvT2JqZWN0RXZlbnRMaXN0ZW5lci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvVG9vbHMvQXVkaW9Ub29scy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvVG9vbHMvRE9NVG9vbHMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL1Rvb2xzL0ZpbGVUb29scy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvVG9vbHMvU3RyaW5nVG9vbHMudHMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovLy93ZWJwYWNrL3J1bnRpbWUvY29tcGF0IGdldCBkZWZhdWx0IGV4cG9ydCIsIndlYnBhY2s6Ly8vd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovLy93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovLy93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovLy93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JqZWN0RXZlbnRMaXN0ZW5lciB9IGZyb20gJy4uL0V4dHJhcy9PYmplY3RFdmVudExpc3RlbmVyJztcclxuaW1wb3J0IHsgQXVkaW9Db21wb25lbnRGYWN0b3J5IH0gZnJvbSAnLi9BdWRpb0NvbXBvbmVudEZhY3RvcnknO1xyXG5cclxuZXhwb3J0IGNsYXNzIEF1ZGlvQ29tcG9uZW50IGV4dGVuZHMgT2JqZWN0RXZlbnRMaXN0ZW5lciB7XHJcbiAgcHVibGljIHNyYzogc3RyaW5nO1xyXG4gIHB1YmxpYyBhdWRpb0VsZW1lbnQ6IEhUTUxBdWRpb0VsZW1lbnQ7XHJcbiAgcHVibGljIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCBzcmM6IHN0cmluZywgYXVkaW9FbGVtZW50OiBIVE1MQXVkaW9FbGVtZW50LCBjb250YWluZXI6IEhUTUxFbGVtZW50LCBhdWRpb0VsZW1lbnRJZD86IHN0cmluZyApIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLnNyYyA9IHNyYztcclxuICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgdGhpcy5hdWRpb0VsZW1lbnQgPSBhdWRpb0VsZW1lbnQ7XHJcblxyXG4gICAgaWYgKCBhdWRpb0VsZW1lbnRJZCApIHtcclxuICAgICAgdGhpcy5hdWRpb0VsZW1lbnQuaWQgPSBhdWRpb0VsZW1lbnRJZDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmF1ZGlvRWxlbWVudC5jbGFzc0xpc3QuYWRkKCAnYXVkaW8tY29tcG9uZW50JyApO1xyXG5cclxuICAgIHRoaXMuY29udGFpbmVyLmlkID0gYXVkaW9FbGVtZW50SWQgKyAnQ29udGFpbmVyJztcclxuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoICdhdWRpby1jb250YWluZXInICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IHBhdXNlZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmF1ZGlvRWxlbWVudC5wYXVzZWQ7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGZpbGVOYW1lKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5hdWRpb0VsZW1lbnQuc3JjIHx8IHRoaXMuYXVkaW9FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoICdzb3VyY2UnICk/LnNyYyB8fCAnJztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgY3VycmVudFRpbWUoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmF1ZGlvRWxlbWVudC5jdXJyZW50VGltZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBwbGF5KCkge1xyXG4gICAgdmFyIHBsYXlQcm9taXNlID0gdGhpcy5hdWRpb0VsZW1lbnQucGxheSgpO1xyXG5cclxuICAgIGlmICggcGxheVByb21pc2UgIT09IHVuZGVmaW5lZCApIHtcclxuICAgICAgcGxheVByb21pc2UudGhlbiggXyA9PiB7IH0gKVxyXG4gICAgICAgIC5jYXRjaCggKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5zdG9wKCk7XHJcbiAgICAgICAgfSApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY2FsbEV2ZW50c0J5TmFtZSggJ29ucGxheScsIHRoaXMgKTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBhdXNlKCkge1xyXG4gICAgdGhpcy5hdWRpb0VsZW1lbnQucGF1c2UoKTtcclxuXHJcbiAgICB0aGlzLmNhbGxFdmVudHNCeU5hbWUoICdvbnBhdXNlJywgdGhpcyApO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RvcCgpIHtcclxuICAgIHRoaXMucGF1c2UoKTtcclxuICAgIHRoaXMuYXVkaW9FbGVtZW50LmN1cnJlbnRUaW1lID0gMDtcclxuXHJcbiAgICB0aGlzLmNhbGxFdmVudHNCeU5hbWUoICdvbnN0b3AnLCB0aGlzICk7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHB1YmxpYyB0b2dnbGUoKSB7XHJcbiAgICBpZiAoIHRoaXMucGF1c2VkICkge1xyXG4gICAgICB0aGlzLnBsYXkoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucGF1c2UoKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNhbGxFdmVudHNCeU5hbWUoICdvbnRvZ2dsZScsIHRoaXMgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgY3JlYXRlQXVkaW9Db21wb25lbnQoIHNyYzogc3RyaW5nLCBhdWRpb0VsZW1lbnRJZD86IHN0cmluZyApOiBQcm9taXNlPEF1ZGlvQ29tcG9uZW50PiB7XHJcbiAgICBjb25zdCBhdWRpb0NvbnRhaW5lciA9IGF3YWl0IG5ldyBBdWRpb0NvbXBvbmVudEZhY3RvcnkoIHNyYyApLmJ1aWxkKCBkb2N1bWVudC5ib2R5ICk7XHJcbiAgICBjb25zdCBjb250YWluZXIgPSBhdWRpb0NvbnRhaW5lcjtcclxuICAgIGNvbnN0IGVsZW1lbnQgPSBhdWRpb0NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCAnYXVkaW8nICkhO1xyXG4gICAgcmV0dXJuIG5ldyBBdWRpb0NvbXBvbmVudCggc3JjLCBlbGVtZW50LCBjb250YWluZXIsIGF1ZGlvRWxlbWVudElkICk7XHJcbiAgfVxyXG59IiwiaW1wb3J0IHsgQXVkaW9QbGF5ZXJDb25maWcsIGNyZWF0ZUludmlzaWJsZVBsYXllciB9IGZyb20gJy4uL1Rvb2xzL0F1ZGlvVG9vbHMnO1xyXG5pbXBvcnQgeyBDb21wb25lbnRDb250YWluZXIgfSBmcm9tICcuL0NvbXBvbmVudENvbnRhaW5lcic7XHJcblxyXG5leHBvcnQgY2xhc3MgQXVkaW9Db21wb25lbnRGYWN0b3J5IGV4dGVuZHMgQ29tcG9uZW50Q29udGFpbmVyIHtcclxuICBjb25zdHJ1Y3Rvciggc3JjOiBzdHJpbmcsIHBsYXllckNvbmZpZz86IEF1ZGlvUGxheWVyQ29uZmlnICkge1xyXG4gICAgc3VwZXIoIFwiYXVkaW9Db21wb25lbnRcIiwgY3JlYXRlSW52aXNpYmxlUGxheWVyKCBbc3JjXSwgcGxheWVyQ29uZmlnICkgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhc3luYyBidWlsZFN1YkNvbXBvbmVudHMoIHBhcmVudDogSFRNTEVsZW1lbnQgKTogUHJvbWlzZTxIVE1MRWxlbWVudFtdIHwgdm9pZD4ge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxufSIsImV4cG9ydCBhYnN0cmFjdCBjbGFzcyBDb21wb25lbnRDb250YWluZXIge1xyXG4gIHByb3RlY3RlZCBfZWxlbWVudDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcclxuICBwdWJsaWMgdGVtcGxhdGVFbGVtZW50OiBIVE1MVGVtcGxhdGVFbGVtZW50O1xyXG4gIHB1YmxpYyByZWFkb25seSBjb21wb25lbnROYW1lOiBzdHJpbmc7XHJcbiAgcHJvdGVjdGVkIHN1YkNvbXBvbmVudENvdW50QnlOYW1lOiBNYXA8c3RyaW5nLCBudW1iZXI+ID0gbmV3IE1hcCgpO1xyXG4gIHByb3RlY3RlZCBzdWJDb21wb25lbnRzOiBIVE1MRWxlbWVudFtdID0gW107XHJcblxyXG4gIC8vLyBUZW1wbGF0ZSBpcyBlaXRoZXIgYSBpZCBmb3IgYSBodG1sIHRlbXBsYXRlIGVsZW1lbnQgb3IgYW4gZWxlbWVudCB0aGF0IHdpbGwgYmUgaW5zZXJ0ZWQgYXMgYSB0ZW1wbGF0ZSBpbnNpZGUgZG9jdW1lbnQuYm9keVxyXG4gIGNvbnN0cnVjdG9yKCBjb21wb25lbnROYW1lOiBzdHJpbmcsIHRlbXBsYXRlOiBzdHJpbmcgfCBIVE1MRWxlbWVudCApIHtcclxuICAgIGlmICggdHlwZW9mIHRlbXBsYXRlID09PSAnc3RyaW5nJyApIHtcclxuICAgICAgY29uc3QgdGVtcGxhdGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIHRlbXBsYXRlICkgYXMgSFRNTFRlbXBsYXRlRWxlbWVudDtcclxuXHJcbiAgICAgIGlmICggIXRlbXBsYXRlRWxlbWVudCApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIFwiSW52YWxpZCB0ZW1wbGF0ZSBmb3Igc2NlbmUgY29tcG9uZW50LiBUZW1wbGF0ZSBpZDogXCIgKyB0ZW1wbGF0ZSApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLnRlbXBsYXRlRWxlbWVudCA9IHRlbXBsYXRlRWxlbWVudDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMudGVtcGxhdGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggXCJ0ZW1wbGF0ZVwiICk7XHJcbiAgICAgIHRoaXMudGVtcGxhdGVFbGVtZW50LmNvbnRlbnQuYXBwZW5kQ2hpbGQoIHRlbXBsYXRlICk7XHJcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIHRoaXMudGVtcGxhdGVFbGVtZW50ICk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jb21wb25lbnROYW1lID0gY29tcG9uZW50TmFtZTtcclxuICB9XHJcblxyXG4gIHByb3RlY3RlZCBnZXRUZW1wbGF0ZUNsb25lTm9kZXMoKTogSFRNTENvbGxlY3Rpb24ge1xyXG4gICAgcmV0dXJuICggdGhpcy50ZW1wbGF0ZUVsZW1lbnQuY29udGVudC5jbG9uZU5vZGUoIHRydWUgKSBhcyBEb2N1bWVudEZyYWdtZW50ICkuY2hpbGRyZW47XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYWJzdHJhY3QgYnVpbGRTdWJDb21wb25lbnRzKCBwYXJlbnQ6IEhUTUxFbGVtZW50ICk6IFByb21pc2U8SFRNTEVsZW1lbnRbXSB8IHZvaWQ+O1xyXG5cclxuICBwcm90ZWN0ZWQgYXN5bmMgYnVpbGRTaW5nbGVTdWJDb21wb25lbnQoIGNvbXBvbmVudDogQ29tcG9uZW50Q29udGFpbmVyLCBwYXJlbnQ6IEhUTUxFbGVtZW50ICk6IFByb21pc2U8SFRNTEVsZW1lbnQ+IHtcclxuICAgIGlmICggdGhpcy5zdWJDb21wb25lbnRDb3VudEJ5TmFtZS5oYXMoIHRoaXMuY29tcG9uZW50TmFtZSApICkge1xyXG4gICAgICB0aGlzLnN1YkNvbXBvbmVudENvdW50QnlOYW1lLnNldCggdGhpcy5jb21wb25lbnROYW1lLCAwICk7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGNvbXBvbmVudENvdW50ID0gdGhpcy5zdWJDb21wb25lbnRDb3VudEJ5TmFtZS5nZXQoIHRoaXMuY29tcG9uZW50TmFtZSApITtcclxuXHJcbiAgICB0aGlzLnN1YkNvbXBvbmVudENvdW50QnlOYW1lLnNldCggdGhpcy5jb21wb25lbnROYW1lLCBjb21wb25lbnRDb3VudCArIDEgKTtcclxuXHJcbiAgICByZXR1cm4gYXdhaXQgY29tcG9uZW50LmJ1aWxkKCBwYXJlbnQsIGAkeyB0aGlzLmNvbXBvbmVudE5hbWUgfSR7IGNvbXBvbmVudC5jb21wb25lbnROYW1lLmNhcGl0YWxpemVGaXJzdExldHRlcigpIH0keyBjb21wb25lbnRDb3VudCB9YCApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFzeW5jIGJ1aWxkKCBwYXJlbnQ6IEhUTUxFbGVtZW50LCBlbGVtZW50SWQ/OiBzdHJpbmcgKTogUHJvbWlzZTxIVE1MRWxlbWVudD4ge1xyXG4gICAgdGhpcy5fZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnICk7XHJcblxyXG4gICAgaWYgKCBlbGVtZW50SWQgKSB7XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQuaWQgPSBlbGVtZW50SWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZm9yICggbGV0IGl0ZW0gb2YgdGhpcy5nZXRUZW1wbGF0ZUNsb25lTm9kZXMoKSApIHtcclxuICAgICAgdGhpcy5fZWxlbWVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQoICdhZnRlcmJlZ2luJywgaXRlbSApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICggIXRoaXMuX2VsZW1lbnQgKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvciggYEZhaWwgYnVpbGRpbmcgU2NlbmVDb21wb25lbnQuIEVsZW1lbnRJZDogJHsgZWxlbWVudElkIH1gICk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgdGhpcy5idWlsZFN1YkNvbXBvbmVudHMoIHBhcmVudCApO1xyXG5cclxuICAgIHBhcmVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQoICdiZWZvcmVlbmQnLCB0aGlzLl9lbGVtZW50ICk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgfVxyXG59IiwiXHJcbmludGVyZmFjZSBTdHJpbmcge1xyXG4gIHRydW5jYXRlKCBtYXg6IG51bWJlciwgZGVjb3JhdG9yOiBzdHJpbmcgKTogc3RyaW5nO1xyXG4gIHJlbW92ZUFjY2VudHMoKTogc3RyaW5nO1xyXG4gIGNhcGl0YWxpemVGaXJzdExldHRlcigpOiBzdHJpbmc7XHJcbiAgemVyb0JlZm9yZSgpOiBzdHJpbmc7XHJcbiAgaXNOdWxsT3JFbXB0eSgpOiBib29sZWFuO1xyXG59XHJcblxyXG5TdHJpbmcucHJvdG90eXBlLmlzTnVsbE9yRW1wdHkgPSBmdW5jdGlvbiAoKTogYm9vbGVhbiB7XHJcbiAgcmV0dXJuIHR5cGVvZiB0aGlzICE9PSAnc3RyaW5nJyAmJiAhdGhpcyAmJiB0aGlzICE9PSAnJztcclxufTtcclxuXHJcblN0cmluZy5wcm90b3R5cGUudHJ1bmNhdGUgPSBmdW5jdGlvbiAoIG1heDogbnVtYmVyLCBkZWNvcmF0b3I6IHN0cmluZyA9ICcuLi4nICk6IHN0cmluZyB7XHJcbiAgcmV0dXJuICggdGhpcy5sZW5ndGggPiBtYXggPyB0aGlzLnN1YnN0cmluZyggMCwgbWF4ICkgKyBkZWNvcmF0b3IgOiB0aGlzICkudG9TdHJpbmcoKTtcclxufTtcclxuXHJcblN0cmluZy5wcm90b3R5cGUucmVtb3ZlQWNjZW50cyA9IGZ1bmN0aW9uICgpIHtcclxuICByZXR1cm4gdGhpcy5ub3JtYWxpemUoICdORkQnICkucmVwbGFjZSggL1tcXHUwMzAwLVxcdTAzNmZdL2csIFwiXCIgKTtcclxufVxyXG5cclxuU3RyaW5nLnByb3RvdHlwZS5jYXBpdGFsaXplRmlyc3RMZXR0ZXIgPSBmdW5jdGlvbiAoKTogc3RyaW5nIHtcclxuICBpZiAoIHR5cGVvZiB0aGlzICE9PSAnc3RyaW5nJyApIHtcclxuICAgIHJldHVybiAnJztcclxuICB9XHJcblxyXG4gIHJldHVybiB0aGlzLmNoYXJBdCggMCApLnRvVXBwZXJDYXNlKCkgKyB0aGlzLnN1YnN0cmluZyggMSApO1xyXG59XHJcblxyXG5TdHJpbmcucHJvdG90eXBlLnplcm9CZWZvcmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgcmV0dXJuIHRoaXMucGFkU3RhcnQoIDIsICcwJyApO1xyXG59IiwiXHJcbmV4cG9ydCBjbGFzcyBPYmplY3RFdmVudExpc3RlbmVyIHtcclxuICBwdWJsaWMgZXZlbnRzQnlOYW1lOiBNYXA8c3RyaW5nLCBGdW5jdGlvbltdPiA9IG5ldyBNYXAoKTtcclxuXHJcbiAgcHVibGljIGFkZEV2ZW50TGlzdGVuZXIoIGV2ZW50TmFtZTogc3RyaW5nLCBldmVudDogRnVuY3Rpb24gKSB7XHJcbiAgICBpZiAoICF0aGlzLmV2ZW50c0J5TmFtZS5oYXMoIGV2ZW50TmFtZS50b0xvd2VyQ2FzZSgpICkgKSB7XHJcbiAgICAgIHRoaXMuZXZlbnRzQnlOYW1lLnNldCggZXZlbnROYW1lLnRvTG93ZXJDYXNlKCksIFtldmVudF0gKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZXZlbnRzQnlOYW1lLmdldCggZXZlbnROYW1lLnRvTG93ZXJDYXNlKCkgKSEucHVzaCggZXZlbnQgKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRFdmVudHNCeU5hbWUoIGV2ZW50TmFtZTogc3RyaW5nICk6IEZ1bmN0aW9uW10ge1xyXG4gICAgaWYgKCAhdGhpcy5ldmVudHNCeU5hbWUuaGFzKCBldmVudE5hbWUudG9Mb3dlckNhc2UoKSApICkge1xyXG4gICAgICB0aGlzLmV2ZW50c0J5TmFtZS5zZXQoIGV2ZW50TmFtZS50b0xvd2VyQ2FzZSgpLCBbXSApO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmV2ZW50c0J5TmFtZS5nZXQoIGV2ZW50TmFtZS50b0xvd2VyQ2FzZSgpICkhO1xyXG4gIH1cclxuXHJcblxyXG4gIHB1YmxpYyBjYWxsRXZlbnRzQnlOYW1lKCBldmVudE5hbWU6IHN0cmluZywgLi4uZXZlbnRBcmdzOiBhbnlbXSApOiB2b2lkIHtcclxuICAgIHRoaXMuZ2V0RXZlbnRzQnlOYW1lKCBldmVudE5hbWUgKS5mb3JFYWNoKCBlID0+IGUoIC4uLmV2ZW50QXJncyApICk7XHJcbiAgfVxyXG59IiwiaW1wb3J0ICcuLi9FeHRlbnNpb25zL1N0cmluZ0V4dGVuc2lvbnMnO1xyXG5pbXBvcnQgeyBoaWRlRWxlbWVudCB9IGZyb20gJy4vRE9NVG9vbHMnO1xyXG5pbXBvcnQgeyBnZXRGaWxlRXh0ZW5zaW9uIH0gZnJvbSAnLi9GaWxlVG9vbHMnO1xyXG5pbXBvcnQgeyBBdWRpb0NvbXBvbmVudCB9IGZyb20gJy4uL0NvbXBvbmVudHMvQXVkaW9Db21wb25lbnQnO1xyXG5cclxuZXhwb3J0IHR5cGUgQXVkaW9QbGF5ZXJDb25maWcgPSB7XHJcbiAgaWQ/OiBzdHJpbmc7XHJcbiAgYXV0b1BsYXk/OiBib29sZWFuO1xyXG4gIGF1dG9wbGF5PzogYm9vbGVhbjtcclxuICBtdXRlZD86IGJvb2xlYW47XHJcbiAgbG9vcD86IGJvb2xlYW47XHJcbiAgcHJlbG9hZD86ICdhdXRvJyB8ICdtZXRhZGF0YScgfCAnbm9uZSc7XHJcbiAgb25wbGF5PzogKCBhdWRpb0VsZW1lbnQ6IEhUTUxBdWRpb0VsZW1lbnQgKSA9PiB2b2lkO1xyXG4gIG9ucGF1c2U/OiAoIGF1ZGlvRWxlbWVudDogSFRNTEF1ZGlvRWxlbWVudCApID0+IHZvaWQ7XHJcbiAgb25QbGF5PzogKCBhdWRpb0VsZW1lbnQ6IEhUTUxBdWRpb0VsZW1lbnQgKSA9PiB2b2lkO1xyXG4gIG9uUGF1c2U/OiAoIGF1ZGlvRWxlbWVudDogSFRNTEF1ZGlvRWxlbWVudCApID0+IHZvaWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBdWRpb0NvbXBvbmVudCggc3JjOiBzdHJpbmcsIGVsZW1lbnRJZD86IHN0cmluZyApIHtcclxuICByZXR1cm4gYXdhaXQgQXVkaW9Db21wb25lbnQuY3JlYXRlQXVkaW9Db21wb25lbnQoIHNyYywgZWxlbWVudElkICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVJbnZpc2libGVQbGF5ZXIoIGFyclNvdXJjZXM6IHN0cmluZ1tdLCBwbGF5ZXJDb25maWc/OiBBdWRpb1BsYXllckNvbmZpZyApIHtcclxuICBjb25zdCBjb250YWluZXJEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApO1xyXG4gIGNvbnRhaW5lckRpdi5jbGFzc0xpc3QuYWRkKCAnYXVkaW8tY29udGFpbmVyJyApO1xyXG4gIGNvbnRhaW5lckRpdi5pbnNlcnRBZGphY2VudEhUTUwoICdhZnRlcmJlZ2luJywgYXVkaW9FbGVtZW50SFRNTCggYXJyU291cmNlcywgcGxheWVyQ29uZmlnICkgKTtcclxuXHJcbiAgY29uc3QgYXVkaW9FbGVtZW50ID0gY29udGFpbmVyRGl2LmNoaWxkTm9kZXNbMF0gYXMgSFRNTEF1ZGlvRWxlbWVudDtcclxuICBjb25zdCBwbGF5QnV0dG9uID0gZ2V0UGxheUJ1dHRvbkVsZW1lbnQoIGF1ZGlvRWxlbWVudCwgcGxheWVyQ29uZmlnICk7XHJcbiAgY29udGFpbmVyRGl2Lmluc2VydEFkamFjZW50RWxlbWVudCggJ2JlZm9yZWVuZCcsIHBsYXlCdXR0b24gKTtcclxuXHJcbiAgZG9jdW1lbnQuYm9keS5pbnNlcnRBZGphY2VudEVsZW1lbnQoICdhZnRlcmJlZ2luJywgY29udGFpbmVyRGl2ICk7XHJcblxyXG4gIGhpZGVFbGVtZW50KCBhdWRpb0VsZW1lbnQgKTtcclxuICBoaWRlRWxlbWVudCggcGxheUJ1dHRvbiApO1xyXG4gIHJldHVybiBjb250YWluZXJEaXY7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhdWRpb0VsZW1lbnRIVE1MKCBhcnJTb3VyY2VzOiBzdHJpbmdbXSwgcGxheWVyQ29uZmlnPzogQXVkaW9QbGF5ZXJDb25maWcgKSB7XHJcbiAgcmV0dXJuIGA8YXVkaW8gY29udHJvbHMgJHsgcGxheWVyQ29uZmlnID8gYXVkaW9FbGVtZW50UGFyYW1zQnlQbGF5ZXJDb25maWcoIHBsYXllckNvbmZpZyApIDogXCJcIiB9PlxyXG4gICAgJHsgYXJyU291cmNlcy5tYXAoIHNyYyA9PiBzb3VyY2VFbGVtZW50SFRNTCggc3JjICkgKS5yZWR1Y2UoICggYWNjLCBuZXh0ICkgPT4gYWNjICsgbmV4dCwgJycgKSB9XHJcbiAgPC9hdWRpbz5gO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc291cmNlRWxlbWVudEhUTUwoIHNyYzogc3RyaW5nICkge1xyXG4gIHJldHVybiBgPHNvdXJjZSBzcmM9XCIkeyBzcmMgfVwiIHR5cGU9XCJhdWRpby8keyBnZXRGaWxlRXh0ZW5zaW9uKCBzcmMgKSB9XCI+YDtcclxufVxyXG5cclxuZnVuY3Rpb24gYXVkaW9FbGVtZW50UGFyYW1zQnlQbGF5ZXJDb25maWcoIHBsYXllckNvbmZpZzogQXVkaW9QbGF5ZXJDb25maWcgKSB7XHJcbiAgY29uc3QgcGFyYW1JZCA9IHBsYXllckNvbmZpZy5pZCA/ICdpZD1cIicgKyBwbGF5ZXJDb25maWcuaWQgKyAnXCInIDogJyc7XHJcbiAgY29uc3QgcGFyYW1BdXRvUGxheSA9IHBsYXllckNvbmZpZy5hdXRvUGxheSB8fCBwbGF5ZXJDb25maWcuYXV0b3BsYXkgPyAnYXV0b3BsYXknIDogJyc7XHJcbiAgY29uc3QgcGFyYW1NdXRlZCA9IHBsYXllckNvbmZpZy5tdXRlZCA/ICdtdXRlZCcgOiAnJztcclxuICBjb25zdCBwYXJhbUxvb3AgPSBwbGF5ZXJDb25maWcubG9vcCA/ICdsb29wJyA6ICcnO1xyXG4gIGNvbnN0IHBhcmFtUHJlbG9hZCA9IHBsYXllckNvbmZpZy5wcmVsb2FkID8gJ3ByZWxvYWQ9XCInICsgcGxheWVyQ29uZmlnLnByZWxvYWQgKyAnXCInIDogJyc7XHJcblxyXG4gIHJldHVybiBgICR7IHBhcmFtSWQgfSAkeyBwYXJhbUF1dG9QbGF5IH0gJHsgcGFyYW1NdXRlZCB9ICR7IHBhcmFtTG9vcCB9ICR7IHBhcmFtUHJlbG9hZCB9YC50cmltRW5kKCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFBsYXlCdXR0b25FbGVtZW50KCBhdWRpb0VsZW1lbnQ6IEhUTUxBdWRpb0VsZW1lbnQsIHBsYXllckNvbmZpZz86IEF1ZGlvUGxheWVyQ29uZmlnICkge1xyXG4gIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnYnV0dG9uJyApO1xyXG4gIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCggJ3BsYXktYnV0dG9uJyApO1xyXG5cclxuICBzZXRUaW1lb3V0KCAoKSA9PiB7XHJcbiAgICBpZiAoIGF1ZGlvRWxlbWVudC5wYXVzZWQgKSB7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZCggJ3BhdXNlZCcgKTtcclxuICAgIH1cclxuICB9LCAzMDAgKTtcclxuXHJcbiAgYnV0dG9uRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCAnY2xpY2snLCAoKSA9PiB7XHJcbiAgICBpZiAoIGF1ZGlvRWxlbWVudC5wYXVzZWQgKSB7XHJcbiAgICAgIGF1ZGlvRWxlbWVudC5wbGF5KCk7XHJcbiAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSggJ3BhdXNlZCcgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGF1ZGlvRWxlbWVudC5wYXVzZSgpO1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoICdwYXVzZWQnICk7XHJcbiAgICB9XHJcbiAgfSApO1xyXG5cclxuICBzZXRBdWRpb0VsZW1lbnRQbGF5UGF1c2VFdmVudHMoIGJ1dHRvbkVsZW1lbnQsIGF1ZGlvRWxlbWVudCwgcGxheWVyQ29uZmlnICk7XHJcblxyXG4gIHJldHVybiBidXR0b25FbGVtZW50O1xyXG59XHJcblxyXG5cclxuZnVuY3Rpb24gc2V0QXVkaW9FbGVtZW50UGxheVBhdXNlRXZlbnRzKCBidXR0b25FbGVtZW50OiBIVE1MQnV0dG9uRWxlbWVudCwgYXVkaW9FbGVtZW50OiBIVE1MQXVkaW9FbGVtZW50LCBwbGF5ZXJDb25maWc/OiBBdWRpb1BsYXllckNvbmZpZyApIHtcclxuICBhdWRpb0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ3BsYXknLCAoKSA9PiB7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoICdwYXVzZWQnICk7XHJcbiAgICBpZiAoIHBsYXllckNvbmZpZyAmJiBwbGF5ZXJDb25maWcub25QbGF5ICkge1xyXG4gICAgICBwbGF5ZXJDb25maWcub25QbGF5KCBhdWRpb0VsZW1lbnQgKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIHBsYXllckNvbmZpZyAmJiBwbGF5ZXJDb25maWcub25wbGF5ICkge1xyXG4gICAgICBwbGF5ZXJDb25maWcub25wbGF5KCBhdWRpb0VsZW1lbnQgKTtcclxuICAgIH1cclxuICB9ICk7XHJcblxyXG4gIGF1ZGlvRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCAncGF1c2UnLCAoKSA9PiB7XHJcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoICdwYXVzZWQnICk7XHJcbiAgICBpZiAoIHBsYXllckNvbmZpZyAmJiBwbGF5ZXJDb25maWcub25QYXVzZSApIHtcclxuICAgICAgcGxheWVyQ29uZmlnLm9uUGF1c2UoIGF1ZGlvRWxlbWVudCApO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICggcGxheWVyQ29uZmlnICYmIHBsYXllckNvbmZpZy5vbnBhdXNlICkge1xyXG4gICAgICBwbGF5ZXJDb25maWcub25wYXVzZSggYXVkaW9FbGVtZW50ICk7XHJcbiAgICB9XHJcbiAgfSApO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBsYXlCdXR0b25DU1MoKSB7XHJcbiAgcmV0dXJuIGBcclxuICAgIC5wbGF5LWJ1dHRvbiB7XHJcbiAgICAgIG1hcmdpbjogMDtcclxuICAgICAgcGFkZGluZzogMDtcclxuICAgICAgZGlzcGxheTogZmxleDtcclxuICAgICAgYm9yZGVyOiAwO1xyXG4gICAgICBiYWNrZ3JvdW5kOiB0cmFuc3BhcmVudDtcclxuICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDtcclxuICAgICAgd2lkdGg6IDA7XHJcbiAgICAgIGhlaWdodDogMzRweDtcclxuICAgICAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCAjMjAyMDIwO1xyXG4gICAgICB0cmFuc2l0aW9uOiAxMDBtcyBhbGwgZWFzZTtcclxuICAgICAgY3Vyc29yOiBwb2ludGVyO1xyXG4gICAgICBib3JkZXItc3R5bGU6IGRvdWJsZTtcclxuICAgICAgYm9yZGVyLXdpZHRoOiAwcHggMCAwcHggMzBweDtcclxuICAgIH1cclxuXHJcbiAgICAucGxheS1idXR0b24ucGF1c2VkIHtcclxuICAgICAgYm9yZGVyLXN0eWxlOiBzb2xpZDtcclxuICAgICAgYm9yZGVyLXdpZHRoOiAyM3B4IDBweCAyM3B4IDM0cHg7XHJcbiAgICB9XHJcblxyXG4gICAgLnBsYXktYnV0dG9uOmhvdmVyIHtcclxuICAgICAgYm9yZGVyLWNvbG9yOiB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCB0cmFuc3BhcmVudCAjNDA0MDQwO1xyXG4gICAgfVxyXG4gIGA7XHJcbn0iLCJpbXBvcnQgeyBEaW1lbnNpb25zLCBQb2ludDJELCBsZXJwLCByZWdleE51bWJlclBhdHRlcm4sIHJvdGF0ZUNvb3JkaW5hdGVzLCByb3RhdGVDb29yZGluYXRlc0Zyb21Qb2ludDJEIH0gZnJvbSAnLi9NYXRoVG9vbHMnO1xyXG5pbXBvcnQgeyB0b1Bob25lTnVtYmVyIH0gZnJvbSAnLi9TdHJpbmdUb29scyc7XHJcbmltcG9ydCB7IENvbGxpc2lvbkRpcmVjdGlvbkNoZWNrLCBCb3JkZXJEaXN0YW5jZSB9IGZyb20gJy4uL0V4dHJhcy9Db2xsaXNpb25FdmVudHMvVHlwZXMnO1xyXG5cclxuZXhwb3J0IHR5cGUgS2V5Ym9hcmRFdmVudENhbGxiYWNrID0gKCBldnQ6IEtleWJvYXJkRXZlbnQgKSA9PiB2b2lkO1xyXG5leHBvcnQgY29uc3QgcmVnZXhSZW1vdmVUcmFuc2xhdGVGcm9tVHJhbnNmb3JtID0gL3RyYW5zbGF0ZVxcKFteKV0qXFwpL2c7XHJcbmV4cG9ydCBjb25zdCByZWdleEdyb3VwUm90YXRlVmFsdWUgPSAvcm90YXRlXFwoKC0/XFxkK1xcLj9cXGQqKWRlZ1xcKS87XHJcbmV4cG9ydCBjb25zdCByZWdleEdyb3VwUm90YXRlWFZhbHVlID0gL3JvdGF0ZVhcXCgoLT9cXGQrXFwuP1xcZCopZGVnXFwpLztcclxuZXhwb3J0IGNvbnN0IHJlZ2V4R3JvdXBSb3RhdGVZVmFsdWUgPSAvcm90YXRlWVxcKCgtP1xcZCtcXC4/XFxkKilkZWdcXCkvO1xyXG5leHBvcnQgY29uc3QgcmVnZXhHcm91cFJvdGF0ZVpWYWx1ZSA9IC9yb3RhdGVaXFwoKC0/XFxkK1xcLj9cXGQqKWRlZ1xcKS87XHJcblxyXG5leHBvcnQgY29uc3QgZGljdEtleXNCeUFjdGlvbktleWRvd25PbmNlID0gbmV3IE1hcDxzdHJpbmcsIEtleWJvYXJkRXZlbnRDYWxsYmFja1tdPigpO1xyXG5leHBvcnQgY29uc3QgZGljdEtleXNCeUFjdGlvbktleWRvd25SZXBlYXQgPSBuZXcgTWFwPHN0cmluZywgS2V5Ym9hcmRFdmVudENhbGxiYWNrW10+KCk7XHJcbmV4cG9ydCBjb25zdCBkaWN0S2V5c0J5QWN0aW9uS2V5dXAgPSBuZXcgTWFwPHN0cmluZywgS2V5Ym9hcmRFdmVudENhbGxiYWNrW10+KCk7XHJcbmV4cG9ydCBmdW5jdGlvbiBhZGRBY3Rpb25LZXkoIHsga2V5LCBrZXlkb3duOiBldmVudEtleWRvd24sIGtleXVwOiBldmVudEtleXVwLCBleGVjdXRlT25seU9uY2UgPSB0cnVlIH06IHsga2V5OiBzdHJpbmc7IGtleWRvd246IEtleWJvYXJkRXZlbnRDYWxsYmFjazsga2V5dXA/OiBLZXlib2FyZEV2ZW50Q2FsbGJhY2s7IGV4ZWN1dGVPbmx5T25jZT86IGJvb2xlYW47IH0gKSB7XHJcbiAgaWYgKCBleGVjdXRlT25seU9uY2UgKSB7XHJcbiAgICBhZGRBY3Rpb25LZXlSdW5PbmNlKCBrZXksIGV2ZW50S2V5ZG93biwgZXZlbnRLZXl1cCApO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgYWRkQWN0aW9uS2V5UnVuT25SZXBlYXQoIGtleSwgZXZlbnRLZXlkb3duLCBldmVudEtleXVwICk7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIFNhZmVQcm9taXNlPFQ+ID0ge1xyXG4gIGRhdGE6IFQgfCBudWxsO1xyXG4gIGVycm9yOiBFcnJvciB8IG51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVQcm9taXNlPFQ+KCBwcm9taXNlOiBQcm9taXNlPFQ+ICk6IFByb21pc2U8U2FmZVByb21pc2U8VD4+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHByb21pc2U7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZGF0YTogZGF0YSxcclxuICAgICAgZXJyb3I6IG51bGxcclxuICAgIH07XHJcbiAgfSBjYXRjaCAoIGVycm9yICkge1xyXG4gICAgY29uc29sZS5lcnJvciggZXJyb3IgKTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBkYXRhOiBudWxsLFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKCBTdHJpbmcoIGVycm9yICkgKVxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50RnJvbUhUTUwoIGh0bWw6IHN0cmluZywgdHJpbTogYm9vbGVhbiA9IHRydWUgKSB7XHJcbiAgaHRtbCA9IHRyaW0gPyBodG1sLnRyaW0oKSA6IGh0bWw7XHJcblxyXG4gIGlmICggIWh0bWwgKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIGNvbnN0IHRlbXBsYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RlbXBsYXRlJyApO1xyXG4gIHRlbXBsYXRlLmlubmVySFRNTCA9IGh0bWw7XHJcbiAgY29uc3QgcmVzdWx0ID0gdGVtcGxhdGUuY29udGVudC5jaGlsZHJlbjtcclxuXHJcbiAgaWYgKCByZXN1bHQubGVuZ3RoID09PSAxICkge1xyXG4gICAgcmV0dXJuIHJlc3VsdFswXSBhcyBIVE1MRWxlbWVudDtcclxuICB9XHJcblxyXG4gIHJldHVybiBBcnJheS5mcm9tKCByZXN1bHQgKSBhcyBIVE1MRWxlbWVudFtdO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxlbWVudERpbWVuc2lvbnNCeUlkKCBlbGVtZW50SWQ6IHN0cmluZyApOiBEaW1lbnNpb25zIHtcclxuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIGVsZW1lbnRJZCApO1xyXG5cclxuICBpZiAoICFlbGVtZW50ICkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCBcIkludmFsaWQgZWxlbWVudCBhdCBnZXRFbGVtZW50RGltZW5zaW9uc0J5SWQgd2l0aCBpZDogXCIgKyBlbGVtZW50SWQgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBnZXRFbGVtZW50RGltZW5zaW9ucyggZWxlbWVudCApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxlbWVudERpbWVuc2lvbnMoIGVsZW1lbnQ6IEhUTUxFbGVtZW50ICk6IERpbWVuc2lvbnMge1xyXG4gIHZhciByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHdpZHRoOiByZWN0LndpZHRoLFxyXG4gICAgaGVpZ2h0OiByZWN0LmhlaWdodFxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJvdGF0ZWRCb3VuZGluZ0JveEJhc2VkT25Cb2R5Um90YXRpb24oIGVsZW1lbnQ6IEhUTUxFbGVtZW50ICk6IERPTVJlY3Qge1xyXG4gIGNvbnN0IHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gIGNvbnN0IGNlbnRlclggPSByZWN0LmxlZnQgKyByZWN0LndpZHRoIC8gMjtcclxuICBjb25zdCBjZW50ZXJZID0gcmVjdC50b3AgKyByZWN0LmhlaWdodCAvIDI7XHJcblxyXG4gIC8vIFJvdGF0aW9uIGFuZ2xlIGluIGRlZ3JlZXMgKGV4dHJhY3RlZCBmcm9tIHN0eWxlLnRyYW5zZm9ybSBvciBhbnkgb3RoZXIgc291cmNlKVxyXG4gIGNvbnN0IHJvdGF0aW9uQW5nbGUgPSBnZXRCb2R5Um90YXRpb25JbkRlZ3JlZXMoKTtcclxuXHJcbiAgY29uc3QgcmFkaWFucyA9ICggTWF0aC5QSSAvIDE4MCApICogcm90YXRpb25BbmdsZTtcclxuICBjb25zdCBjb3NUaGV0YSA9IE1hdGguY29zKCByYWRpYW5zICk7XHJcbiAgY29uc3Qgc2luVGhldGEgPSBNYXRoLnNpbiggcmFkaWFucyApO1xyXG5cclxuICAvLyBDYWxjdWxhdGUgdGhlIHJvdGF0ZWQgY29vcmRpbmF0ZXNcclxuICBjb25zdCByb3RhdGVkWDEgPSBjZW50ZXJYICsgKCByZWN0LmxlZnQgLSBjZW50ZXJYICkgKiBjb3NUaGV0YSAtICggcmVjdC50b3AgLSBjZW50ZXJZICkgKiBzaW5UaGV0YTtcclxuICBjb25zdCByb3RhdGVkWTEgPSBjZW50ZXJZICsgKCByZWN0LmxlZnQgLSBjZW50ZXJYICkgKiBzaW5UaGV0YSArICggcmVjdC50b3AgLSBjZW50ZXJZICkgKiBjb3NUaGV0YTtcclxuXHJcbiAgY29uc3Qgcm90YXRlZFgyID0gY2VudGVyWCArICggcmVjdC5yaWdodCAtIGNlbnRlclggKSAqIGNvc1RoZXRhIC0gKCByZWN0LmJvdHRvbSAtIGNlbnRlclkgKSAqIHNpblRoZXRhO1xyXG4gIGNvbnN0IHJvdGF0ZWRZMiA9IGNlbnRlclkgKyAoIHJlY3QucmlnaHQgLSBjZW50ZXJYICkgKiBzaW5UaGV0YSArICggcmVjdC5ib3R0b20gLSBjZW50ZXJZICkgKiBjb3NUaGV0YTtcclxuXHJcbiAgLy8gQ2FsY3VsYXRlIGxlZnQsIHRvcCwgYm90dG9tLCBhbmQgcmlnaHQgY29vcmRpbmF0ZXNcclxuICBjb25zdCByb3RhdGVkTGVmdCA9IE1hdGgubWluKCByb3RhdGVkWDEsIHJvdGF0ZWRYMiApO1xyXG4gIGNvbnN0IHJvdGF0ZWRUb3AgPSBNYXRoLm1pbiggcm90YXRlZFkxLCByb3RhdGVkWTIgKTtcclxuICBjb25zdCByb3RhdGVkQm90dG9tID0gTWF0aC5tYXgoIHJvdGF0ZWRZMSwgcm90YXRlZFkyICk7XHJcbiAgY29uc3Qgcm90YXRlZFJpZ2h0ID0gTWF0aC5tYXgoIHJvdGF0ZWRYMSwgcm90YXRlZFgyICk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICB4OiByb3RhdGVkTGVmdCxcclxuICAgIHk6IHJvdGF0ZWRUb3AsXHJcbiAgICB3aWR0aDogcmVjdC53aWR0aCxcclxuICAgIGhlaWdodDogcmVjdC5oZWlnaHQsXHJcbiAgICB0b0pTT046IHJlY3QudG9KU09OLFxyXG4gICAgbGVmdDogcm90YXRlZExlZnQsXHJcbiAgICB0b3A6IHJvdGF0ZWRUb3AsXHJcbiAgICBib3R0b206IHJvdGF0ZWRCb3R0b20sXHJcbiAgICByaWdodDogcm90YXRlZFJpZ2h0LFxyXG4gIH0gYXMgRE9NUmVjdDtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkQWN0aW9uS2V5UnVuT25jZSgga2V5OiBzdHJpbmcsIGV2ZW50S2V5ZG93bjogS2V5Ym9hcmRFdmVudENhbGxiYWNrLCBldmVudEtleXVwPzogS2V5Ym9hcmRFdmVudENhbGxiYWNrICkge1xyXG4gIGlmICggZGljdEtleXNCeUFjdGlvbktleWRvd25PbmNlLmhhcygga2V5ICkgKSB7XHJcbiAgICBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93bk9uY2Uuc2V0KCBrZXksIFtldmVudEtleWRvd24sIC4uLmRpY3RLZXlzQnlBY3Rpb25LZXlkb3duT25jZS5nZXQoIGtleSApIV0gKVxyXG4gIH0gZWxzZSB7XHJcbiAgICBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93bk9uY2Uuc2V0KCBrZXksIFtldmVudEtleWRvd25dIClcclxuICB9XHJcblxyXG4gIGlmICggZXZlbnRLZXl1cCApIHtcclxuICAgIGlmICggZGljdEtleXNCeUFjdGlvbktleXVwLmhhcygga2V5ICkgKSB7XHJcbiAgICAgIGRpY3RLZXlzQnlBY3Rpb25LZXl1cC5zZXQoIGtleSwgW2V2ZW50S2V5dXAsIC4uLmRpY3RLZXlzQnlBY3Rpb25LZXl1cC5nZXQoIGtleSApIV0gKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGljdEtleXNCeUFjdGlvbktleXVwLnNldCgga2V5LCBbZXZlbnRLZXl1cF0gKVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gYWRkQWN0aW9uS2V5UnVuT25SZXBlYXQoIGtleTogc3RyaW5nLCBldmVudEtleWRvd246IEtleWJvYXJkRXZlbnRDYWxsYmFjaywgZXZlbnRLZXl1cD86IEtleWJvYXJkRXZlbnRDYWxsYmFjayApIHtcclxuICBpZiAoIGRpY3RLZXlzQnlBY3Rpb25LZXlkb3duUmVwZWF0Lmhhcygga2V5ICkgKSB7XHJcbiAgICBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93blJlcGVhdC5zZXQoIGtleSwgW2V2ZW50S2V5ZG93biwgLi4uZGljdEtleXNCeUFjdGlvbktleWRvd25SZXBlYXQuZ2V0KCBrZXkgKSFdIClcclxuICB9IGVsc2Uge1xyXG4gICAgZGljdEtleXNCeUFjdGlvbktleWRvd25SZXBlYXQuc2V0KCBrZXksIFtldmVudEtleWRvd25dIClcclxuICB9XHJcblxyXG4gIGlmICggZXZlbnRLZXl1cCApIHtcclxuICAgIGlmICggZGljdEtleXNCeUFjdGlvbktleXVwLmhhcygga2V5ICkgKSB7XHJcbiAgICAgIGRpY3RLZXlzQnlBY3Rpb25LZXl1cC5zZXQoIGtleSwgW2V2ZW50S2V5dXAsIC4uLmRpY3RLZXlzQnlBY3Rpb25LZXl1cC5nZXQoIGtleSApIV0gKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGljdEtleXNCeUFjdGlvbktleXVwLnNldCgga2V5LCBbZXZlbnRLZXl1cF0gKVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrRWxlbWVudENvbGxpc2lvbiggZWxlbWVudDE6IEhUTUxFbGVtZW50LCBlbGVtZW50MjogSFRNTEVsZW1lbnQsIGNoZWNrQm9keVJvdGF0aW9uOiBib29sZWFuID0gZmFsc2UgKTogYm9vbGVhbiB7XHJcbiAgY29uc3QgcmVjdDEgPSAhY2hlY2tCb2R5Um90YXRpb24gPyBlbGVtZW50MS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IGdldFJvdGF0ZWRCb3VuZGluZ0JveEJhc2VkT25Cb2R5Um90YXRpb24oIGVsZW1lbnQxICk7XHJcbiAgY29uc3QgcmVjdDIgPSAhY2hlY2tCb2R5Um90YXRpb24gPyBlbGVtZW50Mi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IGdldFJvdGF0ZWRCb3VuZGluZ0JveEJhc2VkT25Cb2R5Um90YXRpb24oIGVsZW1lbnQyICk7XHJcblxyXG4gIGNvbnN0IHJlc3VsdCA9ICEoXHJcbiAgICByZWN0MS50b3AgPiByZWN0Mi5ib3R0b20gfHxcclxuICAgIHJlY3QxLnJpZ2h0IDwgcmVjdDIubGVmdCB8fFxyXG4gICAgcmVjdDEuYm90dG9tIDwgcmVjdDIudG9wIHx8XHJcbiAgICByZWN0MS5sZWZ0ID4gcmVjdDIucmlnaHRcclxuICApO1xyXG5cclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcG9sbEZvclZhcmlhYmxlPFQ+KCB2YXJpYWJsZU5hbWU6IHN0cmluZywgcmVhZHlDb25kaXRpb246ICggdmFsdWU6IFQgKSA9PiBib29sZWFuLCBjYWxsYmFjazogKCB2YWx1ZTogVCApID0+IHZvaWQgKSB7XHJcbiAgY29uc3QgcG9sbEludGVydmFsID0gMTAwO1xyXG4gIGNvbnN0IHBvbGwgPSBzZXRJbnRlcnZhbCggKCkgPT4ge1xyXG4gICAgaWYgKCAoIHdpbmRvdyBhcyBhbnkgKVt2YXJpYWJsZU5hbWVdICE9PSB1bmRlZmluZWQgJiYgcmVhZHlDb25kaXRpb24oICggd2luZG93IGFzIGFueSApW3ZhcmlhYmxlTmFtZV0gKSApIHtcclxuICAgICAgLy8gSWYgYm90aCBjb25kaXRpb25zIGFyZSBtZXQsIGV4ZWN1dGUgdGhlIGNhbGxiYWNrIGFuZCBzdG9wIHBvbGxpbmdcclxuICAgICAgY2xlYXJJbnRlcnZhbCggcG9sbCApO1xyXG4gICAgICBjYWxsYmFjayggKCB3aW5kb3cgYXMgYW55IClbdmFyaWFibGVOYW1lXSApO1xyXG4gICAgfVxyXG4gIH0sIHBvbGxJbnRlcnZhbCApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gd2FpdFVudGlsRWxlbWVudEV4aXN0cyggc2VsZWN0b3I6IHN0cmluZyApIHtcclxuICByZXR1cm4gbmV3IFByb21pc2UoIHJlc29sdmUgPT4ge1xyXG4gICAgaWYgKCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBzZWxlY3RvciApICkge1xyXG4gICAgICByZXR1cm4gcmVzb2x2ZSggZG9jdW1lbnQucXVlcnlTZWxlY3Rvciggc2VsZWN0b3IgKSApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoIG11dGF0aW9ucyA9PiB7XHJcbiAgICAgIGlmICggZG9jdW1lbnQucXVlcnlTZWxlY3Rvciggc2VsZWN0b3IgKSApIHtcclxuICAgICAgICBvYnNlcnZlci5kaXNjb25uZWN0KCk7XHJcbiAgICAgICAgcmVzb2x2ZSggZG9jdW1lbnQucXVlcnlTZWxlY3Rvciggc2VsZWN0b3IgKSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgb2JzZXJ2ZXIub2JzZXJ2ZSggZG9jdW1lbnQuYm9keSwge1xyXG4gICAgICBjaGlsZExpc3Q6IHRydWUsXHJcbiAgICAgIHN1YnRyZWU6IHRydWVcclxuICAgIH0gKTtcclxuICB9ICk7XHJcbn1cclxuXHJcbi8vLyBHZXQgdGhlIGRlZmF1bHQgYXR0cmlidXRlcyBmcm9tIHRoZSB0YXJnZXQgZWxlbWVudFxyXG4vLy8gSWYgaGF2ZSBub3QgZGVmYXVsdCBhdHRyaWJ1dGUgd2l0aCB0aGlzIEBhdHRyaWJ1dGVOYW1lIG9uIG1hcCB3aWxsIHNldCB0aGUgY3VycmVudCBhdHRyaWJ1dGUgYXMgZGVmYXVsdFxyXG4vLy8gSWYgaGF2ZSBub3QgZGVmYXVsdCBhdHRyaWJ1dGUgd2l0aCB0aGlzIEBhdHRyaWJ1dGVOYW1lIHdpbGwgcmV0dXJuIGFuIGVtcHR5IHN0cmluZ1xyXG5leHBvcnQgY29uc3QgbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQgPSBuZXcgTWFwPEhUTUxFbGVtZW50LCBNYXA8c3RyaW5nLCBzdHJpbmc+PigpO1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdEF0dHJpYnV0ZUZvclRhcmdldCggdGFyZ2V0OiBIVE1MRWxlbWVudCwgYXR0cmlidXRlTmFtZTogc3RyaW5nICk6IHN0cmluZyB7XHJcbiAgaWYgKCAhbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuaGFzKCB0YXJnZXQgKSApIHtcclxuICAgIG1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50LnNldCggdGFyZ2V0LCBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpICk7XHJcbiAgfVxyXG5cclxuICBsZXQgcmVzdWx0OiBzdHJpbmcgPSAnJztcclxuICBjb25zdCBkZWZhdWx0QXR0cmlidXRlVmFsdWVzQnlOYW1lID0gbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuZ2V0KCB0YXJnZXQgKSE7XHJcbiAgY29uc3QgdGFyZ2V0RGVmYXVsdEF0dHJpYnV0ZSA9ICFkZWZhdWx0QXR0cmlidXRlVmFsdWVzQnlOYW1lLmhhcyggYXR0cmlidXRlTmFtZSApID8gdGFyZ2V0LmdldEF0dHJpYnV0ZSggYXR0cmlidXRlTmFtZSApIDogZGVmYXVsdEF0dHJpYnV0ZVZhbHVlc0J5TmFtZS5nZXQoIGF0dHJpYnV0ZU5hbWUgKSE7XHJcblxyXG4gIHJlc3VsdCA9IHRhcmdldERlZmF1bHRBdHRyaWJ1dGUgPyB0YXJnZXREZWZhdWx0QXR0cmlidXRlIDogJyc7XHJcbiAgc2V0RGVmYXVsdEF0dHJpYnV0ZUZvclRhcmdldCggdGFyZ2V0LCBhdHRyaWJ1dGVOYW1lLCByZXN1bHQgKTtcclxuXHJcbiAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNldERlZmF1bHRBdHRyaWJ1dGVGb3JUYXJnZXQoIHRhcmdldDogSFRNTEVsZW1lbnQsIGF0dHJpYnV0ZU5hbWU6IHN0cmluZywgbmV3RGVmYXVsdEF0dHJpYnV0ZTogc3RyaW5nICk6IHZvaWQge1xyXG4gIGlmICggIW1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50LmhhcyggdGFyZ2V0ICkgKSB7XHJcbiAgICBtYXBEZWZhdWx0QXR0cmlidXRlc0J5RWxlbWVudC5zZXQoIHRhcmdldCwgbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKSApO1xyXG4gIH1cclxuXHJcbiAgbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuZ2V0KCB0YXJnZXQgKSEuc2V0KCBhdHRyaWJ1dGVOYW1lLCBuZXdEZWZhdWx0QXR0cmlidXRlICk7XHJcbn1cclxuXHJcbi8vLyBEaXZpZGUgbyBlbGVtZW50byBAdGFyZ2V0IGVtIDkgXCJxdWFkcmFkb3NcIiBpZ3VhaXMgZSByZXRvcm5hIGVtIHF1YWlzIHF1YWRyYWRvcyBvIGRyYWdnYWJsZSBlc3TDoSBjb2xpZGluZG8gY29tIG8gdGFyZ2V0XHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDb2xsaXNpb25EaXJlY3Rpb24oIGRyYWdnYWJsZTogSFRNTEVsZW1lbnQsIHRhcmdldDogSFRNTEVsZW1lbnQsIGNoZWNrQm9keVJvdGF0aW9uOiBib29sZWFuID0gZmFsc2UgKTogQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2sge1xyXG4gIGNvbnN0IHJlY3QxID0gIWNoZWNrQm9keVJvdGF0aW9uID8gZHJhZ2dhYmxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpIDogZ2V0Um90YXRlZEJvdW5kaW5nQm94QmFzZWRPbkJvZHlSb3RhdGlvbiggZHJhZ2dhYmxlICk7XHJcbiAgY29uc3QgcmVjdDIgPSAhY2hlY2tCb2R5Um90YXRpb24gPyB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiBnZXRSb3RhdGVkQm91bmRpbmdCb3hCYXNlZE9uQm9keVJvdGF0aW9uKCB0YXJnZXQgKTtcclxuXHJcbiAgY29uc3QgaXNUb3AgPSByZWN0MS5ib3R0b20gPiByZWN0Mi50b3AgJiYgcmVjdDEudG9wIDwgcmVjdDIudG9wICsgcmVjdDIuaGVpZ2h0IC8gMztcclxuICBjb25zdCBpc1JpZ2h0ID0gcmVjdDEubGVmdCA8IHJlY3QyLnJpZ2h0ICYmIHJlY3QxLnJpZ2h0ID4gcmVjdDIucmlnaHQgLSByZWN0Mi53aWR0aCAvIDM7XHJcbiAgY29uc3QgaXNDZW50ZXIgPSByZWN0MS50b3AgPCByZWN0Mi5ib3R0b20gJiYgcmVjdDEuYm90dG9tID4gcmVjdDIudG9wICYmIHJlY3QxLmxlZnQgPCByZWN0Mi5yaWdodCAmJiByZWN0MS5yaWdodCA+IHJlY3QyLmxlZnQ7XHJcbiAgY29uc3QgaXNCb3R0b20gPSByZWN0MS50b3AgPCByZWN0Mi5ib3R0b20gLSByZWN0Mi5oZWlnaHQgLyAzICYmIHJlY3QxLmJvdHRvbSA+IHJlY3QyLmJvdHRvbSAtIHJlY3QyLmhlaWdodCAvIDM7XHJcbiAgY29uc3QgaXNMZWZ0ID0gcmVjdDEucmlnaHQgPiByZWN0Mi5sZWZ0ICYmIHJlY3QxLmxlZnQgPCByZWN0Mi5sZWZ0ICsgcmVjdDIud2lkdGggLyAzO1xyXG5cclxuICByZXR1cm4geyB0b3A6IGlzVG9wLCByaWdodDogaXNSaWdodCwgY2VudGVyOiBpc0NlbnRlciwgYm90dG9tOiBpc0JvdHRvbSwgbGVmdDogaXNMZWZ0IH07XHJcbn1cclxuXHJcbi8vLyByZXR1cm4gdGhlIGRpc3RhbmNlIGZyb20gdGhlIGNlbnRlciBvZiB0aGUgZHJhZ2dhYmxlIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHRhcmdldCBlbGVtZW50IGZyb20gZWFjaCBib3JkZXIgXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXREaXN0YW5jZUZyb21Cb3JkZXIoIGRyYWdnYWJsZTogSFRNTEVsZW1lbnQsIHRhcmdldDogSFRNTEVsZW1lbnQsIGNoZWNrQm9keVJvdGF0aW9uOiBib29sZWFuID0gZmFsc2UgKTogQm9yZGVyRGlzdGFuY2Uge1xyXG4gIGNvbnN0IHJlY3QxID0gIWNoZWNrQm9keVJvdGF0aW9uID8gZHJhZ2dhYmxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpIDogZ2V0Um90YXRlZEJvdW5kaW5nQm94QmFzZWRPbkJvZHlSb3RhdGlvbiggZHJhZ2dhYmxlICk7XHJcbiAgY29uc3QgcmVjdDIgPSAhY2hlY2tCb2R5Um90YXRpb24gPyB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiBnZXRSb3RhdGVkQm91bmRpbmdCb3hCYXNlZE9uQm9keVJvdGF0aW9uKCB0YXJnZXQgKTtcclxuXHJcbiAgY29uc3QgY2VudGVyID0ge1xyXG4gICAgeDogcmVjdDEubGVmdCArIHJlY3QxLndpZHRoIC8gMixcclxuICAgIHk6IHJlY3QxLnRvcCArIHJlY3QxLmhlaWdodCAvIDIsXHJcbiAgfTtcclxuXHJcbiAgY29uc3QgZGlzdGFuY2VGcm9tQm9yZGVyOiBCb3JkZXJEaXN0YW5jZSA9IHtcclxuICAgIHRvcDogY2VudGVyLnkgLSByZWN0Mi50b3AsXHJcbiAgICByaWdodDogcmVjdDIucmlnaHQgLSBjZW50ZXIueCxcclxuICAgIGJvdHRvbTogcmVjdDIuYm90dG9tIC0gY2VudGVyLnksXHJcbiAgICBsZWZ0OiBjZW50ZXIueCAtIHJlY3QyLmxlZnQsXHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIGRpc3RhbmNlRnJvbUJvcmRlcjtcclxufVxyXG5cclxuZnVuY3Rpb24gcnVuT25seU9uY2VLZXlkb3duQWN0aW9ucyggZXZ0OiBLZXlib2FyZEV2ZW50ICkge1xyXG4gIGZvciAoIGNvbnN0IHBhaXIgb2YgZGljdEtleXNCeUFjdGlvbktleWRvd25PbmNlICkge1xyXG4gICAgaWYgKCBldnQuY29kZSA9PT0gcGFpclswXSApIHtcclxuICAgICAgcGFpclsxXS5mb3JFYWNoKCBrYkV2ZW50ID0+IGtiRXZlbnQoIGV2dCApICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBydW5LZXlkb3duQWN0aW9uc1JlcGVhdCggZXZ0OiBLZXlib2FyZEV2ZW50ICkge1xyXG4gIGZvciAoIGNvbnN0IHBhaXIgb2YgZGljdEtleXNCeUFjdGlvbktleWRvd25SZXBlYXQgKSB7XHJcbiAgICBpZiAoIGV2dC5jb2RlID09PSBwYWlyWzBdICkge1xyXG4gICAgICBwYWlyWzFdLmZvckVhY2goIGtiRXZlbnQgPT4ga2JFdmVudCggZXZ0ICkgKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAna2V5ZG93bicsIGV2dCA9PiB7XHJcbiAgaWYgKCAhZXZ0LnJlcGVhdCApIHtcclxuICAgIHJ1bk9ubHlPbmNlS2V5ZG93bkFjdGlvbnMoIGV2dCApO1xyXG4gIH1cclxuXHJcbiAgcnVuS2V5ZG93bkFjdGlvbnNSZXBlYXQoIGV2dCApO1xyXG59ICk7XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggJ2tleXVwJywgZXZ0ID0+IHtcclxuICBmb3IgKCBjb25zdCBwYWlyIG9mIGRpY3RLZXlzQnlBY3Rpb25LZXl1cCApIHtcclxuICAgIGlmICggZXZ0LmNvZGUgPT09IHBhaXJbMF0gKSB7XHJcbiAgICAgIHBhaXJbMV0uZm9yRWFjaCgga2JFdmVudCA9PiBrYkV2ZW50KCBldnQgKSApO1xyXG4gICAgfVxyXG4gIH1cclxufSApO1xyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50Um90YXRpb25JbkRlZ3JlZXMoIGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBheGlzOiAneCcgfCAneScgfCAneicgPSAneCcgKTogbnVtYmVyIHtcclxuICBsZXQgcmVnZXhNYXRjaFJvdGF0ZVZhbHVlOiBSZWdFeHA7XHJcbiAgc3dpdGNoICggYXhpcyApIHtcclxuICAgIGNhc2UgJ3gnOlxyXG4gICAgICByZWdleE1hdGNoUm90YXRlVmFsdWUgPSByZWdleEdyb3VwUm90YXRlWFZhbHVlO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ3knOlxyXG4gICAgICByZWdleE1hdGNoUm90YXRlVmFsdWUgPSByZWdleEdyb3VwUm90YXRlWVZhbHVlO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ3onOlxyXG4gICAgICByZWdleE1hdGNoUm90YXRlVmFsdWUgPSByZWdleEdyb3VwUm90YXRlWlZhbHVlO1xyXG4gICAgICBicmVhaztcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJlZ2V4TWF0Y2hSb3RhdGVWYWx1ZSA9IHJlZ2V4R3JvdXBSb3RhdGVWYWx1ZTtcclxuICAgICAgYnJlYWs7XHJcbiAgfVxyXG5cclxuICBjb25zdCBtYXRjaCA9IHJlZ2V4TWF0Y2hSb3RhdGVWYWx1ZS5leGVjKCBlbGVtZW50LnN0eWxlLnRyYW5zZm9ybSApO1xyXG4gIGlmICggbWF0Y2ggKSB7XHJcbiAgICBjb25zdCByb3RhdGlvblZhbHVlID0gcGFyc2VGbG9hdCggbWF0Y2hbMV0gKTtcclxuICAgIHJldHVybiByb3RhdGlvblZhbHVlO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRCb2R5Um90YXRpb25JbkRlZ3JlZXMoKTogbnVtYmVyIHtcclxuICBjb25zdCBtYXRjaCA9IGdldFJlZ2V4UmVtb3ZlUm90YXRpb25Gcm9tQm9keSgpLmV4ZWMoIGRvY3VtZW50LmJvZHkuc3R5bGUudHJhbnNmb3JtICk7XHJcbiAgaWYgKCBtYXRjaCApIHtcclxuICAgIGNvbnN0IHJvdGF0aW9uVmFsdWUgPSBwYXJzZUZsb2F0KCBtYXRjaFsxXSApO1xyXG4gICAgcmV0dXJuIHJvdGF0aW9uVmFsdWU7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJlZ2V4UmVtb3ZlUm90YXRpb25Gcm9tQm9keSgpIHtcclxuICByZXR1cm4gZ2V0UmVnZXhSZW1vdmVSb3RhdGlvbkJhc2VkT25BeGlzKCBnZXRCb2R5Um90YXRpb25BeGlzKCkgKVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVnZXhSZW1vdmVSb3RhdGlvbkJhc2VkT25BeGlzKCBheGlzOiAneCcgfCAneScgfCAneicgKSB7XHJcbiAgc3dpdGNoICggYXhpcyApIHtcclxuICAgIGNhc2UgJ3gnOlxyXG4gICAgICByZXR1cm4gcmVnZXhHcm91cFJvdGF0ZVhWYWx1ZTtcclxuICAgIGNhc2UgJ3knOlxyXG4gICAgICByZXR1cm4gcmVnZXhHcm91cFJvdGF0ZVlWYWx1ZTtcclxuICAgIGNhc2UgJ3onOlxyXG4gICAgICByZXR1cm4gcmVnZXhHcm91cFJvdGF0ZVpWYWx1ZTtcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiByZWdleEdyb3VwUm90YXRlVmFsdWU7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Qm9keVJvdGF0aW9uQXhpcygpOiAneCcgfCAneScgfCAneicge1xyXG4gIHJldHVybiBnZXRFbGVtZW50Um90YXRpb25BeGlzKCBkb2N1bWVudC5ib2R5ICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50Um90YXRpb25BeGlzKCBlbGVtZW50OiBIVE1MRWxlbWVudCApOiAneCcgfCAneScgfCAneicge1xyXG4gIGNvbnN0IGVsZW1lbnRUcmFuc2Zvcm0gPSBlbGVtZW50LnN0eWxlLnRyYW5zZm9ybS50b0xvd2VyQ2FzZSgpO1xyXG4gIGlmICggZWxlbWVudFRyYW5zZm9ybS5pbmNsdWRlcyggJ3gnICkgKSB7XHJcbiAgICByZXR1cm4gJ3gnO1xyXG4gIH0gZWxzZSBpZiAoIGVsZW1lbnRUcmFuc2Zvcm0uaW5jbHVkZXMoICd5JyApICkge1xyXG4gICAgcmV0dXJuICd5JztcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuICd6JztcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRUcmFuc2Zvcm1Db29yZHNGcm9tRWxlbWVudCggZWxlbWVudDogSFRNTEVsZW1lbnQsIGNoZWNrQm9keVJvdGF0aW9uOiBib29sZWFuID0gZmFsc2UgKTogUG9pbnQyRCB7XHJcbiAgY29uc3QgYXJyQ29tcHV0ZWREcmFnZ2FibGVUcmFuc2xhdGUgPSAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtZW50ICkudHJhbnNmb3JtLm1hdGNoKCByZWdleE51bWJlclBhdHRlcm4gKSA/PyBbMCwgMF0gKS5tYXAoIG4gPT4gK24gKTtcclxuXHJcbiAgbGV0IHJlc3VsdCA9IHtcclxuICAgIHg6IGFyckNvbXB1dGVkRHJhZ2dhYmxlVHJhbnNsYXRlWzRdICE9PSB1bmRlZmluZWQgPyBNYXRoLnJvdW5kKCBhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZVs0XSApIDogMCxcclxuICAgIHk6IGFyckNvbXB1dGVkRHJhZ2dhYmxlVHJhbnNsYXRlWzVdICE9PSB1bmRlZmluZWQgPyBNYXRoLnJvdW5kKCBhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZVs1XSApIDogMFxyXG4gIH1cclxuXHJcbiAgaWYgKCBjaGVja0JvZHlSb3RhdGlvbiApIHtcclxuICAgIGNvbnN0IGJvZHlBbmdsZSA9IGdldEVsZW1lbnRSb3RhdGlvbkluRGVncmVlcyggZG9jdW1lbnQuYm9keSwgZ2V0RWxlbWVudFJvdGF0aW9uQXhpcyggZWxlbWVudCApICkgfHwgMDtcclxuICAgIHJldHVybiByb3RhdGVDb29yZGluYXRlcyggcmVzdWx0LngsIHJlc3VsdC55LCBib2R5QW5nbGUgKTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGlja0V2ZW50VG9Db29yZGluYXRlcyggZXZlbnQ6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50ICkge1xyXG4gIGlmICggZXZlbnQgaW5zdGFuY2VvZiBNb3VzZUV2ZW50ICkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogZXZlbnQuY2xpZW50WCxcclxuICAgICAgeTogZXZlbnQuY2xpZW50WVxyXG4gICAgfTtcclxuICB9IGVsc2UgaWYgKCBldmVudCBpbnN0YW5jZW9mIFRvdWNoRXZlbnQgKSB7XHJcbiAgICBjb25zdCB0b3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogdG91Y2guY2xpZW50WCxcclxuICAgICAgeTogdG91Y2guY2xpZW50WVxyXG4gICAgfTtcclxuICB9IGVsc2Uge1xyXG4gICAgdGhyb3cgXCJFdmVudCBub3QgRm91bmRcIjtcclxuICB9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlSW52aXNpYmxlRGl2QWJvdmVQYXJlbnQoIHsgcGFyZW50RWxlbWVudCwgaWQsIHBvc2l0aW9uLCBkaW1lbnNpb25zIH06IHsgcGFyZW50RWxlbWVudDogSFRNTEVsZW1lbnQ7IGlkOiBzdHJpbmc7IHBvc2l0aW9uPzogeyB0b3A6IG51bWJlcjsgbGVmdDogbnVtYmVyOyB9OyBkaW1lbnNpb25zPzogRGltZW5zaW9uczsgfSApIHtcclxuICB2YXIgaW52aXNpYmxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTtcclxuXHJcbiAgaWYgKCAhcGFyZW50RWxlbWVudC5zdHlsZS5wb3NpdGlvbiApIHtcclxuICAgIHBhcmVudEVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xyXG4gIH1cclxuXHJcbiAgaW52aXNpYmxlRGl2LmlkID0gaWQ7XHJcbiAgaW52aXNpYmxlRGl2LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICBpbnZpc2libGVEaXYuc3R5bGUud2lkdGggPSBkaW1lbnNpb25zICYmIGRpbWVuc2lvbnMud2lkdGggPyBkaW1lbnNpb25zLndpZHRoLnRvU3RyaW5nKCkgKyAncHgnIDogJzEwMCUnO1xyXG4gIGludmlzaWJsZURpdi5zdHlsZS5oZWlnaHQgPSBkaW1lbnNpb25zICYmIGRpbWVuc2lvbnMuaGVpZ2h0ID8gZGltZW5zaW9ucy5oZWlnaHQudG9TdHJpbmcoKSArICdweCcgOiAnMTAwJSc7XHJcbiAgaW52aXNpYmxlRGl2LnN0eWxlLnRvcCA9ICggcG9zaXRpb24/LnRvcC50b1N0cmluZygpID8/ICcwJyApICsgJ3B4JztcclxuICBpbnZpc2libGVEaXYuc3R5bGUubGVmdCA9ICggcG9zaXRpb24/LmxlZnQudG9TdHJpbmcoKSA/PyAnMCcgKSArICdweCc7XHJcbiAgaW52aXNpYmxlRGl2LnN0eWxlLm9wYWNpdHkgPSAnMCc7IC8vIE1ha2UgdGhlIGRpdiBpbnZpc2libGVcclxuICBpbnZpc2libGVEaXYuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdhdXRvJzsgLy8gQWxsb3cgdGhlIGRpdiB0byBpbnRlcmNlcHQgbW91c2UgZXZlbnRzXHJcblxyXG4gIHBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoIGludmlzaWJsZURpdiApO1xyXG5cclxuICByZXR1cm4gaW52aXNpYmxlRGl2O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGlkZUVsZW1lbnQoIGVsZW1lbnQ6IEhUTUxFbGVtZW50ICkge1xyXG4gIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgZWxlbWVudC5zdHlsZS56SW5kZXggPSAnLTEnO1xyXG4gIGVsZW1lbnQuc3R5bGUub3BhY2l0eSA9ICcwJztcclxuICBlbGVtZW50LnN0eWxlLndpZHRoID0gJzBweCAhaW1wb3J0YW50JztcclxuICBlbGVtZW50LnN0eWxlLmhlaWdodCA9ICcwcHggIWltcG9ydGFudCc7XHJcbiAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoICdoaWRkZW4nLCAnJyApO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2xlZXBBc3luYyggbXM6IG51bWJlciApIHtcclxuICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dm9pZD4oICggcmVzb2x2ZSApID0+IHNldFRpbWVvdXQoICgpID0+IHJlc29sdmUoKSwgbXMgKSApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYmluZEVsZW1lbnRzQnlDaGVjayggdHJpZ2dlckVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQsIHRhcmdldEVsZW1lbnQ6IEhUTUxFbGVtZW50LCBvbkNoZWNrOiBGdW5jdGlvbiwgb25VbmNoZWNrOiBGdW5jdGlvbiApIHtcclxuICBpZiAoIHRyaWdnZXJFbGVtZW50LmNoZWNrZWQgKSB7XHJcbiAgICBvbkNoZWNrKCB0YXJnZXRFbGVtZW50ICk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0cmlnZ2VyR3JvdXAgPSB0cmlnZ2VyRWxlbWVudC5uYW1lXHJcbiAgICA/IEFycmF5LmZyb20oIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIGBbbmFtZT1cIiR7IHRyaWdnZXJFbGVtZW50Lm5hbWUgfVwiXWAgKSApXHJcbiAgICA6IFt0cmlnZ2VyRWxlbWVudF07XHJcblxyXG4gIHRyaWdnZXJHcm91cC5mb3JFYWNoKCB0ID0+IHQuYWRkRXZlbnRMaXN0ZW5lciggJ2NoYW5nZScsIGV2dCA9PiB7XHJcbiAgICBpZiAoIHRyaWdnZXJFbGVtZW50LmNoZWNrZWQgKSB7XHJcbiAgICAgIG9uQ2hlY2soIHRhcmdldEVsZW1lbnQsIGV2dCApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgb25VbmNoZWNrKCB0YXJnZXRFbGVtZW50LCBldnQgKTtcclxuICAgIH1cclxuICB9ICkgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNldElucHV0Rm9yY2VQaG9uZU51bWJlckZvcm1hdCggaW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50ICkge1xyXG4gIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCAnaW5wdXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBsZXQgcGhvbmVJbnB1dCA9IHRoaXMudmFsdWU7XHJcblxyXG4gICAgY29uc3QgY2xlYW5QaG9uZUlucHV0ID0gcGhvbmVJbnB1dC5yZXBsYWNlKCAvXFxEL2csICcnICk7XHJcbiAgICBpZiAoIGNsZWFuUGhvbmVJbnB1dC5sZW5ndGggPiAxMSApIHtcclxuICAgICAgcGhvbmVJbnB1dCA9IGNsZWFuUGhvbmVJbnB1dC5zbGljZSggMCwgMTEgKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgcGhvbmVOdW1iZXJGb3JtYXR0ZWQgPSB0b1Bob25lTnVtYmVyKCBwaG9uZUlucHV0ICk7XHJcblxyXG4gICAgaWYgKCBwaG9uZU51bWJlckZvcm1hdHRlZC5sZW5ndGggPT09IDEwICkge1xyXG4gICAgICBwaG9uZU51bWJlckZvcm1hdHRlZCA9IHBob25lTnVtYmVyRm9ybWF0dGVkLnJlcGxhY2VBbGwoICctJywgJycgKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnZhbHVlID0gcGhvbmVOdW1iZXJGb3JtYXR0ZWQ7XHJcbiAgfSApO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzTW9iaWxlQnJvd3NlcigpIHtcclxuICByZXR1cm4gL0FuZHJvaWR8aVBob25lL2kudGVzdCggbmF2aWdhdG9yLnVzZXJBZ2VudCApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlckRldmljZVR5cGUoKTogJ2FuZHJvaWQnIHwgJ2FwcGxlJyB8ICdkZXNrdG9wJyB7XHJcbiAgdmFyIHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCAoIHdpbmRvdyBhcyBhbnkgKS5vcGVyYTtcclxuXHJcbiAgaWYgKCAvYW5kcm9pZC9pLnRlc3QoIHVzZXJBZ2VudCApICkge1xyXG4gICAgcmV0dXJuICdhbmRyb2lkJztcclxuICB9IGVsc2UgaWYgKCAvaVBhZHxpUGhvbmV8aVBvZC8udGVzdCggdXNlckFnZW50ICkgJiYgISggd2luZG93IGFzIGFueSApLk1TU3RyZWFtICkge1xyXG4gICAgcmV0dXJuICdhcHBsZSc7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiAnZGVza3RvcCc7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNPblNjcmVlbiggZWxlbWVudDogSFRNTEVsZW1lbnQgKSB7XHJcbiAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgcmV0dXJuIChcclxuICAgIHJlY3QudG9wID49IDAgJiZcclxuICAgIHJlY3QubGVmdCA+PSAwICYmXHJcbiAgICByZWN0LmJvdHRvbSA8PSAoIHdpbmRvdy5pbm5lckhlaWdodCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0ICkgJiZcclxuICAgIHJlY3QucmlnaHQgPD0gKCB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggKVxyXG4gICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBiaW5kRWxlbWVudFZpZXdJZkNoZWNrZWQoIHRyaWdnZXJFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50LCB0YXJnZXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50LCBvcHRpb25zID0ge1xyXG4gIG9uQ2hlY2s6ICggdHJpZ2dlckVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQsIHRhcmdldEVsZW1lbnQ6IEhUTUxFbGVtZW50ICkgPT4geyB9LFxyXG4gIG9uVW5jaGVjazogKCB0cmlnZ2VyRWxlbWVudDogSFRNTElucHV0RWxlbWVudCwgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQgKSA9PiB7IH1cclxufSApIHtcclxuICBiaW5kRWxlbWVudHNCeUNoZWNrKFxyXG4gICAgdHJpZ2dlckVsZW1lbnQsXHJcbiAgICB0YXJnZXRFbGVtZW50LFxyXG4gICAgKCBlbDogSFRNTEVsZW1lbnQgKSA9PiB7XHJcbiAgICAgIGVsLmNsYXNzTGlzdC5hZGQoICdzaG93JyApO1xyXG4gICAgICBvcHRpb25zLm9uQ2hlY2soIHRyaWdnZXJFbGVtZW50LCB0YXJnZXRFbGVtZW50ICk7XHJcbiAgICB9LFxyXG4gICAgKCBlbDogSFRNTEVsZW1lbnQgKSA9PiB7XHJcbiAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoICdzaG93JyApO1xyXG4gICAgICBvcHRpb25zLm9uVW5jaGVjayggdHJpZ2dlckVsZW1lbnQsIHRhcmdldEVsZW1lbnQgKTtcclxuICAgIH0sXHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFZhbHVlRnJvbVJhZGlvR3JvdXAoIGdyb3VwTmFtZTogc3RyaW5nICk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgY29uc3QgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBgW25hbWU9JHsgZ3JvdXBOYW1lIH1dOmNoZWNrZWRgICkgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICBpZiAoIGVsICkge1xyXG4gICAgcmV0dXJuIGVsLnZhbHVlO1xyXG4gIH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzbW9vdGhTY3JvbGwoIHRhcmdldFk6IG51bWJlciwgZHVyYXRpb246IG51bWJlciApOiB2b2lkIHtcclxuICBjb25zdCBzdGFydFkgPSB3aW5kb3cuc2Nyb2xsWSB8fCB3aW5kb3cucGFnZVlPZmZzZXQ7XHJcbiAgbGV0IHN0YXJ0VGltZTogbnVtYmVyIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gIGZ1bmN0aW9uIHN0ZXAoIGN1cnJlbnRUaW1lOiBudW1iZXIgKSB7XHJcbiAgICBpZiAoICFzdGFydFRpbWUgKSBzdGFydFRpbWUgPSBjdXJyZW50VGltZTtcclxuICAgIGNvbnN0IGVsYXBzZWRUaW1lID0gY3VycmVudFRpbWUgLSBzdGFydFRpbWU7XHJcbiAgICBjb25zdCBwcm9ncmVzcyA9IE1hdGgubWluKCBlbGFwc2VkVGltZSAvIGR1cmF0aW9uLCAxICk7XHJcbiAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gbGVycCggMCwgMSwgcHJvZ3Jlc3MgKTtcclxuICAgIHdpbmRvdy5zY3JvbGxUbyggMCwgbGVycCggc3RhcnRZLCB0YXJnZXRZLCBlYXNlZFByb2dyZXNzICkgKTtcclxuICAgIGlmICggZWxhcHNlZFRpbWUgPCBkdXJhdGlvbiApIHtcclxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBzdGVwICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIHN0ZXAgKTtcclxufVxyXG5cclxuLy8gUmV0b3JuYSB1bWEgZnVuw6fDo28gcXVlIG7Do28gdmFpIHNlciBjb21wbGV0YWRhIGNhc28gc2VqYSBjaGFtYWRhIG5vdmFtZW50ZSBlbSB7IGRlbGF5IH0gbWlsaXNzZWd1bmRvc1xyXG5leHBvcnQgZnVuY3Rpb24gZGVib3VuY2VGYWN0b3J5KCBmdW5jOiBGdW5jdGlvbiwgZGVsYXk6IG51bWJlciApOiBGdW5jdGlvbiB7XHJcbiAgbGV0IGluRGVib3VuY2U6IG51bWJlcjtcclxuICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgY29udGV4dCA9IHdpbmRvdztcclxuICAgIGNvbnN0IGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICBjbGVhclRpbWVvdXQoIGluRGVib3VuY2UgKTtcclxuICAgIGluRGVib3VuY2UgPSB3aW5kb3cuc2V0VGltZW91dCggKCkgPT4gZnVuYy5hcHBseSggY29udGV4dCwgYXJncyApLCBkZWxheSApO1xyXG4gIH07XHJcbn1cclxuXHJcbi8vIFJldG9ybmEgdW1hIGZ1bsOnw6NvIHF1ZSBzw7MgcG9kZSBzZXIgY29tcGxldGFkYSB1bWEgdmV6IGEgY2FkYSB7IGxpbWl0IH0gbWlsaXNzZWd1bmRvcyBcclxuZXhwb3J0IGZ1bmN0aW9uIHRocm90dGxlRmFjdG9yeSggZnVuYzogRnVuY3Rpb24sIGxpbWl0OiBudW1iZXIgKTogRnVuY3Rpb24ge1xyXG4gIGxldCBsYXN0RnVuYzogbnVtYmVyO1xyXG4gIGxldCBsYXN0UmFuOiBudW1iZXI7XHJcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IGNvbnRleHQgPSB3aW5kb3c7XHJcbiAgICBjb25zdCBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgaWYgKCAhbGFzdFJhbiApIHtcclxuICAgICAgZnVuYy5hcHBseSggY29udGV4dCwgYXJncyApO1xyXG4gICAgICBsYXN0UmFuID0gRGF0ZS5ub3coKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNsZWFyVGltZW91dCggbGFzdEZ1bmMgKTtcclxuICAgICAgbGFzdEZ1bmMgPSB3aW5kb3cuc2V0VGltZW91dCggZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICggRGF0ZS5ub3coKSAtIGxhc3RSYW4gPj0gbGltaXQgKSB7XHJcbiAgICAgICAgICBmdW5jLmFwcGx5KCBjb250ZXh0LCBhcmdzICk7XHJcbiAgICAgICAgICBsYXN0UmFuID0gRGF0ZS5ub3coKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sIGxpbWl0IC0gKCBEYXRlLm5vdygpIC0gbGFzdFJhbiApICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc21vb3RoU2Nyb2xsVG8oIHBvczogbnVtYmVyICk6IHZvaWQge1xyXG4gIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG8oIHtcclxuICAgIHRvcDogcG9zLFxyXG4gICAgYmVoYXZpb3I6ICdzbW9vdGgnLFxyXG4gIH0gKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNtb290aFNjcm9sbFRvRWxlbWVudCggZWxlbWVudDogSFRNTEVsZW1lbnQsIHVzZUJyb3dzZXJEZWZhdWx0czogYm9vbGVhbiA9IHRydWUgKTogdm9pZCB7XHJcbiAgaWYgKCAhdXNlQnJvd3NlckRlZmF1bHRzICkge1xyXG4gICAgY29uc3QgdGFyZ2V0WSA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgd2luZG93LnNjcm9sbFk7XHJcbiAgICBjb25zdCBkdXJhdGlvbiA9IDEwMDA7IC8vIER1cmHDp8OjbyBmaXhhIGVtIG1pbGlzc2VndW5kb3MgKDEgc2VndW5kbylcclxuICAgIHNtb290aFNjcm9sbCggdGFyZ2V0WSwgZHVyYXRpb24gKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG8oIHtcclxuICAgIHRvcDogZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS55LFxyXG4gICAgbGVmdDogZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS54LFxyXG4gICAgYmVoYXZpb3I6ICdzbW9vdGgnLFxyXG4gIH0gKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNlbGVjdE9wdGlvbkJ5VGV4dCggaWRTZWxlY3RFbGVtZW50OiBzdHJpbmcsIHNlYXJjaFRleHQ6IHN0cmluZywgY29udGFpbnM6IGJvb2xlYW4gPSBmYWxzZSApOiB2b2lkIHtcclxuICBjb25zdCBzZWxlY3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIGlkU2VsZWN0RWxlbWVudCApIGFzIEhUTUxTZWxlY3RFbGVtZW50O1xyXG5cclxuICBpZiAoICFzZWxlY3RFbGVtZW50ICkge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgb3B0aW9uc0VsZW1lbnRvU2VsZWN0ID0gWy4uLnNlbGVjdEVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCggJ29wdGlvbicgKV07XHJcblxyXG4gIGxldCBzZWxlY3RlZE9wdGlvbjtcclxuICBpZiAoIGNvbnRhaW5zICkge1xyXG4gICAgc2VsZWN0ZWRPcHRpb24gPSBvcHRpb25zRWxlbWVudG9TZWxlY3RcclxuICAgICAgLmZpbHRlciggZWwgPT4gZWwudGV4dENvbnRlbnQgJiYgZWwudGV4dENvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyggc2VhcmNoVGV4dC50b0xvd2VyQ2FzZSgpICkgKVswXS52YWx1ZTtcclxuICB9IGVsc2Uge1xyXG4gICAgc2VsZWN0ZWRPcHRpb24gPSBvcHRpb25zRWxlbWVudG9TZWxlY3RcclxuICAgICAgLmZpbHRlciggZWwgPT4gZWwudGV4dENvbnRlbnQgJiYgZWwudGV4dENvbnRlbnQudG9Mb3dlckNhc2UoKSA9PT0gc2VhcmNoVGV4dC50b0xvd2VyQ2FzZSgpIClbMF0udmFsdWU7XHJcbiAgfVxyXG5cclxuICBzZWxlY3RFbGVtZW50LnZhbHVlID0gc2VsZWN0ZWRPcHRpb247XHJcbn1cclxuXHJcbiIsIlxyXG4vLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTYyNDU3NjcvY3JlYXRpbmctYS1ibG9iLWZyb20tYS1iYXNlNjQtc3RyaW5nLWluLWphdmFzY3JpcHRcclxuLy8vIERpdmlkZSB1bSBhcnF1aXZvIGJpbsOhcmlvIGVtIHbDoXJpYXMgcGFydGVzLCBwYXJhIHF1ZSBhIGNvbnZlcnPDo28gc2VqYSBvdGltaXphZGEsIGUgcmV0b3JuYSB1bWEgYmxvYiBjb20gbyBhcnF1aXZvXHJcblxyXG5pbXBvcnQgeyBpc051bGxPckVtcHR5IH0gZnJvbSAnLi9TdHJpbmdUb29scyc7XHJcblxyXG4vLy8gQHBhcmFtIG9uUHJvZ3Jlc3NvIFVtIGNhbGxiYWNrIHF1ZSByZWNlYmUgYSBwb3JjZW50YWdlbSBkZSBwcm9ncmVzc28gYXR1YWwgZGEgY29udmVyc8Ojb1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYmFzZTY0VG9CbG9iKCB0ZXh0b0Jhc2U2NDogc3RyaW5nLCBjb250ZW50VHlwZTogc3RyaW5nLCB0YW1hbmhvUGFydGVzID0gMTAyNCwgb25Qcm9ncmVzcyA9ICggcHJvZ3Jlc3NvQXR1YWw6IG51bWJlciApID0+IHsgY29uc29sZS5sb2coIHByb2dyZXNzb0F0dWFsICkgfSApIHtcclxuICBjb25zdCBieXRlQXJyYXlzID0gbmV3IEFycmF5PFVpbnQ4QXJyYXk+KCk7XHJcbiAgY29uc3QgZmlsZVNpemUgPSB0ZXh0b0Jhc2U2NC5sZW5ndGg7XHJcblxyXG4gIC8vLyBwcmVlbmNoZSBgYnl0ZUFycmF5c2AgY29tIG9zIGJ5dGVzIGRvIGFycXVpdm8gcGVnYW5kbyB1bWEgcGFydGUgZGUgXCJ0YW1hbmhvUGFydGVzXCIgcG9yIHZlelxyXG4gIGZvciAoIGxldCBvZmZzZXQgPSAwOyBvZmZzZXQgPCBmaWxlU2l6ZTsgb2Zmc2V0ICs9IHRhbWFuaG9QYXJ0ZXMgKSB7XHJcbiAgICAvLy8gcGVnYW5kbyB1bSBwYXJ0ZSBkZSB0YW1hbmhvIHt0YW1hbmhvUGFydGVzfSBkbyBhcnF1aXZvXHJcbiAgICBjb25zdCBjaHVuayA9IHRleHRvQmFzZTY0LnNsaWNlKCBvZmZzZXQsIG9mZnNldCArIHRhbWFuaG9QYXJ0ZXMgKTtcclxuXHJcbiAgICAvLy8gY29udmVydGVuZG8gYSBwYXJ0ZSBlbSB1bSBhcnJheSBjb20gY2FkYSBieXRlIGRlc3NlIHBlZGHDp28gZG8gYXJxdWl2b1xyXG4gICAgY29uc3QgYXJyQnl0ZXNDaHVuayA9IG5ldyBBcnJheTxudW1iZXI+KCBjaHVuay5sZW5ndGggKTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGNodW5rLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBhcnJCeXRlc0NodW5rW2ldID0gY2h1bmsuY2hhckNvZGVBdCggaSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vLyB0cmFuc2Zvcm1hbmRvIGVzc2UgYXJyYXkgZW0gdW0gYXJyYXkgY29tIGNhbXBvcyBkbyB0YW1hbmhvIGRlIHVtIGJ5dGVcclxuICAgIC8vLyBlIHVuaW5kbyBhcyBwYXJ0ZXMgasOhIGNvbmNsdcOtZGFzIGRvIGFycXVpdm9cclxuICAgIGJ5dGVBcnJheXMucHVzaCggbmV3IFVpbnQ4QXJyYXkoIGFyckJ5dGVzQ2h1bmsgKSApO1xyXG5cclxuICAgIC8vLyBDaGFtYW5kbyBjYWxsYmFjayBxdWUgZXhpYmUgbyBwcm9ncmVzc28gcXVhbmRvIG8gcGFzc28gYXR1YWwgZm9yIGNvbmNsdcOtZG9cclxuICAgIGF3YWl0IG9uUHJvZ3Jlc3MoICggb2Zmc2V0IC8gZmlsZVNpemUgKSAqIDEwMCApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG5ldyBCbG9iKCBieXRlQXJyYXlzLCB7IHR5cGU6IGNvbnRlbnRUeXBlIH0gKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRvd25sb2FkRmlsZUZyb21CbG9iKCBibG9iOiBCbG9iLCB0aXRsZTogc3RyaW5nICkge1xyXG4gIGxldCBmaWxlID0gVVJMLmNyZWF0ZU9iamVjdFVSTCggYmxvYiApO1xyXG5cclxuICBpZiAoIGZpbGUgKSB7XHJcbiAgICBsZXQgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdhJyApO1xyXG4gICAgYS5ocmVmID0gZmlsZTtcclxuICAgIGEuZG93bmxvYWQgPSB0aXRsZTtcclxuICAgIGEuY2xpY2soKTtcclxuICAgIGEucmVtb3ZlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmlsZUV4dGVuc2lvbiggZmlsZU5hbWU6IHN0cmluZyApOiBzdHJpbmcge1xyXG4gIGlmICggaXNOdWxsT3JFbXB0eSggZmlsZU5hbWUgKSApIHJldHVybiAnJztcclxuXHJcbiAgY29uc3QgZGVmYXVsdEZpbGVTcmMgPSBmaWxlTmFtZS5zcGxpdCggJy4nICkucG9wKCk7XHJcbiAgaWYgKCBkZWZhdWx0RmlsZVNyYyAmJiBkZWZhdWx0RmlsZVNyYyAhPT0gZmlsZU5hbWUgKSB7XHJcbiAgICByZXR1cm4gZGVmYXVsdEZpbGVTcmM7XHJcbiAgfVxyXG5cclxuICBjb25zdCBmaWxlVHlwZVN0ciA9IGZpbGVOYW1lLnNwbGl0KCAnLycgKS5wb3AoKTtcclxuICBpZiAoIGZpbGVUeXBlU3RyICYmIGZpbGVUeXBlU3RyICE9PSBmaWxlTmFtZSApIHtcclxuICAgIHJldHVybiBmaWxlVHlwZVN0cjtcclxuICB9XHJcblxyXG4gIHJldHVybiAnJztcclxufSIsImV4cG9ydCBmdW5jdGlvbiByZW1vdmVBY2NlbnRzKCBzdHI6IHN0cmluZyApIHtcclxuICByZXR1cm4gc3RyLm5vcm1hbGl6ZSggJ05GRCcgKS5yZXBsYWNlKCAvW1xcdTAzMDAtXFx1MDM2Zl0vZywgXCJcIiApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyKCBzdHI6IHN0cmluZyApOiBzdHJpbmcge1xyXG4gIGlmICggdHlwZW9mIHN0ciAhPT0gJ3N0cmluZycgKSB7XHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG4gIHJldHVybiBzdHIuY2hhckF0KCAwICkudG9VcHBlckNhc2UoKSArIHN0ci5zdWJzdHJpbmcoIDEgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNlYXJjaFRlcm0oIHN0cmluZ0FycmF5OiBzdHJpbmdbXSwgc2VhcmNoVGVybTogc3RyaW5nICk6IHN0cmluZ1tdIHtcclxuICByZXR1cm4gc3RyaW5nQXJyYXlcclxuICAgIC5maWx0ZXIoICggdjogc3RyaW5nICkgPT4gdi50b0xvd2VyQ2FzZSgpLmluZGV4T2YoIHNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKSApID4gLTEgKVxyXG4gICAgLnNsaWNlKCAwLCAxMCApXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB6ZXJvQmVmb3JlKCBuOiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuIG4udG9TdHJpbmcoKS5wYWRTdGFydCggMiwgJzAnICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc051bGxPckVtcHR5KCBzdHI6IHN0cmluZyApIHtcclxuICByZXR1cm4gdHlwZW9mIHN0ciAhPT0gJ3N0cmluZycgfHwgIXN0ciB8fCBzdHIgPT09ICcnXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b1Bob25lTnVtYmVyKCBpbnB1dFRleHQ6IHN0cmluZyApIHtcclxuICBjb25zdCBjbGVhbk51bWJlciA9IGlucHV0VGV4dC5yZXBsYWNlKCAvXFxEL2csICcnICk7XHJcblxyXG4gIGxldCByZXN1bHQ7XHJcbiAgaWYgKCBjbGVhbk51bWJlci5sZW5ndGggPD0gMTAgKSB7XHJcbiAgICBjb25zdCByZWdleCA9IC9eKFxcZHsyfSkoXFxkezR9KShcXGR7MCw0fSkkLztcclxuICAgIHJlc3VsdCA9IGNsZWFuTnVtYmVyLnJlcGxhY2UoIHJlZ2V4LCAnKCQxKSAkMi0kMycgKTtcclxuICB9IGVsc2Uge1xyXG4gICAgY29uc3QgcmVnZXggPSAvXihcXGR7Mn0pKFxcZHs1fSkoXFxkezAsNH0pJC87XHJcbiAgICByZXN1bHQgPSBjbGVhbk51bWJlci5yZXBsYWNlKCByZWdleCwgJygkMSkgJDItJDMnICk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzdWx0O1xyXG59IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSAobW9kdWxlKSA9PiB7XG5cdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuXHRcdCgpID0+IChtb2R1bGVbJ2RlZmF1bHQnXSkgOlxuXHRcdCgpID0+IChtb2R1bGUpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCB7IGE6IGdldHRlciB9KTtcblx0cmV0dXJuIGdldHRlcjtcbn07IiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNTMpO1xuIl0sIm5hbWVzIjpbIkF1ZGlvQ29tcG9uZW50IiwiT2JqZWN0RXZlbnRMaXN0ZW5lciIsInNyYyIsImF1ZGlvRWxlbWVudCIsImNvbnRhaW5lciIsImNvbnN0cnVjdG9yIiwiYXVkaW9FbGVtZW50SWQiLCJzdXBlciIsInRoaXMiLCJpZCIsImNsYXNzTGlzdCIsImFkZCIsInBhdXNlZCIsImZpbGVOYW1lIiwicXVlcnlTZWxlY3RvciIsImN1cnJlbnRUaW1lIiwicGxheSIsInBsYXlQcm9taXNlIiwidW5kZWZpbmVkIiwidGhlbiIsIl8iLCJjYXRjaCIsInN0b3AiLCJjYWxsRXZlbnRzQnlOYW1lIiwicGF1c2UiLCJ0b2dnbGUiLCJjcmVhdGVBdWRpb0NvbXBvbmVudCIsImF1ZGlvQ29udGFpbmVyIiwiQXVkaW9Db21wb25lbnRGYWN0b3J5IiwiYnVpbGQiLCJkb2N1bWVudCIsImJvZHkiLCJlbGVtZW50IiwiQ29tcG9uZW50Q29udGFpbmVyIiwicGxheWVyQ29uZmlnIiwiY3JlYXRlSW52aXNpYmxlUGxheWVyIiwiYnVpbGRTdWJDb21wb25lbnRzIiwicGFyZW50IiwiX2VsZW1lbnQiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJjb21wb25lbnROYW1lIiwic3ViQ29tcG9uZW50Q291bnRCeU5hbWUiLCJNYXAiLCJzdWJDb21wb25lbnRzIiwidGVtcGxhdGUiLCJnZXRFbGVtZW50QnlJZCIsIkVycm9yIiwiY3JlYXRlRWxlbWVudCIsImNvbnRlbnQiLCJhcHBlbmRDaGlsZCIsImdldFRlbXBsYXRlQ2xvbmVOb2RlcyIsImNsb25lTm9kZSIsImNoaWxkcmVuIiwiYnVpbGRTaW5nbGVTdWJDb21wb25lbnQiLCJjb21wb25lbnQiLCJoYXMiLCJzZXQiLCJjb21wb25lbnRDb3VudCIsImdldCIsImNhcGl0YWxpemVGaXJzdExldHRlciIsImVsZW1lbnRJZCIsIml0ZW0iLCJpbnNlcnRBZGphY2VudEVsZW1lbnQiLCJTdHJpbmciLCJwcm90b3R5cGUiLCJpc051bGxPckVtcHR5IiwidHJ1bmNhdGUiLCJtYXgiLCJkZWNvcmF0b3IiLCJsZW5ndGgiLCJzdWJzdHJpbmciLCJ0b1N0cmluZyIsInJlbW92ZUFjY2VudHMiLCJub3JtYWxpemUiLCJyZXBsYWNlIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJ6ZXJvQmVmb3JlIiwicGFkU3RhcnQiLCJldmVudHNCeU5hbWUiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnROYW1lIiwiZXZlbnQiLCJ0b0xvd2VyQ2FzZSIsInB1c2giLCJnZXRFdmVudHNCeU5hbWUiLCJldmVudEFyZ3MiLCJmb3JFYWNoIiwiZSIsImFzeW5jIiwiYXJyU291cmNlcyIsImNvbnRhaW5lckRpdiIsImluc2VydEFkamFjZW50SFRNTCIsImF1ZGlvRWxlbWVudEhUTUwiLCJjaGlsZE5vZGVzIiwicGxheUJ1dHRvbiIsImJ1dHRvbkVsZW1lbnQiLCJzZXRUaW1lb3V0IiwicmVtb3ZlIiwib25QbGF5Iiwib25wbGF5Iiwib25QYXVzZSIsIm9ucGF1c2UiLCJzZXRBdWRpb0VsZW1lbnRQbGF5UGF1c2VFdmVudHMiLCJnZXRQbGF5QnV0dG9uRWxlbWVudCIsImhpZGVFbGVtZW50IiwiYXV0b1BsYXkiLCJhdXRvcGxheSIsIm11dGVkIiwibG9vcCIsInByZWxvYWQiLCJ0cmltRW5kIiwiYXVkaW9FbGVtZW50UGFyYW1zQnlQbGF5ZXJDb25maWciLCJtYXAiLCJzb3VyY2VFbGVtZW50SFRNTCIsInJlZHVjZSIsImFjYyIsIm5leHQiLCJnZXRGaWxlRXh0ZW5zaW9uIiwicGxheUJ1dHRvbkNTUyIsImRpY3RLZXlzQnlBY3Rpb25LZXlkb3duT25jZSIsImRpY3RLZXlzQnlBY3Rpb25LZXlkb3duUmVwZWF0IiwiZGljdEtleXNCeUFjdGlvbktleXVwIiwic3R5bGUiLCJkaXNwbGF5IiwicG9zaXRpb24iLCJ6SW5kZXgiLCJvcGFjaXR5Iiwid2lkdGgiLCJoZWlnaHQiLCJzZXRBdHRyaWJ1dGUiLCJ3aW5kb3ciLCJldnQiLCJyZXBlYXQiLCJwYWlyIiwiY29kZSIsImtiRXZlbnQiLCJydW5Pbmx5T25jZUtleWRvd25BY3Rpb25zIiwicnVuS2V5ZG93bkFjdGlvbnNSZXBlYXQiLCJkZWZhdWx0RmlsZVNyYyIsInNwbGl0IiwicG9wIiwiZmlsZVR5cGVTdHIiLCJzdHIiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsIm4iLCJnZXR0ZXIiLCJfX2VzTW9kdWxlIiwiZCIsImEiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsIm9iaiIsInByb3AiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsIl9fd2VicGFja19leHBvcnRzX18iXSwic291cmNlUm9vdCI6IiJ9
var AudioTools;(()=>{"use strict";var t={173:(t,e,n)=>{n.d(e,{AudioComponent:()=>r});var o=n(7930),i=n(1319),s=n(6555);class r extends o.ObjectEventListener{src;audioElement;_container;_blockInteraction=!1;_divBlockInteraction;constructor(t){super(),this.src=t.src,this._container=t.container,this.audioElement=t.audioElement,this._blockInteraction=!!t.blockInteraction,t.audioElementId&&(this.audioElement.id=t.audioElementId),this.audioElement.classList.add("audio-component"),this._container.id||(this._container.id=t.audioElementId+"AudioComponentContainer"),this._container.classList.add("audio-component-container"),this._divBlockInteraction=this.getInvisibleDivBlockInteraction(this),this.setupInvisibleDivBlockInteraction()}get divBlockInteraction(){return this._divBlockInteraction}get container(){return this._container}get paused(){return this.audioElement.paused}get fileName(){return this.audioElement.src||this.audioElement.querySelector("source")?.src||""}get currentTime(){return this.audioElement.currentTime}set currentTime(t){this.audioElement.currentTime=t}playWithoutTriggerEvents(){var t=this.audioElement.play();return void 0!==t&&t.then((t=>{})).catch((()=>{this.stop()})),this.setClassesPlaying(),this}pauseWithoutTriggerEvents(){return this.audioElement.pause(),this.setClassesPaused(),this}setClassesPlaying(){this._container.classList.add("audio-component-playing"),this._divBlockInteraction.classList.add("audio-component-playing"),this._container.classList.remove("audio-component-paused"),this._divBlockInteraction.classList.remove("audio-component-paused")}setClassesPaused(){this._container.classList.add("audio-component-paused"),this._divBlockInteraction.classList.add("audio-component-paused"),this._container.classList.remove("audio-component-playing"),this._divBlockInteraction.classList.remove("audio-component-playing")}play(){return this.playWithoutTriggerEvents(),this.callEventsByName("onplay",this),this}pause(){return this.pauseWithoutTriggerEvents(),this.callEventsByName("onpause",this),this}stop(){return this.pause(),this.audioElement.currentTime=0,this.callEventsByName("onstop",this),this}toggle(){return this.paused?this.playWithoutTriggerEvents():this.pause(),this.callEventsByName("ontoggle",this),this}mute(){return this.audioElement.volume=0,this.callEventsByName("onmute",this),this}unmute(){return this.audioElement.volume=1,this.callEventsByName("onunmute",this),this}seek(t,e){return this.currentTime=t,this.callEventsByName("onseek",this),this}get dimensions(){return(0,i.getElementDimensions)(this._container)}getInvisibleDivBlockInteraction(t){const e=(0,i.createInvisibleDivAboveParent)({parentElement:t._container,id:`invisibleDivBlockInteraction${t._container.id}`,position:{top:0,left:0},dimensions:{width:t.dimensions.width,height:t.dimensions.height}});return e.classList.add("audio-component-div-block-interaction"),e}setupInvisibleDivBlockInteraction(){this._divBlockInteraction.style.display=this._blockInteraction?"block":"none",this._divBlockInteraction.style.zIndex="995",this._divBlockInteraction.addEventListener("click",(()=>{this.callEventsByName("onclickinteractionblocked",this,this._divBlockInteraction),this.callEventsByName("oninteractionblocked",this,this._divBlockInteraction)}))}static async createAudioComponentOnBody(t){const e=await new s.AudioComponentFactory(t.src).buildOnBody();return new r({src:t.src,container:e,audioElement:e.querySelector("audio"),audioElementId:t.audioElementId,blockInteraction:t.blockInteraction})}static async createAudioComponent(t){if(t.container===document.body||!t.container)return this.createAudioComponentOnBody(t);const e=await new s.AudioComponentFactory(t.src).build(t.container);return new r({src:t.src,container:e,audioElement:e.querySelector("audio"),audioElementId:t.audioElementId,blockInteraction:t.blockInteraction})}}},6555:(t,e,n)=>{n.d(e,{AudioComponentFactory:()=>s});var o=n(7353),i=n(6401);class s extends i.ComponentContainer{constructor(t,e){super("audioComponent",(0,o.createInvisiblePlayer)([t],e))}async buildSubComponents(t){}}},6401:(t,e,n)=>{n.d(e,{ComponentContainer:()=>o});class o{_element=null;templateElement;componentName;subComponentCountByName=new Map;subComponents=[];constructor(t,e){if("string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error("Invalid template for scene component. Template id: "+e);this.templateElement=t}else this.templateElement=document.createElement("template"),this.templateElement.content.appendChild(e),document.body.appendChild(this.templateElement);this.componentName=t}getTemplateCloneNodes(){return this.templateElement.content.cloneNode(!0).children}async buildSingleSubComponent(t,e){this.subComponentCountByName.has(this.componentName)&&this.subComponentCountByName.set(this.componentName,0);let n=this.subComponentCountByName.get(this.componentName);return this.subComponentCountByName.set(this.componentName,n+1),await t.build(e,`${this.componentName}${t.componentName.capitalizeFirstLetter()}${n}`)}async buildOnBody(t){this._element=document.createElement("div"),t&&(this._element.id=t);for(let t of this.getTemplateCloneNodes())this._element.insertAdjacentElement("afterbegin",t);if(!this._element)throw new Error(`Fail building SceneComponent. ElementId: ${t}`);return await this.buildSubComponents(document.body),document.body.insertAdjacentElement("beforeend",this._element),this._element}async build(t,e){for(let e of this.getTemplateCloneNodes())t.insertAdjacentElement("afterbegin",e);return await this.buildSubComponents(t),t}}},2976:()=>{String.prototype.isNullOrEmpty=function(){return"string"!=typeof this&&!this&&""!==this},String.prototype.truncate=function(t,e="..."){return(this.length>t?this.substring(0,t)+e:this).toString()},String.prototype.removeAccents=function(){return this.normalize("NFD").replace(/[\u0300-\u036f]/g,"")},String.prototype.capitalizeFirstLetter=function(){return"string"!=typeof this?"":this.charAt(0).toUpperCase()+this.substring(1)},String.prototype.zeroBefore=function(){return this.padStart(2,"0")}},7930:(t,e,n)=>{n.d(e,{ObjectEventListener:()=>o});class o{eventsByName=new Map;addEventListener(t,e){this.eventsByName.has(t.toLowerCase())?this.eventsByName.get(t.toLowerCase()).push(e):this.eventsByName.set(t.toLowerCase(),[e])}getEventsByName(t){return this.eventsByName.has(t.toLowerCase())||this.eventsByName.set(t.toLowerCase(),[]),this.eventsByName.get(t.toLowerCase())}callEventsByName(t,...e){this.getEventsByName(t).forEach((t=>t(...e)))}}},7353:(t,e,n)=>{n.r(e),n.d(e,{audioElementHTML:()=>l,createAudioComponentOnBody:()=>r,createInvisiblePlayer:()=>a,playButtonCSS:()=>d,sourceElementHTML:()=>c}),n(2976);var o=n(1319),i=n(3164),s=n(173);async function r(t){return await s.AudioComponent.createAudioComponentOnBody(t)}function a(t,e){const n=(0,o.getElementFromHTML)(l(t,e));return document.body.insertAdjacentElement("afterbegin",n),(0,o.hideElement)(n),n}function l(t,e){return`<audio controls ${e?function(t){return` ${t.id?'id="'+t.id+'"':""} ${t.autoPlay||t.autoplay?"autoplay":""} ${t.muted?"muted":""} ${t.loop?"loop":""} ${t.preload?'preload="'+t.preload+'"':""}`.trimEnd()}(e):""}>\n    ${t.map((t=>c(t))).reduce(((t,e)=>t+e),"")}\n  </audio>`}function c(t){return`<source src="${t}" type="audio/${(0,i.getFileExtension)(t)}">`}function d(){return"\n    .play-button {\n      margin: 0;\n      padding: 0;\n      display: flex;\n      border: 0;\n      background: transparent;\n      box-sizing: border-box;\n      width: 0;\n      height: 34px;\n      border-color: transparent transparent transparent #202020;\n      transition: 100ms all ease;\n      cursor: pointer;\n      border-style: double;\n      border-width: 0px 0 0px 30px;\n    }\n\n    .play-button.paused {\n      border-style: solid;\n      border-width: 23px 0px 23px 34px;\n    }\n\n    .play-button:hover {\n      border-color: transparent transparent transparent #404040;\n    }\n  "}},1319:(t,e,n)=>{n.d(e,{createInvisibleDivAboveParent:()=>l,getElementDimensions:()=>a,getElementFromHTML:()=>r,hideElement:()=>c});const o=new Map,i=new Map,s=new Map;function r(t,e=!0){if(!(t=e?t.trim():t))return null;const n=document.createElement("template");n.innerHTML=t;const o=n.content.children;return 1===o.length?o[0]:Array.from(o)}function a(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height}}function l({parentElement:t,id:e,position:n,dimensions:o}){var i=document.createElement("div");return t.style.position||(t.style.position="relative"),i.id=e,i.style.position="absolute",i.style.width=o&&o.width?o.width.toString()+"px":"100%",i.style.height=o&&o.height?o.height.toString()+"px":"100%",i.style.top=(n?.top.toString()??"0")+"px",i.style.left=(n?.left.toString()??"0")+"px",i.style.opacity="0",i.style.pointerEvents="auto",t.appendChild(i),i}function c(t){t.style.display="block",t.style.position="absolute",t.style.zIndex="-1",t.style.opacity="0",t.style.width="0px !important",t.style.height="0px !important",t.setAttribute("hidden","")}new Map,window.addEventListener("keydown",(t=>{t.repeat||function(t){for(const e of o)t.code===e[0]&&e[1].forEach((e=>e(t)))}(t),function(t){for(const e of i)t.code===e[0]&&e[1].forEach((e=>e(t)))}(t)})),window.addEventListener("keyup",(t=>{for(const e of s)t.code===e[0]&&e[1].forEach((e=>e(t)))}))},3164:(t,e,n)=>{n.d(e,{getFileExtension:()=>i});var o=n(2843);function i(t){if((0,o.isNullOrEmpty)(t))return"";const e=t.split(".").pop();if(e&&e!==t)return e;const n=t.split("/").pop();return n&&n!==t?n:""}},2843:(t,e,n)=>{function o(t){return"string"!=typeof t||!t||""===t}n.d(e,{isNullOrEmpty:()=>o})}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var s=e[o]={exports:{}};return t[o](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o=n(7353);AudioTools=o})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixPQUFPQyxZQUFhLENBQUVDLE1BQU8sV0FFN0RWLE9BQU9DLGVBQWVaLEVBQVMsYUFBYyxDQUFFcUIsT0FBTyxHQUFPLEVDRjlELElBQUlDLEVBQXNCekIsRUFBb0IsTSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9Db21wb25lbnRzL0F1ZGlvQ29tcG9uZW50LnRzIiwid2VicGFjazovLy8uL3NyYy9Db21wb25lbnRzL0F1ZGlvQ29tcG9uZW50RmFjdG9yeS50cyIsIndlYnBhY2s6Ly8vLi9zcmMvQ29tcG9uZW50cy9Db21wb25lbnRDb250YWluZXIudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL0V4dGVuc2lvbnMvU3RyaW5nRXh0ZW5zaW9ucy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvRXh0cmFzL09iamVjdEV2ZW50TGlzdGVuZXIudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL1Rvb2xzL0F1ZGlvVG9vbHMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL1Rvb2xzL0RPTVRvb2xzLnRzIiwid2VicGFjazovLy8uL3NyYy9Ub29scy9GaWxlVG9vbHMudHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL1Rvb2xzL1N0cmluZ1Rvb2xzLnRzIiwid2VicGFjazovLy93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly8vd2VicGFjay9ydW50aW1lL2NvbXBhdCBnZXQgZGVmYXVsdCBleHBvcnQiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly8vd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly8vd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly8vd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9iamVjdEV2ZW50TGlzdGVuZXIgfSBmcm9tICcuLi9FeHRyYXMvT2JqZWN0RXZlbnRMaXN0ZW5lcic7XHJcbmltcG9ydCB7IGNyZWF0ZUludmlzaWJsZURpdkFib3ZlUGFyZW50LCBnZXRFbGVtZW50RGltZW5zaW9ucyB9IGZyb20gJy4uL1Rvb2xzL0RPTVRvb2xzJztcclxuaW1wb3J0IHsgRGltZW5zaW9ucyB9IGZyb20gJy4uL1Rvb2xzL01hdGhUb29scyc7XHJcbmltcG9ydCB7IEF1ZGlvQ29tcG9uZW50RmFjdG9yeSB9IGZyb20gJy4vQXVkaW9Db21wb25lbnRGYWN0b3J5JztcclxuaW1wb3J0IHsgSU1lZGlhUGxheWVyRnVuY3Rpb25zIH0gZnJvbSAnLi9UeXBlcyc7XHJcblxyXG5leHBvcnQgdHlwZSBBdWRpb0NvbXBvbmVudE9wdGlvbnMgPSB7XHJcbiAgc3JjOiBzdHJpbmc7XHJcbiAgYXVkaW9FbGVtZW50OiBIVE1MQXVkaW9FbGVtZW50O1xyXG4gIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XHJcbiAgYXVkaW9FbGVtZW50SWQ/OiBzdHJpbmc7XHJcbiAgYmxvY2tJbnRlcmFjdGlvbj86IGJvb2xlYW47XHJcbn07XHJcblxyXG5leHBvcnQgdHlwZSBDcmVhdGVBdWRpb0NvbXBvbmVudE9wdGlvbnMgPSB7XHJcbiAgc3JjOiBzdHJpbmc7XHJcbiAgYXVkaW9FbGVtZW50SWQ/OiBzdHJpbmc7XHJcbiAgYmxvY2tJbnRlcmFjdGlvbj86IGJvb2xlYW47XHJcbiAgY29udGFpbmVyPzogSFRNTEVsZW1lbnQ7XHJcbn07XHJcblxyXG5leHBvcnQgY2xhc3MgQXVkaW9Db21wb25lbnQgZXh0ZW5kcyBPYmplY3RFdmVudExpc3RlbmVyIGltcGxlbWVudHMgSU1lZGlhUGxheWVyRnVuY3Rpb25zIHtcclxuICBwdWJsaWMgc3JjOiBzdHJpbmc7XHJcbiAgcHVibGljIGF1ZGlvRWxlbWVudDogSFRNTEF1ZGlvRWxlbWVudDtcclxuICBwcml2YXRlIF9jb250YWluZXI6IEhUTUxFbGVtZW50O1xyXG5cclxuICBwcm90ZWN0ZWQgX2Jsb2NrSW50ZXJhY3Rpb246IGJvb2xlYW4gPSBmYWxzZTtcclxuICBwcm90ZWN0ZWQgX2RpdkJsb2NrSW50ZXJhY3Rpb246IEhUTUxFbGVtZW50O1xyXG5cclxuICBjb25zdHJ1Y3Rvciggb3B0aW9uczogQXVkaW9Db21wb25lbnRPcHRpb25zICkge1xyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICB0aGlzLnNyYyA9IG9wdGlvbnMuc3JjO1xyXG4gICAgdGhpcy5fY29udGFpbmVyID0gb3B0aW9ucy5jb250YWluZXI7XHJcbiAgICB0aGlzLmF1ZGlvRWxlbWVudCA9IG9wdGlvbnMuYXVkaW9FbGVtZW50O1xyXG4gICAgdGhpcy5fYmxvY2tJbnRlcmFjdGlvbiA9IG9wdGlvbnMuYmxvY2tJbnRlcmFjdGlvbiA/IHRydWUgOiBmYWxzZTtcclxuXHJcbiAgICBpZiAoIG9wdGlvbnMuYXVkaW9FbGVtZW50SWQgKSB7XHJcbiAgICAgIHRoaXMuYXVkaW9FbGVtZW50LmlkID0gb3B0aW9ucy5hdWRpb0VsZW1lbnRJZDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmF1ZGlvRWxlbWVudC5jbGFzc0xpc3QuYWRkKCAnYXVkaW8tY29tcG9uZW50JyApO1xyXG5cclxuICAgIGlmICggIXRoaXMuX2NvbnRhaW5lci5pZCApIHtcclxuICAgICAgdGhpcy5fY29udGFpbmVyLmlkID0gb3B0aW9ucy5hdWRpb0VsZW1lbnRJZCArICdBdWRpb0NvbXBvbmVudENvbnRhaW5lcic7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9jb250YWluZXIuY2xhc3NMaXN0LmFkZCggJ2F1ZGlvLWNvbXBvbmVudC1jb250YWluZXInICk7XHJcblxyXG4gICAgdGhpcy5fZGl2QmxvY2tJbnRlcmFjdGlvbiA9IHRoaXMuZ2V0SW52aXNpYmxlRGl2QmxvY2tJbnRlcmFjdGlvbiggdGhpcyApO1xyXG4gICAgdGhpcy5zZXR1cEludmlzaWJsZURpdkJsb2NrSW50ZXJhY3Rpb24oKTtcclxuICB9XHJcblxyXG5cclxuICBwdWJsaWMgZ2V0IGRpdkJsb2NrSW50ZXJhY3Rpb24oKTogSFRNTEVsZW1lbnQge1xyXG4gICAgcmV0dXJuIHRoaXMuX2RpdkJsb2NrSW50ZXJhY3Rpb247XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGNvbnRhaW5lcigpOiBIVE1MRWxlbWVudCB7XHJcbiAgICByZXR1cm4gdGhpcy5fY29udGFpbmVyO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBwYXVzZWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5hdWRpb0VsZW1lbnQucGF1c2VkO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldCBmaWxlTmFtZSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuYXVkaW9FbGVtZW50LnNyYyB8fCB0aGlzLmF1ZGlvRWxlbWVudC5xdWVyeVNlbGVjdG9yKCAnc291cmNlJyApPy5zcmMgfHwgJyc7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0IGN1cnJlbnRUaW1lKCk6IG51bWJlciB7XHJcbiAgICByZXR1cm4gdGhpcy5hdWRpb0VsZW1lbnQuY3VycmVudFRpbWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0IGN1cnJlbnRUaW1lKCB0OiBudW1iZXIgKSB7XHJcbiAgICB0aGlzLmF1ZGlvRWxlbWVudC5jdXJyZW50VGltZSA9IHQ7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcGxheVdpdGhvdXRUcmlnZ2VyRXZlbnRzKCkge1xyXG4gICAgdmFyIHBsYXlQcm9taXNlID0gdGhpcy5hdWRpb0VsZW1lbnQucGxheSgpO1xyXG5cclxuICAgIGlmICggcGxheVByb21pc2UgIT09IHVuZGVmaW5lZCApIHtcclxuICAgICAgcGxheVByb21pc2UudGhlbiggXyA9PiB7IH0gKVxyXG4gICAgICAgIC5jYXRjaCggKCkgPT4ge1xyXG4gICAgICAgICAgdGhpcy5zdG9wKCk7XHJcbiAgICAgICAgfSApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuc2V0Q2xhc3Nlc1BsYXlpbmcoKTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHBhdXNlV2l0aG91dFRyaWdnZXJFdmVudHMoKSB7XHJcbiAgICB0aGlzLmF1ZGlvRWxlbWVudC5wYXVzZSgpO1xyXG4gICAgdGhpcy5zZXRDbGFzc2VzUGF1c2VkKCk7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHNldENsYXNzZXNQbGF5aW5nKCkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoICdhdWRpby1jb21wb25lbnQtcGxheWluZycgKTtcclxuICAgIHRoaXMuX2RpdkJsb2NrSW50ZXJhY3Rpb24uY2xhc3NMaXN0LmFkZCggJ2F1ZGlvLWNvbXBvbmVudC1wbGF5aW5nJyApO1xyXG5cclxuICAgIHRoaXMuX2NvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCAnYXVkaW8tY29tcG9uZW50LXBhdXNlZCcgKTtcclxuICAgIHRoaXMuX2RpdkJsb2NrSW50ZXJhY3Rpb24uY2xhc3NMaXN0LnJlbW92ZSggJ2F1ZGlvLWNvbXBvbmVudC1wYXVzZWQnICk7XHJcbiAgfVxyXG5cclxuICBzZXRDbGFzc2VzUGF1c2VkKCkge1xyXG4gICAgdGhpcy5fY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoICdhdWRpby1jb21wb25lbnQtcGF1c2VkJyApO1xyXG4gICAgdGhpcy5fZGl2QmxvY2tJbnRlcmFjdGlvbi5jbGFzc0xpc3QuYWRkKCAnYXVkaW8tY29tcG9uZW50LXBhdXNlZCcgKTtcclxuXHJcbiAgICB0aGlzLl9jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSggJ2F1ZGlvLWNvbXBvbmVudC1wbGF5aW5nJyApO1xyXG4gICAgdGhpcy5fZGl2QmxvY2tJbnRlcmFjdGlvbi5jbGFzc0xpc3QucmVtb3ZlKCAnYXVkaW8tY29tcG9uZW50LXBsYXlpbmcnICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgcGxheSgpIHtcclxuICAgIHRoaXMucGxheVdpdGhvdXRUcmlnZ2VyRXZlbnRzKCk7XHJcbiAgICB0aGlzLmNhbGxFdmVudHNCeU5hbWUoICdvbnBsYXknLCB0aGlzICk7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBwYXVzZSgpIHtcclxuICAgIHRoaXMucGF1c2VXaXRob3V0VHJpZ2dlckV2ZW50cygpO1xyXG4gICAgdGhpcy5jYWxsRXZlbnRzQnlOYW1lKCAnb25wYXVzZScsIHRoaXMgKTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0b3AoKSB7XHJcbiAgICB0aGlzLnBhdXNlKCk7XHJcbiAgICB0aGlzLmF1ZGlvRWxlbWVudC5jdXJyZW50VGltZSA9IDA7XHJcblxyXG4gICAgdGhpcy5jYWxsRXZlbnRzQnlOYW1lKCAnb25zdG9wJywgdGhpcyApO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgdG9nZ2xlKCkge1xyXG4gICAgaWYgKCB0aGlzLnBhdXNlZCApIHtcclxuICAgICAgdGhpcy5wbGF5V2l0aG91dFRyaWdnZXJFdmVudHMoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMucGF1c2UoKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNhbGxFdmVudHNCeU5hbWUoICdvbnRvZ2dsZScsIHRoaXMgKTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgbXV0ZSgpIHtcclxuICAgIHRoaXMuYXVkaW9FbGVtZW50LnZvbHVtZSA9IDA7XHJcbiAgICB0aGlzLmNhbGxFdmVudHNCeU5hbWUoICdvbm11dGUnLCB0aGlzICk7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHVubXV0ZSgpIHtcclxuICAgIHRoaXMuYXVkaW9FbGVtZW50LnZvbHVtZSA9IDE7XHJcbiAgICB0aGlzLmNhbGxFdmVudHNCeU5hbWUoICdvbnVubXV0ZScsIHRoaXMgKTtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgc2Vlayggc2Vla1RpbWU6IG51bWJlciwgX3JlbG9hZEJ1ZmZlcj86IGJvb2xlYW4gKSB7XHJcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gc2Vla1RpbWU7XHJcbiAgICB0aGlzLmNhbGxFdmVudHNCeU5hbWUoICdvbnNlZWsnLCB0aGlzICk7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXQgZGltZW5zaW9ucygpOiBEaW1lbnNpb25zIHtcclxuICAgIHJldHVybiBnZXRFbGVtZW50RGltZW5zaW9ucyggdGhpcy5fY29udGFpbmVyICk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEludmlzaWJsZURpdkJsb2NrSW50ZXJhY3Rpb24oIGF1ZGlvQ29tcG9uZW50OiBBdWRpb0NvbXBvbmVudCApOiBIVE1MRWxlbWVudCB7XHJcbiAgICBjb25zdCBlbGVtZW50SW52aXNpYmxlRGl2ID0gY3JlYXRlSW52aXNpYmxlRGl2QWJvdmVQYXJlbnQoIHtcclxuICAgICAgcGFyZW50RWxlbWVudDogYXVkaW9Db21wb25lbnQuX2NvbnRhaW5lcixcclxuICAgICAgaWQ6IGBpbnZpc2libGVEaXZCbG9ja0ludGVyYWN0aW9uJHsgYXVkaW9Db21wb25lbnQuX2NvbnRhaW5lci5pZCB9YCxcclxuICAgICAgcG9zaXRpb246IHsgdG9wOiAwLCBsZWZ0OiAwIH0sXHJcbiAgICAgIGRpbWVuc2lvbnM6IHsgd2lkdGg6IGF1ZGlvQ29tcG9uZW50LmRpbWVuc2lvbnMud2lkdGgsIGhlaWdodDogYXVkaW9Db21wb25lbnQuZGltZW5zaW9ucy5oZWlnaHQgfVxyXG4gICAgfSApO1xyXG5cclxuICAgIGVsZW1lbnRJbnZpc2libGVEaXYuY2xhc3NMaXN0LmFkZCggJ2F1ZGlvLWNvbXBvbmVudC1kaXYtYmxvY2staW50ZXJhY3Rpb24nICk7XHJcblxyXG4gICAgcmV0dXJuIGVsZW1lbnRJbnZpc2libGVEaXY7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0dXBJbnZpc2libGVEaXZCbG9ja0ludGVyYWN0aW9uKCkge1xyXG4gICAgdGhpcy5fZGl2QmxvY2tJbnRlcmFjdGlvbi5zdHlsZS5kaXNwbGF5ID0gdGhpcy5fYmxvY2tJbnRlcmFjdGlvbiA/ICdibG9jaycgOiAnbm9uZSc7XHJcbiAgICB0aGlzLl9kaXZCbG9ja0ludGVyYWN0aW9uLnN0eWxlLnpJbmRleCA9ICc5OTUnO1xyXG5cclxuICAgIHRoaXMuX2RpdkJsb2NrSW50ZXJhY3Rpb24uYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICB0aGlzLmNhbGxFdmVudHNCeU5hbWUoICdvbmNsaWNraW50ZXJhY3Rpb25ibG9ja2VkJywgdGhpcywgdGhpcy5fZGl2QmxvY2tJbnRlcmFjdGlvbiApO1xyXG4gICAgICB0aGlzLmNhbGxFdmVudHNCeU5hbWUoICdvbmludGVyYWN0aW9uYmxvY2tlZCcsIHRoaXMsIHRoaXMuX2RpdkJsb2NrSW50ZXJhY3Rpb24gKTtcclxuICAgIH0gKTtcclxuICB9XHJcblxyXG4gIC8vIGF3YWl0cyBhdWRpbyBsb2FkcyBmcm9tIHNvdXJjZSB0aGVuIGNyZWF0ZXMgdGhlIGNvbXBvbmVudFxyXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgY3JlYXRlQXVkaW9Db21wb25lbnRPbkJvZHkoIG9wdGlvbnM6IENyZWF0ZUF1ZGlvQ29tcG9uZW50T3B0aW9ucyApOiBQcm9taXNlPEF1ZGlvQ29tcG9uZW50PiB7XHJcbiAgICBjb25zdCBhdWRpb0NvbXBvbmVudENvbnRhaW5lciA9IGF3YWl0IG5ldyBBdWRpb0NvbXBvbmVudEZhY3RvcnkoIG9wdGlvbnMuc3JjICkuYnVpbGRPbkJvZHkoKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IEF1ZGlvQ29tcG9uZW50KCB7XHJcbiAgICAgIHNyYzogb3B0aW9ucy5zcmMsXHJcbiAgICAgIGNvbnRhaW5lcjogYXVkaW9Db21wb25lbnRDb250YWluZXIsXHJcbiAgICAgIGF1ZGlvRWxlbWVudDogYXVkaW9Db21wb25lbnRDb250YWluZXIucXVlcnlTZWxlY3RvciggJ2F1ZGlvJyApISxcclxuICAgICAgYXVkaW9FbGVtZW50SWQ6IG9wdGlvbnMuYXVkaW9FbGVtZW50SWQsXHJcbiAgICAgIGJsb2NrSW50ZXJhY3Rpb246IG9wdGlvbnMuYmxvY2tJbnRlcmFjdGlvblxyXG4gICAgfSApO1xyXG4gIH1cclxuXHJcbiAgLy8gYXdhaXRzIGF1ZGlvIGxvYWRzIGZyb20gc291cmNlIHRoZW4gY3JlYXRlcyB0aGUgY29tcG9uZW50XHJcbiAgcHVibGljIHN0YXRpYyBhc3luYyBjcmVhdGVBdWRpb0NvbXBvbmVudCggb3B0aW9uczogQ3JlYXRlQXVkaW9Db21wb25lbnRPcHRpb25zICk6IFByb21pc2U8QXVkaW9Db21wb25lbnQ+IHtcclxuICAgIGlmICggb3B0aW9ucy5jb250YWluZXIgPT09IGRvY3VtZW50LmJvZHkgfHwgIW9wdGlvbnMuY29udGFpbmVyICkge1xyXG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVBdWRpb0NvbXBvbmVudE9uQm9keSggb3B0aW9ucyApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGF1ZGlvQ29tcG9uZW50Q29udGFpbmVyID0gYXdhaXQgbmV3IEF1ZGlvQ29tcG9uZW50RmFjdG9yeSggb3B0aW9ucy5zcmMgKS5idWlsZCggb3B0aW9ucy5jb250YWluZXIgKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IEF1ZGlvQ29tcG9uZW50KCB7XHJcbiAgICAgIHNyYzogb3B0aW9ucy5zcmMsXHJcbiAgICAgIGNvbnRhaW5lcjogYXVkaW9Db21wb25lbnRDb250YWluZXIsXHJcbiAgICAgIGF1ZGlvRWxlbWVudDogYXVkaW9Db21wb25lbnRDb250YWluZXIucXVlcnlTZWxlY3RvciggJ2F1ZGlvJyApISxcclxuICAgICAgYXVkaW9FbGVtZW50SWQ6IG9wdGlvbnMuYXVkaW9FbGVtZW50SWQsXHJcbiAgICAgIGJsb2NrSW50ZXJhY3Rpb246IG9wdGlvbnMuYmxvY2tJbnRlcmFjdGlvblxyXG4gICAgfSApO1xyXG4gIH1cclxufSIsImltcG9ydCB7IEF1ZGlvUGxheWVyQ29uZmlnLCBjcmVhdGVJbnZpc2libGVQbGF5ZXIgfSBmcm9tICcuLi9Ub29scy9BdWRpb1Rvb2xzJztcclxuaW1wb3J0IHsgQ29tcG9uZW50Q29udGFpbmVyIH0gZnJvbSAnLi9Db21wb25lbnRDb250YWluZXInO1xyXG5cclxuZXhwb3J0IGNsYXNzIEF1ZGlvQ29tcG9uZW50RmFjdG9yeSBleHRlbmRzIENvbXBvbmVudENvbnRhaW5lciB7XHJcbiAgY29uc3RydWN0b3IoIHNyYzogc3RyaW5nLCBwbGF5ZXJDb25maWc/OiBBdWRpb1BsYXllckNvbmZpZyApIHtcclxuICAgIHN1cGVyKCBcImF1ZGlvQ29tcG9uZW50XCIsIGNyZWF0ZUludmlzaWJsZVBsYXllciggW3NyY10sIHBsYXllckNvbmZpZyApICk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYXN5bmMgYnVpbGRTdWJDb21wb25lbnRzKCBwYXJlbnQ6IEhUTUxFbGVtZW50ICk6IFByb21pc2U8SFRNTEVsZW1lbnRbXSB8IHZvaWQ+IHtcclxuICAgIHJldHVybjtcclxuICB9XHJcbn0iLCJleHBvcnQgYWJzdHJhY3QgY2xhc3MgQ29tcG9uZW50Q29udGFpbmVyIHtcclxuICBwcm90ZWN0ZWQgX2VsZW1lbnQ6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XHJcbiAgcHVibGljIHRlbXBsYXRlRWxlbWVudDogSFRNTFRlbXBsYXRlRWxlbWVudDtcclxuICBwdWJsaWMgcmVhZG9ubHkgY29tcG9uZW50TmFtZTogc3RyaW5nO1xyXG4gIHByb3RlY3RlZCBzdWJDb21wb25lbnRDb3VudEJ5TmFtZTogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTtcclxuICBwcm90ZWN0ZWQgc3ViQ29tcG9uZW50czogSFRNTEVsZW1lbnRbXSA9IFtdO1xyXG5cclxuICAvLy8gVGVtcGxhdGUgaXMgZWl0aGVyIGEgaWQgZm9yIGEgaHRtbCB0ZW1wbGF0ZSBlbGVtZW50IG9yIGFuIGVsZW1lbnQgdGhhdCB3aWxsIGJlIGluc2VydGVkIGFzIGEgdGVtcGxhdGUgaW5zaWRlIGRvY3VtZW50LmJvZHlcclxuICBjb25zdHJ1Y3RvciggY29tcG9uZW50TmFtZTogc3RyaW5nLCB0ZW1wbGF0ZTogc3RyaW5nIHwgSFRNTEVsZW1lbnQgKSB7XHJcbiAgICBpZiAoIHR5cGVvZiB0ZW1wbGF0ZSA9PT0gJ3N0cmluZycgKSB7XHJcbiAgICAgIGNvbnN0IHRlbXBsYXRlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCB0ZW1wbGF0ZSApIGFzIEhUTUxUZW1wbGF0ZUVsZW1lbnQ7XHJcblxyXG4gICAgICBpZiAoICF0ZW1wbGF0ZUVsZW1lbnQgKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCBcIkludmFsaWQgdGVtcGxhdGUgZm9yIHNjZW5lIGNvbXBvbmVudC4gVGVtcGxhdGUgaWQ6IFwiICsgdGVtcGxhdGUgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhpcy50ZW1wbGF0ZUVsZW1lbnQgPSB0ZW1wbGF0ZUVsZW1lbnQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnRlbXBsYXRlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIFwidGVtcGxhdGVcIiApO1xyXG4gICAgICB0aGlzLnRlbXBsYXRlRWxlbWVudC5jb250ZW50LmFwcGVuZENoaWxkKCB0ZW1wbGF0ZSApO1xyXG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCB0aGlzLnRlbXBsYXRlRWxlbWVudCApO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuY29tcG9uZW50TmFtZSA9IGNvbXBvbmVudE5hbWU7XHJcbiAgfVxyXG5cclxuICBwcm90ZWN0ZWQgZ2V0VGVtcGxhdGVDbG9uZU5vZGVzKCk6IEhUTUxDb2xsZWN0aW9uIHtcclxuICAgIHJldHVybiAoIHRoaXMudGVtcGxhdGVFbGVtZW50LmNvbnRlbnQuY2xvbmVOb2RlKCB0cnVlICkgYXMgRG9jdW1lbnRGcmFnbWVudCApLmNoaWxkcmVuO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFic3RyYWN0IGJ1aWxkU3ViQ29tcG9uZW50cyggcGFyZW50OiBIVE1MRWxlbWVudCApOiBQcm9taXNlPEhUTUxFbGVtZW50W10gfCB2b2lkPjtcclxuXHJcbiAgcHJvdGVjdGVkIGFzeW5jIGJ1aWxkU2luZ2xlU3ViQ29tcG9uZW50KCBjb21wb25lbnQ6IENvbXBvbmVudENvbnRhaW5lciwgcGFyZW50OiBIVE1MRWxlbWVudCApOiBQcm9taXNlPEhUTUxFbGVtZW50PiB7XHJcbiAgICBpZiAoIHRoaXMuc3ViQ29tcG9uZW50Q291bnRCeU5hbWUuaGFzKCB0aGlzLmNvbXBvbmVudE5hbWUgKSApIHtcclxuICAgICAgdGhpcy5zdWJDb21wb25lbnRDb3VudEJ5TmFtZS5zZXQoIHRoaXMuY29tcG9uZW50TmFtZSwgMCApO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBjb21wb25lbnRDb3VudCA9IHRoaXMuc3ViQ29tcG9uZW50Q291bnRCeU5hbWUuZ2V0KCB0aGlzLmNvbXBvbmVudE5hbWUgKSE7XHJcblxyXG4gICAgdGhpcy5zdWJDb21wb25lbnRDb3VudEJ5TmFtZS5zZXQoIHRoaXMuY29tcG9uZW50TmFtZSwgY29tcG9uZW50Q291bnQgKyAxICk7XHJcblxyXG4gICAgcmV0dXJuIGF3YWl0IGNvbXBvbmVudC5idWlsZCggcGFyZW50LCBgJHsgdGhpcy5jb21wb25lbnROYW1lIH0keyBjb21wb25lbnQuY29tcG9uZW50TmFtZS5jYXBpdGFsaXplRmlyc3RMZXR0ZXIoKSB9JHsgY29tcG9uZW50Q291bnQgfWAgKTtcclxuICB9XHJcblxyXG4gIC8vLyBHZXRzIHRoZSB0ZW1wbGF0ZSBub2RlcyBhbmQgaW5zZXJ0IHRoZW0gaW50byBhIGNvbnRhaW5lciB0aGVuIHJldHVybnMgdGhlIGNvbnRhaW5lclxyXG4gIHB1YmxpYyBhc3luYyBidWlsZE9uQm9keSggZWxlbWVudElkPzogc3RyaW5nICk6IFByb21pc2U8SFRNTEVsZW1lbnQ+IHtcclxuICAgIHRoaXMuX2VsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAnZGl2JyApO1xyXG5cclxuICAgIGlmICggZWxlbWVudElkICkge1xyXG4gICAgICB0aGlzLl9lbGVtZW50LmlkID0gZWxlbWVudElkO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAoIGxldCBpdGVtIG9mIHRoaXMuZ2V0VGVtcGxhdGVDbG9uZU5vZGVzKCkgKSB7XHJcbiAgICAgIHRoaXMuX2VsZW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCAnYWZ0ZXJiZWdpbicsIGl0ZW0gKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoICF0aGlzLl9lbGVtZW50ICkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoIGBGYWlsIGJ1aWxkaW5nIFNjZW5lQ29tcG9uZW50LiBFbGVtZW50SWQ6ICR7IGVsZW1lbnRJZCB9YCApO1xyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IHRoaXMuYnVpbGRTdWJDb21wb25lbnRzKCBkb2N1bWVudC5ib2R5ICk7XHJcblxyXG4gICAgZG9jdW1lbnQuYm9keS5pbnNlcnRBZGphY2VudEVsZW1lbnQoICdiZWZvcmVlbmQnLCB0aGlzLl9lbGVtZW50ICk7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICAvLy8gR2V0cyB0aGUgdGVtcGxhdGUgbm9kZXMgYW5kIGluc2VydCB0aGVtIGludG8gYSBjb250YWluZXIgdGhlbiByZXR1cm5zIHRoZSBjb250YWluZXJcclxuICBwdWJsaWMgYXN5bmMgYnVpbGQoIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQsIGVsZW1lbnRJZD86IHN0cmluZyApOiBQcm9taXNlPEhUTUxFbGVtZW50PiB7XHJcbiAgICBmb3IgKCBsZXQgaXRlbSBvZiB0aGlzLmdldFRlbXBsYXRlQ2xvbmVOb2RlcygpICkge1xyXG4gICAgICBjb250YWluZXIuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCAnYWZ0ZXJiZWdpbicsIGl0ZW0gKTtcclxuICAgIH1cclxuXHJcbiAgICBhd2FpdCB0aGlzLmJ1aWxkU3ViQ29tcG9uZW50cyggY29udGFpbmVyICk7XHJcblxyXG4gICAgcmV0dXJuIGNvbnRhaW5lcjtcclxuICB9XHJcbn0iLCJcclxuaW50ZXJmYWNlIFN0cmluZyB7XHJcbiAgdHJ1bmNhdGUoIG1heDogbnVtYmVyLCBkZWNvcmF0b3I6IHN0cmluZyApOiBzdHJpbmc7XHJcbiAgcmVtb3ZlQWNjZW50cygpOiBzdHJpbmc7XHJcbiAgY2FwaXRhbGl6ZUZpcnN0TGV0dGVyKCk6IHN0cmluZztcclxuICB6ZXJvQmVmb3JlKCk6IHN0cmluZztcclxuICBpc051bGxPckVtcHR5KCk6IGJvb2xlYW47XHJcbn1cclxuXHJcblN0cmluZy5wcm90b3R5cGUuaXNOdWxsT3JFbXB0eSA9IGZ1bmN0aW9uICgpOiBib29sZWFuIHtcclxuICByZXR1cm4gdHlwZW9mIHRoaXMgIT09ICdzdHJpbmcnICYmICF0aGlzICYmIHRoaXMgIT09ICcnO1xyXG59O1xyXG5cclxuU3RyaW5nLnByb3RvdHlwZS50cnVuY2F0ZSA9IGZ1bmN0aW9uICggbWF4OiBudW1iZXIsIGRlY29yYXRvcjogc3RyaW5nID0gJy4uLicgKTogc3RyaW5nIHtcclxuICByZXR1cm4gKCB0aGlzLmxlbmd0aCA+IG1heCA/IHRoaXMuc3Vic3RyaW5nKCAwLCBtYXggKSArIGRlY29yYXRvciA6IHRoaXMgKS50b1N0cmluZygpO1xyXG59O1xyXG5cclxuU3RyaW5nLnByb3RvdHlwZS5yZW1vdmVBY2NlbnRzID0gZnVuY3Rpb24gKCkge1xyXG4gIHJldHVybiB0aGlzLm5vcm1hbGl6ZSggJ05GRCcgKS5yZXBsYWNlKCAvW1xcdTAzMDAtXFx1MDM2Zl0vZywgXCJcIiApO1xyXG59XHJcblxyXG5TdHJpbmcucHJvdG90eXBlLmNhcGl0YWxpemVGaXJzdExldHRlciA9IGZ1bmN0aW9uICgpOiBzdHJpbmcge1xyXG4gIGlmICggdHlwZW9mIHRoaXMgIT09ICdzdHJpbmcnICkge1xyXG4gICAgcmV0dXJuICcnO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHRoaXMuY2hhckF0KCAwICkudG9VcHBlckNhc2UoKSArIHRoaXMuc3Vic3RyaW5nKCAxICk7XHJcbn1cclxuXHJcblN0cmluZy5wcm90b3R5cGUuemVyb0JlZm9yZSA9IGZ1bmN0aW9uICgpIHtcclxuICByZXR1cm4gdGhpcy5wYWRTdGFydCggMiwgJzAnICk7XHJcbn0iLCJcclxuZXhwb3J0IGNsYXNzIE9iamVjdEV2ZW50TGlzdGVuZXIge1xyXG4gIHB1YmxpYyBldmVudHNCeU5hbWU6IE1hcDxzdHJpbmcsIEZ1bmN0aW9uW10+ID0gbmV3IE1hcCgpO1xyXG5cclxuICBwdWJsaWMgYWRkRXZlbnRMaXN0ZW5lciggZXZlbnROYW1lOiBzdHJpbmcsIGV2ZW50OiBGdW5jdGlvbiApIHtcclxuICAgIGlmICggIXRoaXMuZXZlbnRzQnlOYW1lLmhhcyggZXZlbnROYW1lLnRvTG93ZXJDYXNlKCkgKSApIHtcclxuICAgICAgdGhpcy5ldmVudHNCeU5hbWUuc2V0KCBldmVudE5hbWUudG9Mb3dlckNhc2UoKSwgW2V2ZW50XSApO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5ldmVudHNCeU5hbWUuZ2V0KCBldmVudE5hbWUudG9Mb3dlckNhc2UoKSApIS5wdXNoKCBldmVudCApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEV2ZW50c0J5TmFtZSggZXZlbnROYW1lOiBzdHJpbmcgKTogRnVuY3Rpb25bXSB7XHJcbiAgICBpZiAoICF0aGlzLmV2ZW50c0J5TmFtZS5oYXMoIGV2ZW50TmFtZS50b0xvd2VyQ2FzZSgpICkgKSB7XHJcbiAgICAgIHRoaXMuZXZlbnRzQnlOYW1lLnNldCggZXZlbnROYW1lLnRvTG93ZXJDYXNlKCksIFtdICk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuZXZlbnRzQnlOYW1lLmdldCggZXZlbnROYW1lLnRvTG93ZXJDYXNlKCkgKSE7XHJcbiAgfVxyXG5cclxuXHJcbiAgcHVibGljIGNhbGxFdmVudHNCeU5hbWUoIGV2ZW50TmFtZTogc3RyaW5nLCAuLi5ldmVudEFyZ3M6IGFueVtdICk6IHZvaWQge1xyXG4gICAgdGhpcy5nZXRFdmVudHNCeU5hbWUoIGV2ZW50TmFtZSApLmZvckVhY2goIGUgPT4gZSggLi4uZXZlbnRBcmdzICkgKTtcclxuICB9XHJcbn0iLCJpbXBvcnQgJy4uL0V4dGVuc2lvbnMvU3RyaW5nRXh0ZW5zaW9ucyc7XHJcbmltcG9ydCB7IGdldEVsZW1lbnRGcm9tSFRNTCwgaGlkZUVsZW1lbnQgfSBmcm9tICcuL0RPTVRvb2xzJztcclxuaW1wb3J0IHsgZ2V0RmlsZUV4dGVuc2lvbiB9IGZyb20gJy4vRmlsZVRvb2xzJztcclxuaW1wb3J0IHsgQXVkaW9Db21wb25lbnQsIENyZWF0ZUF1ZGlvQ29tcG9uZW50T3B0aW9ucyB9IGZyb20gJy4uL0NvbXBvbmVudHMvQXVkaW9Db21wb25lbnQnO1xyXG5cclxuZXhwb3J0IHR5cGUgQXVkaW9QbGF5ZXJDb25maWcgPSB7XHJcbiAgaWQ/OiBzdHJpbmc7XHJcbiAgYXV0b1BsYXk/OiBib29sZWFuO1xyXG4gIGF1dG9wbGF5PzogYm9vbGVhbjtcclxuICBtdXRlZD86IGJvb2xlYW47XHJcbiAgbG9vcD86IGJvb2xlYW47XHJcbiAgcHJlbG9hZD86ICdhdXRvJyB8ICdtZXRhZGF0YScgfCAnbm9uZSc7XHJcbiAgb25wbGF5PzogKCBhdWRpb0VsZW1lbnQ6IEhUTUxBdWRpb0VsZW1lbnQgKSA9PiB2b2lkO1xyXG4gIG9ucGF1c2U/OiAoIGF1ZGlvRWxlbWVudDogSFRNTEF1ZGlvRWxlbWVudCApID0+IHZvaWQ7XHJcbiAgb25QbGF5PzogKCBhdWRpb0VsZW1lbnQ6IEhUTUxBdWRpb0VsZW1lbnQgKSA9PiB2b2lkO1xyXG4gIG9uUGF1c2U/OiAoIGF1ZGlvRWxlbWVudDogSFRNTEF1ZGlvRWxlbWVudCApID0+IHZvaWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBdWRpb0NvbXBvbmVudE9uQm9keSggb3B0aW9uczogQ3JlYXRlQXVkaW9Db21wb25lbnRPcHRpb25zICkge1xyXG4gIHJldHVybiBhd2FpdCBBdWRpb0NvbXBvbmVudC5jcmVhdGVBdWRpb0NvbXBvbmVudE9uQm9keSggb3B0aW9ucyApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlSW52aXNpYmxlUGxheWVyKCBhcnJTb3VyY2VzOiBzdHJpbmdbXSwgcGxheWVyQ29uZmlnPzogQXVkaW9QbGF5ZXJDb25maWcgKSB7XHJcbiAgY29uc3QgYXVkaW9FbGVtZW50ID0gZ2V0RWxlbWVudEZyb21IVE1MKCBhdWRpb0VsZW1lbnRIVE1MKCBhcnJTb3VyY2VzLCBwbGF5ZXJDb25maWcgKSApIGFzIEhUTUxFbGVtZW50O1xyXG4gIGRvY3VtZW50LmJvZHkuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCAnYWZ0ZXJiZWdpbicsIGF1ZGlvRWxlbWVudCApO1xyXG4gIGhpZGVFbGVtZW50KCBhdWRpb0VsZW1lbnQgKTtcclxuICByZXR1cm4gYXVkaW9FbGVtZW50O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYXVkaW9FbGVtZW50SFRNTCggYXJyU291cmNlczogc3RyaW5nW10sIHBsYXllckNvbmZpZz86IEF1ZGlvUGxheWVyQ29uZmlnICkge1xyXG4gIHJldHVybiBgPGF1ZGlvIGNvbnRyb2xzICR7IHBsYXllckNvbmZpZyA/IGF1ZGlvRWxlbWVudFBhcmFtc0J5UGxheWVyQ29uZmlnKCBwbGF5ZXJDb25maWcgKSA6IFwiXCIgfT5cclxuICAgICR7IGFyclNvdXJjZXMubWFwKCBzcmMgPT4gc291cmNlRWxlbWVudEhUTUwoIHNyYyApICkucmVkdWNlKCAoIGFjYywgbmV4dCApID0+IGFjYyArIG5leHQsICcnICkgfVxyXG4gIDwvYXVkaW8+YDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNvdXJjZUVsZW1lbnRIVE1MKCBzcmM6IHN0cmluZyApIHtcclxuICByZXR1cm4gYDxzb3VyY2Ugc3JjPVwiJHsgc3JjIH1cIiB0eXBlPVwiYXVkaW8vJHsgZ2V0RmlsZUV4dGVuc2lvbiggc3JjICkgfVwiPmA7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGF1ZGlvRWxlbWVudFBhcmFtc0J5UGxheWVyQ29uZmlnKCBwbGF5ZXJDb25maWc6IEF1ZGlvUGxheWVyQ29uZmlnICkge1xyXG4gIGNvbnN0IHBhcmFtSWQgPSBwbGF5ZXJDb25maWcuaWQgPyAnaWQ9XCInICsgcGxheWVyQ29uZmlnLmlkICsgJ1wiJyA6ICcnO1xyXG4gIGNvbnN0IHBhcmFtQXV0b1BsYXkgPSBwbGF5ZXJDb25maWcuYXV0b1BsYXkgfHwgcGxheWVyQ29uZmlnLmF1dG9wbGF5ID8gJ2F1dG9wbGF5JyA6ICcnO1xyXG4gIGNvbnN0IHBhcmFtTXV0ZWQgPSBwbGF5ZXJDb25maWcubXV0ZWQgPyAnbXV0ZWQnIDogJyc7XHJcbiAgY29uc3QgcGFyYW1Mb29wID0gcGxheWVyQ29uZmlnLmxvb3AgPyAnbG9vcCcgOiAnJztcclxuICBjb25zdCBwYXJhbVByZWxvYWQgPSBwbGF5ZXJDb25maWcucHJlbG9hZCA/ICdwcmVsb2FkPVwiJyArIHBsYXllckNvbmZpZy5wcmVsb2FkICsgJ1wiJyA6ICcnO1xyXG5cclxuICByZXR1cm4gYCAkeyBwYXJhbUlkIH0gJHsgcGFyYW1BdXRvUGxheSB9ICR7IHBhcmFtTXV0ZWQgfSAkeyBwYXJhbUxvb3AgfSAkeyBwYXJhbVByZWxvYWQgfWAudHJpbUVuZCgpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRQbGF5QnV0dG9uRWxlbWVudCggYXVkaW9FbGVtZW50OiBIVE1MQXVkaW9FbGVtZW50LCBwbGF5ZXJDb25maWc/OiBBdWRpb1BsYXllckNvbmZpZyApIHtcclxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2J1dHRvbicgKTtcclxuICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoICdwbGF5LWJ1dHRvbicgKTtcclxuXHJcbiAgc2V0VGltZW91dCggKCkgPT4ge1xyXG4gICAgaWYgKCBhdWRpb0VsZW1lbnQucGF1c2VkICkge1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoICdwYXVzZWQnICk7XHJcbiAgICB9XHJcbiAgfSwgMzAwICk7XHJcblxyXG4gIGJ1dHRvbkVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgaWYgKCBhdWRpb0VsZW1lbnQucGF1c2VkICkge1xyXG4gICAgICBhdWRpb0VsZW1lbnQucGxheSgpO1xyXG4gICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoICdwYXVzZWQnICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBhdWRpb0VsZW1lbnQucGF1c2UoKTtcclxuICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKCAncGF1c2VkJyApO1xyXG4gICAgfVxyXG4gIH0gKTtcclxuXHJcbiAgc2V0QXVkaW9FbGVtZW50UGxheVBhdXNlRXZlbnRzKCBidXR0b25FbGVtZW50LCBhdWRpb0VsZW1lbnQsIHBsYXllckNvbmZpZyApO1xyXG5cclxuICByZXR1cm4gYnV0dG9uRWxlbWVudDtcclxufVxyXG5cclxuXHJcbmZ1bmN0aW9uIHNldEF1ZGlvRWxlbWVudFBsYXlQYXVzZUV2ZW50cyggYnV0dG9uRWxlbWVudDogSFRNTEJ1dHRvbkVsZW1lbnQsIGF1ZGlvRWxlbWVudDogSFRNTEF1ZGlvRWxlbWVudCwgcGxheWVyQ29uZmlnPzogQXVkaW9QbGF5ZXJDb25maWcgKSB7XHJcbiAgYXVkaW9FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdwbGF5JywgKCkgPT4ge1xyXG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCAncGF1c2VkJyApO1xyXG4gICAgaWYgKCBwbGF5ZXJDb25maWcgJiYgcGxheWVyQ29uZmlnLm9uUGxheSApIHtcclxuICAgICAgcGxheWVyQ29uZmlnLm9uUGxheSggYXVkaW9FbGVtZW50ICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCBwbGF5ZXJDb25maWcgJiYgcGxheWVyQ29uZmlnLm9ucGxheSApIHtcclxuICAgICAgcGxheWVyQ29uZmlnLm9ucGxheSggYXVkaW9FbGVtZW50ICk7XHJcbiAgICB9XHJcbiAgfSApO1xyXG5cclxuICBhdWRpb0VsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ3BhdXNlJywgKCkgPT4ge1xyXG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKCAncGF1c2VkJyApO1xyXG4gICAgaWYgKCBwbGF5ZXJDb25maWcgJiYgcGxheWVyQ29uZmlnLm9uUGF1c2UgKSB7XHJcbiAgICAgIHBsYXllckNvbmZpZy5vblBhdXNlKCBhdWRpb0VsZW1lbnQgKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIHBsYXllckNvbmZpZyAmJiBwbGF5ZXJDb25maWcub25wYXVzZSApIHtcclxuICAgICAgcGxheWVyQ29uZmlnLm9ucGF1c2UoIGF1ZGlvRWxlbWVudCApO1xyXG4gICAgfVxyXG4gIH0gKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwbGF5QnV0dG9uQ1NTKCkge1xyXG4gIHJldHVybiBgXHJcbiAgICAucGxheS1idXR0b24ge1xyXG4gICAgICBtYXJnaW46IDA7XHJcbiAgICAgIHBhZGRpbmc6IDA7XHJcbiAgICAgIGRpc3BsYXk6IGZsZXg7XHJcbiAgICAgIGJvcmRlcjogMDtcclxuICAgICAgYmFja2dyb3VuZDogdHJhbnNwYXJlbnQ7XHJcbiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7XHJcbiAgICAgIHdpZHRoOiAwO1xyXG4gICAgICBoZWlnaHQ6IDM0cHg7XHJcbiAgICAgIGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgIzIwMjAyMDtcclxuICAgICAgdHJhbnNpdGlvbjogMTAwbXMgYWxsIGVhc2U7XHJcbiAgICAgIGN1cnNvcjogcG9pbnRlcjtcclxuICAgICAgYm9yZGVyLXN0eWxlOiBkb3VibGU7XHJcbiAgICAgIGJvcmRlci13aWR0aDogMHB4IDAgMHB4IDMwcHg7XHJcbiAgICB9XHJcblxyXG4gICAgLnBsYXktYnV0dG9uLnBhdXNlZCB7XHJcbiAgICAgIGJvcmRlci1zdHlsZTogc29saWQ7XHJcbiAgICAgIGJvcmRlci13aWR0aDogMjNweCAwcHggMjNweCAzNHB4O1xyXG4gICAgfVxyXG5cclxuICAgIC5wbGF5LWJ1dHRvbjpob3ZlciB7XHJcbiAgICAgIGJvcmRlci1jb2xvcjogdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgdHJhbnNwYXJlbnQgIzQwNDA0MDtcclxuICAgIH1cclxuICBgO1xyXG59XHJcblxyXG5leHBvcnQgeyBDcmVhdGVBdWRpb0NvbXBvbmVudE9wdGlvbnMgfTsiLCJpbXBvcnQgeyBEaW1lbnNpb25zLCBQb2ludDJELCBsZXJwLCByZWdleE51bWJlclBhdHRlcm4sIHJvdGF0ZUNvb3JkaW5hdGVzLCByb3RhdGVDb29yZGluYXRlc0Zyb21Qb2ludDJEIH0gZnJvbSAnLi9NYXRoVG9vbHMnO1xyXG5pbXBvcnQgeyB0b1Bob25lTnVtYmVyIH0gZnJvbSAnLi9TdHJpbmdUb29scyc7XHJcbmltcG9ydCB7IENvbGxpc2lvbkRpcmVjdGlvbkNoZWNrLCBCb3JkZXJEaXN0YW5jZSB9IGZyb20gJy4uL0V4dHJhcy9Db2xsaXNpb25FdmVudHMvVHlwZXMnO1xyXG5cclxuZXhwb3J0IHR5cGUgS2V5Ym9hcmRFdmVudENhbGxiYWNrID0gKCBldnQ6IEtleWJvYXJkRXZlbnQgKSA9PiB2b2lkO1xyXG5leHBvcnQgY29uc3QgcmVnZXhSZW1vdmVUcmFuc2xhdGVGcm9tVHJhbnNmb3JtID0gL3RyYW5zbGF0ZVxcKFteKV0qXFwpL2c7XHJcbmV4cG9ydCBjb25zdCByZWdleEdyb3VwUm90YXRlVmFsdWUgPSAvcm90YXRlXFwoKC0/XFxkK1xcLj9cXGQqKWRlZ1xcKS87XHJcbmV4cG9ydCBjb25zdCByZWdleEdyb3VwUm90YXRlWFZhbHVlID0gL3JvdGF0ZVhcXCgoLT9cXGQrXFwuP1xcZCopZGVnXFwpLztcclxuZXhwb3J0IGNvbnN0IHJlZ2V4R3JvdXBSb3RhdGVZVmFsdWUgPSAvcm90YXRlWVxcKCgtP1xcZCtcXC4/XFxkKilkZWdcXCkvO1xyXG5leHBvcnQgY29uc3QgcmVnZXhHcm91cFJvdGF0ZVpWYWx1ZSA9IC9yb3RhdGVaXFwoKC0/XFxkK1xcLj9cXGQqKWRlZ1xcKS87XHJcblxyXG5leHBvcnQgY29uc3QgZGljdEtleXNCeUFjdGlvbktleWRvd25PbmNlID0gbmV3IE1hcDxzdHJpbmcsIEtleWJvYXJkRXZlbnRDYWxsYmFja1tdPigpO1xyXG5leHBvcnQgY29uc3QgZGljdEtleXNCeUFjdGlvbktleWRvd25SZXBlYXQgPSBuZXcgTWFwPHN0cmluZywgS2V5Ym9hcmRFdmVudENhbGxiYWNrW10+KCk7XHJcbmV4cG9ydCBjb25zdCBkaWN0S2V5c0J5QWN0aW9uS2V5dXAgPSBuZXcgTWFwPHN0cmluZywgS2V5Ym9hcmRFdmVudENhbGxiYWNrW10+KCk7XHJcbmV4cG9ydCBmdW5jdGlvbiBhZGRBY3Rpb25LZXkoIHsga2V5LCBrZXlkb3duOiBldmVudEtleWRvd24sIGtleXVwOiBldmVudEtleXVwLCBleGVjdXRlT25seU9uY2UgPSB0cnVlIH06IHsga2V5OiBzdHJpbmc7IGtleWRvd246IEtleWJvYXJkRXZlbnRDYWxsYmFjazsga2V5dXA/OiBLZXlib2FyZEV2ZW50Q2FsbGJhY2s7IGV4ZWN1dGVPbmx5T25jZT86IGJvb2xlYW47IH0gKSB7XHJcbiAgaWYgKCBleGVjdXRlT25seU9uY2UgKSB7XHJcbiAgICBhZGRBY3Rpb25LZXlSdW5PbmNlKCBrZXksIGV2ZW50S2V5ZG93biwgZXZlbnRLZXl1cCApO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgYWRkQWN0aW9uS2V5UnVuT25SZXBlYXQoIGtleSwgZXZlbnRLZXlkb3duLCBldmVudEtleXVwICk7XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIFNhZmVQcm9taXNlPFQ+ID0ge1xyXG4gIGRhdGE6ICgpID0+IFQ7XHJcbiAgZXJyb3I6IEVycm9yIHwgbnVsbDtcclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZVByb21pc2U8VD4oIHByb21pc2U6IFByb21pc2U8VD4gKTogUHJvbWlzZTxTYWZlUHJvbWlzZTxUPj4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcHJvbWlzZTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBkYXRhOiAoKSA9PiBkYXRhLFxyXG4gICAgICBlcnJvcjogbnVsbFxyXG4gICAgfTtcclxuICB9IGNhdGNoICggZXJyb3IgKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCBlcnJvciApO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGRhdGE6ICgpID0+IHsgdGhyb3cgbmV3IEVycm9yKCBcIkNvdWxkbid0IGZldGNoLCBjaGVjayBTYWZlUHJvbWlzZS5lcnJvciBmb3IgZGV0YWlscy5cIiApOyB9LFxyXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKCBTdHJpbmcoIGVycm9yICkgKVxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50RnJvbUhUTUwoIGh0bWw6IHN0cmluZywgdHJpbTogYm9vbGVhbiA9IHRydWUgKSB7XHJcbiAgaHRtbCA9IHRyaW0gPyBodG1sLnRyaW0oKSA6IGh0bWw7XHJcblxyXG4gIGlmICggIWh0bWwgKSB7XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIGNvbnN0IHRlbXBsYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ3RlbXBsYXRlJyApO1xyXG4gIHRlbXBsYXRlLmlubmVySFRNTCA9IGh0bWw7XHJcbiAgY29uc3QgcmVzdWx0ID0gdGVtcGxhdGUuY29udGVudC5jaGlsZHJlbjtcclxuXHJcbiAgaWYgKCByZXN1bHQubGVuZ3RoID09PSAxICkge1xyXG4gICAgcmV0dXJuIHJlc3VsdFswXSBhcyBIVE1MRWxlbWVudDtcclxuICB9XHJcblxyXG4gIHJldHVybiBBcnJheS5mcm9tKCByZXN1bHQgKSBhcyBIVE1MRWxlbWVudFtdO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxlbWVudERpbWVuc2lvbnNCeUlkKCBlbGVtZW50SWQ6IHN0cmluZyApOiBEaW1lbnNpb25zIHtcclxuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIGVsZW1lbnRJZCApO1xyXG5cclxuICBpZiAoICFlbGVtZW50ICkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKCBcIkludmFsaWQgZWxlbWVudCBhdCBnZXRFbGVtZW50RGltZW5zaW9uc0J5SWQgd2l0aCBpZDogXCIgKyBlbGVtZW50SWQgKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBnZXRFbGVtZW50RGltZW5zaW9ucyggZWxlbWVudCApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RWxlbWVudERpbWVuc2lvbnMoIGVsZW1lbnQ6IEhUTUxFbGVtZW50ICk6IERpbWVuc2lvbnMge1xyXG4gIHZhciByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHdpZHRoOiByZWN0LndpZHRoLFxyXG4gICAgaGVpZ2h0OiByZWN0LmhlaWdodFxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJvdGF0ZWRCb3VuZGluZ0JveEJhc2VkT25Cb2R5Um90YXRpb24oIGVsZW1lbnQ6IEhUTUxFbGVtZW50ICk6IERPTVJlY3Qge1xyXG4gIGNvbnN0IHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gIGNvbnN0IGNlbnRlclggPSByZWN0LmxlZnQgKyByZWN0LndpZHRoIC8gMjtcclxuICBjb25zdCBjZW50ZXJZID0gcmVjdC50b3AgKyByZWN0LmhlaWdodCAvIDI7XHJcblxyXG4gIC8vIFJvdGF0aW9uIGFuZ2xlIGluIGRlZ3JlZXMgKGV4dHJhY3RlZCBmcm9tIHN0eWxlLnRyYW5zZm9ybSBvciBhbnkgb3RoZXIgc291cmNlKVxyXG4gIGNvbnN0IHJvdGF0aW9uQW5nbGUgPSBnZXRCb2R5Um90YXRpb25JbkRlZ3JlZXMoKTtcclxuXHJcbiAgY29uc3QgcmFkaWFucyA9ICggTWF0aC5QSSAvIDE4MCApICogcm90YXRpb25BbmdsZTtcclxuICBjb25zdCBjb3NUaGV0YSA9IE1hdGguY29zKCByYWRpYW5zICk7XHJcbiAgY29uc3Qgc2luVGhldGEgPSBNYXRoLnNpbiggcmFkaWFucyApO1xyXG5cclxuICAvLyBDYWxjdWxhdGUgdGhlIHJvdGF0ZWQgY29vcmRpbmF0ZXNcclxuICBjb25zdCByb3RhdGVkWDEgPSBjZW50ZXJYICsgKCByZWN0LmxlZnQgLSBjZW50ZXJYICkgKiBjb3NUaGV0YSAtICggcmVjdC50b3AgLSBjZW50ZXJZICkgKiBzaW5UaGV0YTtcclxuICBjb25zdCByb3RhdGVkWTEgPSBjZW50ZXJZICsgKCByZWN0LmxlZnQgLSBjZW50ZXJYICkgKiBzaW5UaGV0YSArICggcmVjdC50b3AgLSBjZW50ZXJZICkgKiBjb3NUaGV0YTtcclxuXHJcbiAgY29uc3Qgcm90YXRlZFgyID0gY2VudGVyWCArICggcmVjdC5yaWdodCAtIGNlbnRlclggKSAqIGNvc1RoZXRhIC0gKCByZWN0LmJvdHRvbSAtIGNlbnRlclkgKSAqIHNpblRoZXRhO1xyXG4gIGNvbnN0IHJvdGF0ZWRZMiA9IGNlbnRlclkgKyAoIHJlY3QucmlnaHQgLSBjZW50ZXJYICkgKiBzaW5UaGV0YSArICggcmVjdC5ib3R0b20gLSBjZW50ZXJZICkgKiBjb3NUaGV0YTtcclxuXHJcbiAgLy8gQ2FsY3VsYXRlIGxlZnQsIHRvcCwgYm90dG9tLCBhbmQgcmlnaHQgY29vcmRpbmF0ZXNcclxuICBjb25zdCByb3RhdGVkTGVmdCA9IE1hdGgubWluKCByb3RhdGVkWDEsIHJvdGF0ZWRYMiApO1xyXG4gIGNvbnN0IHJvdGF0ZWRUb3AgPSBNYXRoLm1pbiggcm90YXRlZFkxLCByb3RhdGVkWTIgKTtcclxuICBjb25zdCByb3RhdGVkQm90dG9tID0gTWF0aC5tYXgoIHJvdGF0ZWRZMSwgcm90YXRlZFkyICk7XHJcbiAgY29uc3Qgcm90YXRlZFJpZ2h0ID0gTWF0aC5tYXgoIHJvdGF0ZWRYMSwgcm90YXRlZFgyICk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICB4OiByb3RhdGVkTGVmdCxcclxuICAgIHk6IHJvdGF0ZWRUb3AsXHJcbiAgICB3aWR0aDogcmVjdC53aWR0aCxcclxuICAgIGhlaWdodDogcmVjdC5oZWlnaHQsXHJcbiAgICB0b0pTT046IHJlY3QudG9KU09OLFxyXG4gICAgbGVmdDogcm90YXRlZExlZnQsXHJcbiAgICB0b3A6IHJvdGF0ZWRUb3AsXHJcbiAgICBib3R0b206IHJvdGF0ZWRCb3R0b20sXHJcbiAgICByaWdodDogcm90YXRlZFJpZ2h0LFxyXG4gIH0gYXMgRE9NUmVjdDtcclxufVxyXG5cclxuZnVuY3Rpb24gYWRkQWN0aW9uS2V5UnVuT25jZSgga2V5OiBzdHJpbmcsIGV2ZW50S2V5ZG93bjogS2V5Ym9hcmRFdmVudENhbGxiYWNrLCBldmVudEtleXVwPzogS2V5Ym9hcmRFdmVudENhbGxiYWNrICkge1xyXG4gIGlmICggZGljdEtleXNCeUFjdGlvbktleWRvd25PbmNlLmhhcygga2V5ICkgKSB7XHJcbiAgICBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93bk9uY2Uuc2V0KCBrZXksIFtldmVudEtleWRvd24sIC4uLmRpY3RLZXlzQnlBY3Rpb25LZXlkb3duT25jZS5nZXQoIGtleSApIV0gKVxyXG4gIH0gZWxzZSB7XHJcbiAgICBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93bk9uY2Uuc2V0KCBrZXksIFtldmVudEtleWRvd25dIClcclxuICB9XHJcblxyXG4gIGlmICggZXZlbnRLZXl1cCApIHtcclxuICAgIGlmICggZGljdEtleXNCeUFjdGlvbktleXVwLmhhcygga2V5ICkgKSB7XHJcbiAgICAgIGRpY3RLZXlzQnlBY3Rpb25LZXl1cC5zZXQoIGtleSwgW2V2ZW50S2V5dXAsIC4uLmRpY3RLZXlzQnlBY3Rpb25LZXl1cC5nZXQoIGtleSApIV0gKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGljdEtleXNCeUFjdGlvbktleXVwLnNldCgga2V5LCBbZXZlbnRLZXl1cF0gKVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gYWRkQWN0aW9uS2V5UnVuT25SZXBlYXQoIGtleTogc3RyaW5nLCBldmVudEtleWRvd246IEtleWJvYXJkRXZlbnRDYWxsYmFjaywgZXZlbnRLZXl1cD86IEtleWJvYXJkRXZlbnRDYWxsYmFjayApIHtcclxuICBpZiAoIGRpY3RLZXlzQnlBY3Rpb25LZXlkb3duUmVwZWF0Lmhhcygga2V5ICkgKSB7XHJcbiAgICBkaWN0S2V5c0J5QWN0aW9uS2V5ZG93blJlcGVhdC5zZXQoIGtleSwgW2V2ZW50S2V5ZG93biwgLi4uZGljdEtleXNCeUFjdGlvbktleWRvd25SZXBlYXQuZ2V0KCBrZXkgKSFdIClcclxuICB9IGVsc2Uge1xyXG4gICAgZGljdEtleXNCeUFjdGlvbktleWRvd25SZXBlYXQuc2V0KCBrZXksIFtldmVudEtleWRvd25dIClcclxuICB9XHJcblxyXG4gIGlmICggZXZlbnRLZXl1cCApIHtcclxuICAgIGlmICggZGljdEtleXNCeUFjdGlvbktleXVwLmhhcygga2V5ICkgKSB7XHJcbiAgICAgIGRpY3RLZXlzQnlBY3Rpb25LZXl1cC5zZXQoIGtleSwgW2V2ZW50S2V5dXAsIC4uLmRpY3RLZXlzQnlBY3Rpb25LZXl1cC5nZXQoIGtleSApIV0gKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGljdEtleXNCeUFjdGlvbktleXVwLnNldCgga2V5LCBbZXZlbnRLZXl1cF0gKVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrRWxlbWVudENvbGxpc2lvbiggZWxlbWVudDE6IEhUTUxFbGVtZW50LCBlbGVtZW50MjogSFRNTEVsZW1lbnQsIGNoZWNrQm9keVJvdGF0aW9uOiBib29sZWFuID0gZmFsc2UgKTogYm9vbGVhbiB7XHJcbiAgY29uc3QgcmVjdDEgPSAhY2hlY2tCb2R5Um90YXRpb24gPyBlbGVtZW50MS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IGdldFJvdGF0ZWRCb3VuZGluZ0JveEJhc2VkT25Cb2R5Um90YXRpb24oIGVsZW1lbnQxICk7XHJcbiAgY29uc3QgcmVjdDIgPSAhY2hlY2tCb2R5Um90YXRpb24gPyBlbGVtZW50Mi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IGdldFJvdGF0ZWRCb3VuZGluZ0JveEJhc2VkT25Cb2R5Um90YXRpb24oIGVsZW1lbnQyICk7XHJcblxyXG4gIGNvbnN0IHJlc3VsdCA9ICEoXHJcbiAgICByZWN0MS50b3AgPiByZWN0Mi5ib3R0b20gfHxcclxuICAgIHJlY3QxLnJpZ2h0IDwgcmVjdDIubGVmdCB8fFxyXG4gICAgcmVjdDEuYm90dG9tIDwgcmVjdDIudG9wIHx8XHJcbiAgICByZWN0MS5sZWZ0ID4gcmVjdDIucmlnaHRcclxuICApO1xyXG5cclxuICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcG9sbEZvclZhcmlhYmxlPFQ+KCB2YXJpYWJsZU5hbWU6IHN0cmluZywgcmVhZHlDb25kaXRpb246ICggdmFsdWU6IFQgKSA9PiBib29sZWFuLCBjYWxsYmFjazogKCB2YWx1ZTogVCApID0+IHZvaWQgKSB7XHJcbiAgY29uc3QgcG9sbEludGVydmFsID0gMTAwO1xyXG4gIGNvbnN0IHBvbGwgPSBzZXRJbnRlcnZhbCggKCkgPT4ge1xyXG4gICAgaWYgKCAoIHdpbmRvdyBhcyBhbnkgKVt2YXJpYWJsZU5hbWVdICE9PSB1bmRlZmluZWQgJiYgcmVhZHlDb25kaXRpb24oICggd2luZG93IGFzIGFueSApW3ZhcmlhYmxlTmFtZV0gKSApIHtcclxuICAgICAgLy8gSWYgYm90aCBjb25kaXRpb25zIGFyZSBtZXQsIGV4ZWN1dGUgdGhlIGNhbGxiYWNrIGFuZCBzdG9wIHBvbGxpbmdcclxuICAgICAgY2xlYXJJbnRlcnZhbCggcG9sbCApO1xyXG4gICAgICBjYWxsYmFjayggKCB3aW5kb3cgYXMgYW55IClbdmFyaWFibGVOYW1lXSApO1xyXG4gICAgfVxyXG4gIH0sIHBvbGxJbnRlcnZhbCApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gd2FpdFVudGlsRWxlbWVudEV4aXN0cyggc2VsZWN0b3I6IHN0cmluZyApIHtcclxuICByZXR1cm4gbmV3IFByb21pc2UoIHJlc29sdmUgPT4ge1xyXG4gICAgaWYgKCBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBzZWxlY3RvciApICkge1xyXG4gICAgICByZXR1cm4gcmVzb2x2ZSggZG9jdW1lbnQucXVlcnlTZWxlY3Rvciggc2VsZWN0b3IgKSApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoIG11dGF0aW9ucyA9PiB7XHJcbiAgICAgIGlmICggZG9jdW1lbnQucXVlcnlTZWxlY3Rvciggc2VsZWN0b3IgKSApIHtcclxuICAgICAgICBvYnNlcnZlci5kaXNjb25uZWN0KCk7XHJcbiAgICAgICAgcmVzb2x2ZSggZG9jdW1lbnQucXVlcnlTZWxlY3Rvciggc2VsZWN0b3IgKSApO1xyXG4gICAgICB9XHJcbiAgICB9ICk7XHJcblxyXG4gICAgb2JzZXJ2ZXIub2JzZXJ2ZSggZG9jdW1lbnQuYm9keSwge1xyXG4gICAgICBjaGlsZExpc3Q6IHRydWUsXHJcbiAgICAgIHN1YnRyZWU6IHRydWVcclxuICAgIH0gKTtcclxuICB9ICk7XHJcbn1cclxuXHJcbi8vLyBHZXQgdGhlIGRlZmF1bHQgYXR0cmlidXRlcyBmcm9tIHRoZSB0YXJnZXQgZWxlbWVudFxyXG4vLy8gSWYgaGF2ZSBub3QgZGVmYXVsdCBhdHRyaWJ1dGUgd2l0aCB0aGlzIEBhdHRyaWJ1dGVOYW1lIG9uIG1hcCB3aWxsIHNldCB0aGUgY3VycmVudCBhdHRyaWJ1dGUgYXMgZGVmYXVsdFxyXG4vLy8gSWYgaGF2ZSBub3QgZGVmYXVsdCBhdHRyaWJ1dGUgd2l0aCB0aGlzIEBhdHRyaWJ1dGVOYW1lIHdpbGwgcmV0dXJuIGFuIGVtcHR5IHN0cmluZ1xyXG5leHBvcnQgY29uc3QgbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQgPSBuZXcgTWFwPEhUTUxFbGVtZW50LCBNYXA8c3RyaW5nLCBzdHJpbmc+PigpO1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdEF0dHJpYnV0ZUZvclRhcmdldCggdGFyZ2V0OiBIVE1MRWxlbWVudCwgYXR0cmlidXRlTmFtZTogc3RyaW5nICk6IHN0cmluZyB7XHJcbiAgaWYgKCAhbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuaGFzKCB0YXJnZXQgKSApIHtcclxuICAgIG1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50LnNldCggdGFyZ2V0LCBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpICk7XHJcbiAgfVxyXG5cclxuICBsZXQgcmVzdWx0OiBzdHJpbmcgPSAnJztcclxuICBjb25zdCBkZWZhdWx0QXR0cmlidXRlVmFsdWVzQnlOYW1lID0gbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuZ2V0KCB0YXJnZXQgKSE7XHJcbiAgY29uc3QgdGFyZ2V0RGVmYXVsdEF0dHJpYnV0ZSA9ICFkZWZhdWx0QXR0cmlidXRlVmFsdWVzQnlOYW1lLmhhcyggYXR0cmlidXRlTmFtZSApID8gdGFyZ2V0LmdldEF0dHJpYnV0ZSggYXR0cmlidXRlTmFtZSApIDogZGVmYXVsdEF0dHJpYnV0ZVZhbHVlc0J5TmFtZS5nZXQoIGF0dHJpYnV0ZU5hbWUgKSE7XHJcblxyXG4gIHJlc3VsdCA9IHRhcmdldERlZmF1bHRBdHRyaWJ1dGUgPyB0YXJnZXREZWZhdWx0QXR0cmlidXRlIDogJyc7XHJcbiAgc2V0RGVmYXVsdEF0dHJpYnV0ZUZvclRhcmdldCggdGFyZ2V0LCBhdHRyaWJ1dGVOYW1lLCByZXN1bHQgKTtcclxuXHJcbiAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNldERlZmF1bHRBdHRyaWJ1dGVGb3JUYXJnZXQoIHRhcmdldDogSFRNTEVsZW1lbnQsIGF0dHJpYnV0ZU5hbWU6IHN0cmluZywgbmV3RGVmYXVsdEF0dHJpYnV0ZTogc3RyaW5nICk6IHZvaWQge1xyXG4gIGlmICggIW1hcERlZmF1bHRBdHRyaWJ1dGVzQnlFbGVtZW50LmhhcyggdGFyZ2V0ICkgKSB7XHJcbiAgICBtYXBEZWZhdWx0QXR0cmlidXRlc0J5RWxlbWVudC5zZXQoIHRhcmdldCwgbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKSApO1xyXG4gIH1cclxuXHJcbiAgbWFwRGVmYXVsdEF0dHJpYnV0ZXNCeUVsZW1lbnQuZ2V0KCB0YXJnZXQgKSEuc2V0KCBhdHRyaWJ1dGVOYW1lLCBuZXdEZWZhdWx0QXR0cmlidXRlICk7XHJcbn1cclxuXHJcbi8vLyBEaXZpZGUgbyBlbGVtZW50byBAdGFyZ2V0IGVtIDkgXCJxdWFkcmFkb3NcIiBpZ3VhaXMgZSByZXRvcm5hIGVtIHF1YWlzIHF1YWRyYWRvcyBvIGRyYWdnYWJsZSBlc3TDoSBjb2xpZGluZG8gY29tIG8gdGFyZ2V0XHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDb2xsaXNpb25EaXJlY3Rpb24oIGRyYWdnYWJsZTogSFRNTEVsZW1lbnQsIHRhcmdldDogSFRNTEVsZW1lbnQsIGNoZWNrQm9keVJvdGF0aW9uOiBib29sZWFuID0gZmFsc2UgKTogQ29sbGlzaW9uRGlyZWN0aW9uQ2hlY2sge1xyXG4gIGNvbnN0IHJlY3QxID0gIWNoZWNrQm9keVJvdGF0aW9uID8gZHJhZ2dhYmxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpIDogZ2V0Um90YXRlZEJvdW5kaW5nQm94QmFzZWRPbkJvZHlSb3RhdGlvbiggZHJhZ2dhYmxlICk7XHJcbiAgY29uc3QgcmVjdDIgPSAhY2hlY2tCb2R5Um90YXRpb24gPyB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiBnZXRSb3RhdGVkQm91bmRpbmdCb3hCYXNlZE9uQm9keVJvdGF0aW9uKCB0YXJnZXQgKTtcclxuXHJcbiAgY29uc3QgaXNUb3AgPSByZWN0MS5ib3R0b20gPiByZWN0Mi50b3AgJiYgcmVjdDEudG9wIDwgcmVjdDIudG9wICsgcmVjdDIuaGVpZ2h0IC8gMztcclxuICBjb25zdCBpc1JpZ2h0ID0gcmVjdDEubGVmdCA8IHJlY3QyLnJpZ2h0ICYmIHJlY3QxLnJpZ2h0ID4gcmVjdDIucmlnaHQgLSByZWN0Mi53aWR0aCAvIDM7XHJcbiAgY29uc3QgaXNDZW50ZXIgPSByZWN0MS50b3AgPCByZWN0Mi5ib3R0b20gJiYgcmVjdDEuYm90dG9tID4gcmVjdDIudG9wICYmIHJlY3QxLmxlZnQgPCByZWN0Mi5yaWdodCAmJiByZWN0MS5yaWdodCA+IHJlY3QyLmxlZnQ7XHJcbiAgY29uc3QgaXNCb3R0b20gPSByZWN0MS50b3AgPCByZWN0Mi5ib3R0b20gLSByZWN0Mi5oZWlnaHQgLyAzICYmIHJlY3QxLmJvdHRvbSA+IHJlY3QyLmJvdHRvbSAtIHJlY3QyLmhlaWdodCAvIDM7XHJcbiAgY29uc3QgaXNMZWZ0ID0gcmVjdDEucmlnaHQgPiByZWN0Mi5sZWZ0ICYmIHJlY3QxLmxlZnQgPCByZWN0Mi5sZWZ0ICsgcmVjdDIud2lkdGggLyAzO1xyXG5cclxuICByZXR1cm4geyB0b3A6IGlzVG9wLCByaWdodDogaXNSaWdodCwgY2VudGVyOiBpc0NlbnRlciwgYm90dG9tOiBpc0JvdHRvbSwgbGVmdDogaXNMZWZ0IH07XHJcbn1cclxuXHJcbi8vLyByZXR1cm4gdGhlIGRpc3RhbmNlIGZyb20gdGhlIGNlbnRlciBvZiB0aGUgZHJhZ2dhYmxlIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHRhcmdldCBlbGVtZW50IGZyb20gZWFjaCBib3JkZXIgXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXREaXN0YW5jZUZyb21Cb3JkZXIoIGRyYWdnYWJsZTogSFRNTEVsZW1lbnQsIHRhcmdldDogSFRNTEVsZW1lbnQsIGNoZWNrQm9keVJvdGF0aW9uOiBib29sZWFuID0gZmFsc2UgKTogQm9yZGVyRGlzdGFuY2Uge1xyXG4gIGNvbnN0IHJlY3QxID0gIWNoZWNrQm9keVJvdGF0aW9uID8gZHJhZ2dhYmxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpIDogZ2V0Um90YXRlZEJvdW5kaW5nQm94QmFzZWRPbkJvZHlSb3RhdGlvbiggZHJhZ2dhYmxlICk7XHJcbiAgY29uc3QgcmVjdDIgPSAhY2hlY2tCb2R5Um90YXRpb24gPyB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiBnZXRSb3RhdGVkQm91bmRpbmdCb3hCYXNlZE9uQm9keVJvdGF0aW9uKCB0YXJnZXQgKTtcclxuXHJcbiAgY29uc3QgY2VudGVyID0ge1xyXG4gICAgeDogcmVjdDEubGVmdCArIHJlY3QxLndpZHRoIC8gMixcclxuICAgIHk6IHJlY3QxLnRvcCArIHJlY3QxLmhlaWdodCAvIDIsXHJcbiAgfTtcclxuXHJcbiAgY29uc3QgZGlzdGFuY2VGcm9tQm9yZGVyOiBCb3JkZXJEaXN0YW5jZSA9IHtcclxuICAgIHRvcDogY2VudGVyLnkgLSByZWN0Mi50b3AsXHJcbiAgICByaWdodDogcmVjdDIucmlnaHQgLSBjZW50ZXIueCxcclxuICAgIGJvdHRvbTogcmVjdDIuYm90dG9tIC0gY2VudGVyLnksXHJcbiAgICBsZWZ0OiBjZW50ZXIueCAtIHJlY3QyLmxlZnQsXHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIGRpc3RhbmNlRnJvbUJvcmRlcjtcclxufVxyXG5cclxuZnVuY3Rpb24gcnVuT25seU9uY2VLZXlkb3duQWN0aW9ucyggZXZ0OiBLZXlib2FyZEV2ZW50ICkge1xyXG4gIGZvciAoIGNvbnN0IHBhaXIgb2YgZGljdEtleXNCeUFjdGlvbktleWRvd25PbmNlICkge1xyXG4gICAgaWYgKCBldnQuY29kZSA9PT0gcGFpclswXSApIHtcclxuICAgICAgcGFpclsxXS5mb3JFYWNoKCBrYkV2ZW50ID0+IGtiRXZlbnQoIGV2dCApICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBydW5LZXlkb3duQWN0aW9uc1JlcGVhdCggZXZ0OiBLZXlib2FyZEV2ZW50ICkge1xyXG4gIGZvciAoIGNvbnN0IHBhaXIgb2YgZGljdEtleXNCeUFjdGlvbktleWRvd25SZXBlYXQgKSB7XHJcbiAgICBpZiAoIGV2dC5jb2RlID09PSBwYWlyWzBdICkge1xyXG4gICAgICBwYWlyWzFdLmZvckVhY2goIGtiRXZlbnQgPT4ga2JFdmVudCggZXZ0ICkgKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCAna2V5ZG93bicsIGV2dCA9PiB7XHJcbiAgaWYgKCAhZXZ0LnJlcGVhdCApIHtcclxuICAgIHJ1bk9ubHlPbmNlS2V5ZG93bkFjdGlvbnMoIGV2dCApO1xyXG4gIH1cclxuXHJcbiAgcnVuS2V5ZG93bkFjdGlvbnNSZXBlYXQoIGV2dCApO1xyXG59ICk7XHJcblxyXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciggJ2tleXVwJywgZXZ0ID0+IHtcclxuICBmb3IgKCBjb25zdCBwYWlyIG9mIGRpY3RLZXlzQnlBY3Rpb25LZXl1cCApIHtcclxuICAgIGlmICggZXZ0LmNvZGUgPT09IHBhaXJbMF0gKSB7XHJcbiAgICAgIHBhaXJbMV0uZm9yRWFjaCgga2JFdmVudCA9PiBrYkV2ZW50KCBldnQgKSApO1xyXG4gICAgfVxyXG4gIH1cclxufSApO1xyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50Um90YXRpb25JbkRlZ3JlZXMoIGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBheGlzOiAneCcgfCAneScgfCAneicgPSAneCcgKTogbnVtYmVyIHtcclxuICBsZXQgcmVnZXhNYXRjaFJvdGF0ZVZhbHVlOiBSZWdFeHA7XHJcbiAgc3dpdGNoICggYXhpcyApIHtcclxuICAgIGNhc2UgJ3gnOlxyXG4gICAgICByZWdleE1hdGNoUm90YXRlVmFsdWUgPSByZWdleEdyb3VwUm90YXRlWFZhbHVlO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ3knOlxyXG4gICAgICByZWdleE1hdGNoUm90YXRlVmFsdWUgPSByZWdleEdyb3VwUm90YXRlWVZhbHVlO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ3onOlxyXG4gICAgICByZWdleE1hdGNoUm90YXRlVmFsdWUgPSByZWdleEdyb3VwUm90YXRlWlZhbHVlO1xyXG4gICAgICBicmVhaztcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJlZ2V4TWF0Y2hSb3RhdGVWYWx1ZSA9IHJlZ2V4R3JvdXBSb3RhdGVWYWx1ZTtcclxuICAgICAgYnJlYWs7XHJcbiAgfVxyXG5cclxuICBjb25zdCBtYXRjaCA9IHJlZ2V4TWF0Y2hSb3RhdGVWYWx1ZS5leGVjKCBlbGVtZW50LnN0eWxlLnRyYW5zZm9ybSApO1xyXG4gIGlmICggbWF0Y2ggKSB7XHJcbiAgICBjb25zdCByb3RhdGlvblZhbHVlID0gcGFyc2VGbG9hdCggbWF0Y2hbMV0gKTtcclxuICAgIHJldHVybiByb3RhdGlvblZhbHVlO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gMDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRCb2R5Um90YXRpb25JbkRlZ3JlZXMoKTogbnVtYmVyIHtcclxuICBjb25zdCBtYXRjaCA9IGdldFJlZ2V4UmVtb3ZlUm90YXRpb25Gcm9tQm9keSgpLmV4ZWMoIGRvY3VtZW50LmJvZHkuc3R5bGUudHJhbnNmb3JtICk7XHJcbiAgaWYgKCBtYXRjaCApIHtcclxuICAgIGNvbnN0IHJvdGF0aW9uVmFsdWUgPSBwYXJzZUZsb2F0KCBtYXRjaFsxXSApO1xyXG4gICAgcmV0dXJuIHJvdGF0aW9uVmFsdWU7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiAwO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJlZ2V4UmVtb3ZlUm90YXRpb25Gcm9tQm9keSgpIHtcclxuICByZXR1cm4gZ2V0UmVnZXhSZW1vdmVSb3RhdGlvbkJhc2VkT25BeGlzKCBnZXRCb2R5Um90YXRpb25BeGlzKCkgKVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVnZXhSZW1vdmVSb3RhdGlvbkJhc2VkT25BeGlzKCBheGlzOiAneCcgfCAneScgfCAneicgKSB7XHJcbiAgc3dpdGNoICggYXhpcyApIHtcclxuICAgIGNhc2UgJ3gnOlxyXG4gICAgICByZXR1cm4gcmVnZXhHcm91cFJvdGF0ZVhWYWx1ZTtcclxuICAgIGNhc2UgJ3knOlxyXG4gICAgICByZXR1cm4gcmVnZXhHcm91cFJvdGF0ZVlWYWx1ZTtcclxuICAgIGNhc2UgJ3onOlxyXG4gICAgICByZXR1cm4gcmVnZXhHcm91cFJvdGF0ZVpWYWx1ZTtcclxuICAgIGRlZmF1bHQ6XHJcbiAgICAgIHJldHVybiByZWdleEdyb3VwUm90YXRlVmFsdWU7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Qm9keVJvdGF0aW9uQXhpcygpOiAneCcgfCAneScgfCAneicge1xyXG4gIHJldHVybiBnZXRFbGVtZW50Um90YXRpb25BeGlzKCBkb2N1bWVudC5ib2R5ICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50Um90YXRpb25BeGlzKCBlbGVtZW50OiBIVE1MRWxlbWVudCApOiAneCcgfCAneScgfCAneicge1xyXG4gIGNvbnN0IGVsZW1lbnRUcmFuc2Zvcm0gPSBlbGVtZW50LnN0eWxlLnRyYW5zZm9ybS50b0xvd2VyQ2FzZSgpO1xyXG4gIGlmICggZWxlbWVudFRyYW5zZm9ybS5pbmNsdWRlcyggJ3gnICkgKSB7XHJcbiAgICByZXR1cm4gJ3gnO1xyXG4gIH0gZWxzZSBpZiAoIGVsZW1lbnRUcmFuc2Zvcm0uaW5jbHVkZXMoICd5JyApICkge1xyXG4gICAgcmV0dXJuICd5JztcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuICd6JztcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRUcmFuc2Zvcm1Db29yZHNGcm9tRWxlbWVudCggZWxlbWVudDogSFRNTEVsZW1lbnQsIGNoZWNrQm9keVJvdGF0aW9uOiBib29sZWFuID0gZmFsc2UgKTogUG9pbnQyRCB7XHJcbiAgY29uc3QgYXJyQ29tcHV0ZWREcmFnZ2FibGVUcmFuc2xhdGUgPSAoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtZW50ICkudHJhbnNmb3JtLm1hdGNoKCByZWdleE51bWJlclBhdHRlcm4gKSA/PyBbMCwgMF0gKS5tYXAoIG4gPT4gK24gKTtcclxuXHJcbiAgbGV0IHJlc3VsdCA9IHtcclxuICAgIHg6IGFyckNvbXB1dGVkRHJhZ2dhYmxlVHJhbnNsYXRlWzRdICE9PSB1bmRlZmluZWQgPyBNYXRoLnJvdW5kKCBhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZVs0XSApIDogMCxcclxuICAgIHk6IGFyckNvbXB1dGVkRHJhZ2dhYmxlVHJhbnNsYXRlWzVdICE9PSB1bmRlZmluZWQgPyBNYXRoLnJvdW5kKCBhcnJDb21wdXRlZERyYWdnYWJsZVRyYW5zbGF0ZVs1XSApIDogMFxyXG4gIH1cclxuXHJcbiAgaWYgKCBjaGVja0JvZHlSb3RhdGlvbiApIHtcclxuICAgIGNvbnN0IGJvZHlBbmdsZSA9IGdldEVsZW1lbnRSb3RhdGlvbkluRGVncmVlcyggZG9jdW1lbnQuYm9keSwgZ2V0RWxlbWVudFJvdGF0aW9uQXhpcyggZWxlbWVudCApICkgfHwgMDtcclxuICAgIHJldHVybiByb3RhdGVDb29yZGluYXRlcyggcmVzdWx0LngsIHJlc3VsdC55LCBib2R5QW5nbGUgKTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGlja0V2ZW50VG9Db29yZGluYXRlcyggZXZlbnQ6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50ICkge1xyXG4gIGlmICggZXZlbnQgaW5zdGFuY2VvZiBNb3VzZUV2ZW50ICkge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogZXZlbnQuY2xpZW50WCxcclxuICAgICAgeTogZXZlbnQuY2xpZW50WVxyXG4gICAgfTtcclxuICB9IGVsc2UgaWYgKCBldmVudCBpbnN0YW5jZW9mIFRvdWNoRXZlbnQgKSB7XHJcbiAgICBjb25zdCB0b3VjaCA9IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgeDogdG91Y2guY2xpZW50WCxcclxuICAgICAgeTogdG91Y2guY2xpZW50WVxyXG4gICAgfTtcclxuICB9IGVsc2Uge1xyXG4gICAgdGhyb3cgXCJFdmVudCBub3QgRm91bmRcIjtcclxuICB9XHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlSW52aXNpYmxlRGl2QWJvdmVQYXJlbnQoIHsgcGFyZW50RWxlbWVudCwgaWQsIHBvc2l0aW9uLCBkaW1lbnNpb25zIH06IHsgcGFyZW50RWxlbWVudDogSFRNTEVsZW1lbnQ7IGlkOiBzdHJpbmc7IHBvc2l0aW9uPzogeyB0b3A6IG51bWJlcjsgbGVmdDogbnVtYmVyOyB9OyBkaW1lbnNpb25zPzogRGltZW5zaW9uczsgfSApIHtcclxuICB2YXIgaW52aXNpYmxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicgKTtcclxuXHJcbiAgaWYgKCAhcGFyZW50RWxlbWVudC5zdHlsZS5wb3NpdGlvbiApIHtcclxuICAgIHBhcmVudEVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xyXG4gIH1cclxuXHJcbiAgaW52aXNpYmxlRGl2LmlkID0gaWQ7XHJcbiAgaW52aXNpYmxlRGl2LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcclxuICBpbnZpc2libGVEaXYuc3R5bGUud2lkdGggPSBkaW1lbnNpb25zICYmIGRpbWVuc2lvbnMud2lkdGggPyBkaW1lbnNpb25zLndpZHRoLnRvU3RyaW5nKCkgKyAncHgnIDogJzEwMCUnO1xyXG4gIGludmlzaWJsZURpdi5zdHlsZS5oZWlnaHQgPSBkaW1lbnNpb25zICYmIGRpbWVuc2lvbnMuaGVpZ2h0ID8gZGltZW5zaW9ucy5oZWlnaHQudG9TdHJpbmcoKSArICdweCcgOiAnMTAwJSc7XHJcbiAgaW52aXNpYmxlRGl2LnN0eWxlLnRvcCA9ICggcG9zaXRpb24/LnRvcC50b1N0cmluZygpID8/ICcwJyApICsgJ3B4JztcclxuICBpbnZpc2libGVEaXYuc3R5bGUubGVmdCA9ICggcG9zaXRpb24/LmxlZnQudG9TdHJpbmcoKSA/PyAnMCcgKSArICdweCc7XHJcbiAgaW52aXNpYmxlRGl2LnN0eWxlLm9wYWNpdHkgPSAnMCc7IC8vIE1ha2UgdGhlIGRpdiBpbnZpc2libGVcclxuICBpbnZpc2libGVEaXYuc3R5bGUucG9pbnRlckV2ZW50cyA9ICdhdXRvJzsgLy8gQWxsb3cgdGhlIGRpdiB0byBpbnRlcmNlcHQgbW91c2UgZXZlbnRzXHJcblxyXG4gIHBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoIGludmlzaWJsZURpdiApO1xyXG5cclxuICByZXR1cm4gaW52aXNpYmxlRGl2O1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaGlkZUVsZW1lbnQoIGVsZW1lbnQ6IEhUTUxFbGVtZW50ICkge1xyXG4gIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgZWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgZWxlbWVudC5zdHlsZS56SW5kZXggPSAnLTEnO1xyXG4gIGVsZW1lbnQuc3R5bGUub3BhY2l0eSA9ICcwJztcclxuICBlbGVtZW50LnN0eWxlLndpZHRoID0gJzBweCAhaW1wb3J0YW50JztcclxuICBlbGVtZW50LnN0eWxlLmhlaWdodCA9ICcwcHggIWltcG9ydGFudCc7XHJcbiAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoICdoaWRkZW4nLCAnJyApO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2xlZXBBc3luYyggbXM6IG51bWJlciApIHtcclxuICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2U8dm9pZD4oICggcmVzb2x2ZSApID0+IHNldFRpbWVvdXQoICgpID0+IHJlc29sdmUoKSwgbXMgKSApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYmluZEVsZW1lbnRzQnlDaGVjayggdHJpZ2dlckVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQsIHRhcmdldEVsZW1lbnQ6IEhUTUxFbGVtZW50LCBvbkNoZWNrOiBGdW5jdGlvbiwgb25VbmNoZWNrOiBGdW5jdGlvbiApIHtcclxuICBpZiAoIHRyaWdnZXJFbGVtZW50LmNoZWNrZWQgKSB7XHJcbiAgICBvbkNoZWNrKCB0YXJnZXRFbGVtZW50ICk7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0cmlnZ2VyR3JvdXAgPSB0cmlnZ2VyRWxlbWVudC5uYW1lXHJcbiAgICA/IEFycmF5LmZyb20oIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIGBbbmFtZT1cIiR7IHRyaWdnZXJFbGVtZW50Lm5hbWUgfVwiXWAgKSApXHJcbiAgICA6IFt0cmlnZ2VyRWxlbWVudF07XHJcblxyXG4gIHRyaWdnZXJHcm91cC5mb3JFYWNoKCB0ID0+IHQuYWRkRXZlbnRMaXN0ZW5lciggJ2NoYW5nZScsIGV2dCA9PiB7XHJcbiAgICBpZiAoIHRyaWdnZXJFbGVtZW50LmNoZWNrZWQgKSB7XHJcbiAgICAgIG9uQ2hlY2soIHRhcmdldEVsZW1lbnQsIGV2dCApO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgb25VbmNoZWNrKCB0YXJnZXRFbGVtZW50LCBldnQgKTtcclxuICAgIH1cclxuICB9ICkgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNldElucHV0Rm9yY2VQaG9uZU51bWJlckZvcm1hdCggaW5wdXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50ICkge1xyXG4gIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCAnaW5wdXQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICBsZXQgcGhvbmVJbnB1dCA9IHRoaXMudmFsdWU7XHJcblxyXG4gICAgY29uc3QgY2xlYW5QaG9uZUlucHV0ID0gcGhvbmVJbnB1dC5yZXBsYWNlKCAvXFxEL2csICcnICk7XHJcbiAgICBpZiAoIGNsZWFuUGhvbmVJbnB1dC5sZW5ndGggPiAxMSApIHtcclxuICAgICAgcGhvbmVJbnB1dCA9IGNsZWFuUGhvbmVJbnB1dC5zbGljZSggMCwgMTEgKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgcGhvbmVOdW1iZXJGb3JtYXR0ZWQgPSB0b1Bob25lTnVtYmVyKCBwaG9uZUlucHV0ICk7XHJcblxyXG4gICAgaWYgKCBwaG9uZU51bWJlckZvcm1hdHRlZC5sZW5ndGggPT09IDEwICkge1xyXG4gICAgICBwaG9uZU51bWJlckZvcm1hdHRlZCA9IHBob25lTnVtYmVyRm9ybWF0dGVkLnJlcGxhY2VBbGwoICctJywgJycgKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnZhbHVlID0gcGhvbmVOdW1iZXJGb3JtYXR0ZWQ7XHJcbiAgfSApO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGlzTW9iaWxlQnJvd3NlcigpIHtcclxuICByZXR1cm4gL0FuZHJvaWR8aVBob25lL2kudGVzdCggbmF2aWdhdG9yLnVzZXJBZ2VudCApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VXNlckRldmljZVR5cGUoKTogJ2FuZHJvaWQnIHwgJ2FwcGxlJyB8ICdkZXNrdG9wJyB7XHJcbiAgdmFyIHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQgfHwgbmF2aWdhdG9yLnZlbmRvciB8fCAoIHdpbmRvdyBhcyBhbnkgKS5vcGVyYTtcclxuXHJcbiAgaWYgKCAvYW5kcm9pZC9pLnRlc3QoIHVzZXJBZ2VudCApICkge1xyXG4gICAgcmV0dXJuICdhbmRyb2lkJztcclxuICB9IGVsc2UgaWYgKCAvaVBhZHxpUGhvbmV8aVBvZC8udGVzdCggdXNlckFnZW50ICkgJiYgISggd2luZG93IGFzIGFueSApLk1TU3RyZWFtICkge1xyXG4gICAgcmV0dXJuICdhcHBsZSc7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiAnZGVza3RvcCc7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNPblNjcmVlbiggZWxlbWVudDogSFRNTEVsZW1lbnQgKSB7XHJcbiAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgcmV0dXJuIChcclxuICAgIHJlY3QudG9wID49IDAgJiZcclxuICAgIHJlY3QubGVmdCA+PSAwICYmXHJcbiAgICByZWN0LmJvdHRvbSA8PSAoIHdpbmRvdy5pbm5lckhlaWdodCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0ICkgJiZcclxuICAgIHJlY3QucmlnaHQgPD0gKCB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggKVxyXG4gICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBiaW5kRWxlbWVudFZpZXdJZkNoZWNrZWQoIHRyaWdnZXJFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50LCB0YXJnZXRFbGVtZW50OiBIVE1MSW5wdXRFbGVtZW50LCBvcHRpb25zID0ge1xyXG4gIG9uQ2hlY2s6ICggdHJpZ2dlckVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQsIHRhcmdldEVsZW1lbnQ6IEhUTUxFbGVtZW50ICkgPT4geyB9LFxyXG4gIG9uVW5jaGVjazogKCB0cmlnZ2VyRWxlbWVudDogSFRNTElucHV0RWxlbWVudCwgdGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQgKSA9PiB7IH1cclxufSApIHtcclxuICBiaW5kRWxlbWVudHNCeUNoZWNrKFxyXG4gICAgdHJpZ2dlckVsZW1lbnQsXHJcbiAgICB0YXJnZXRFbGVtZW50LFxyXG4gICAgKCBlbDogSFRNTEVsZW1lbnQgKSA9PiB7XHJcbiAgICAgIGVsLmNsYXNzTGlzdC5hZGQoICdzaG93JyApO1xyXG4gICAgICBvcHRpb25zLm9uQ2hlY2soIHRyaWdnZXJFbGVtZW50LCB0YXJnZXRFbGVtZW50ICk7XHJcbiAgICB9LFxyXG4gICAgKCBlbDogSFRNTEVsZW1lbnQgKSA9PiB7XHJcbiAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoICdzaG93JyApO1xyXG4gICAgICBvcHRpb25zLm9uVW5jaGVjayggdHJpZ2dlckVsZW1lbnQsIHRhcmdldEVsZW1lbnQgKTtcclxuICAgIH0sXHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFZhbHVlRnJvbVJhZGlvR3JvdXAoIGdyb3VwTmFtZTogc3RyaW5nICk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgY29uc3QgZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCBgW25hbWU9JHsgZ3JvdXBOYW1lIH1dOmNoZWNrZWRgICkgYXMgSFRNTElucHV0RWxlbWVudDtcclxuICBpZiAoIGVsICkge1xyXG4gICAgcmV0dXJuIGVsLnZhbHVlO1xyXG4gIH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzbW9vdGhTY3JvbGwoIHRhcmdldFk6IG51bWJlciwgZHVyYXRpb246IG51bWJlciApOiB2b2lkIHtcclxuICBjb25zdCBzdGFydFkgPSB3aW5kb3cuc2Nyb2xsWSB8fCB3aW5kb3cucGFnZVlPZmZzZXQ7XHJcbiAgbGV0IHN0YXJ0VGltZTogbnVtYmVyIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gIGZ1bmN0aW9uIHN0ZXAoIGN1cnJlbnRUaW1lOiBudW1iZXIgKSB7XHJcbiAgICBpZiAoICFzdGFydFRpbWUgKSBzdGFydFRpbWUgPSBjdXJyZW50VGltZTtcclxuICAgIGNvbnN0IGVsYXBzZWRUaW1lID0gY3VycmVudFRpbWUgLSBzdGFydFRpbWU7XHJcbiAgICBjb25zdCBwcm9ncmVzcyA9IE1hdGgubWluKCBlbGFwc2VkVGltZSAvIGR1cmF0aW9uLCAxICk7XHJcbiAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gbGVycCggMCwgMSwgcHJvZ3Jlc3MgKTtcclxuICAgIHdpbmRvdy5zY3JvbGxUbyggMCwgbGVycCggc3RhcnRZLCB0YXJnZXRZLCBlYXNlZFByb2dyZXNzICkgKTtcclxuICAgIGlmICggZWxhcHNlZFRpbWUgPCBkdXJhdGlvbiApIHtcclxuICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBzdGVwICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIHN0ZXAgKTtcclxufVxyXG5cclxuLy8gUmV0b3JuYSB1bWEgZnVuw6fDo28gcXVlIG7Do28gdmFpIHNlciBjb21wbGV0YWRhIGNhc28gc2VqYSBjaGFtYWRhIG5vdmFtZW50ZSBlbSB7IGRlbGF5IH0gbWlsaXNzZWd1bmRvc1xyXG5leHBvcnQgZnVuY3Rpb24gZGVib3VuY2VGYWN0b3J5KCBmdW5jOiBGdW5jdGlvbiwgZGVsYXk6IG51bWJlciApOiBGdW5jdGlvbiB7XHJcbiAgbGV0IGluRGVib3VuY2U6IG51bWJlcjtcclxuICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgY29udGV4dCA9IHdpbmRvdztcclxuICAgIGNvbnN0IGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICBjbGVhclRpbWVvdXQoIGluRGVib3VuY2UgKTtcclxuICAgIGluRGVib3VuY2UgPSB3aW5kb3cuc2V0VGltZW91dCggKCkgPT4gZnVuYy5hcHBseSggY29udGV4dCwgYXJncyApLCBkZWxheSApO1xyXG4gIH07XHJcbn1cclxuXHJcbi8vIFJldG9ybmEgdW1hIGZ1bsOnw6NvIHF1ZSBzw7MgcG9kZSBzZXIgY29tcGxldGFkYSB1bWEgdmV6IGEgY2FkYSB7IGxpbWl0IH0gbWlsaXNzZWd1bmRvcyBcclxuZXhwb3J0IGZ1bmN0aW9uIHRocm90dGxlRmFjdG9yeSggZnVuYzogRnVuY3Rpb24sIGxpbWl0OiBudW1iZXIgKTogRnVuY3Rpb24ge1xyXG4gIGxldCBsYXN0RnVuYzogbnVtYmVyO1xyXG4gIGxldCBsYXN0UmFuOiBudW1iZXI7XHJcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcclxuICAgIGNvbnN0IGNvbnRleHQgPSB3aW5kb3c7XHJcbiAgICBjb25zdCBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgaWYgKCAhbGFzdFJhbiApIHtcclxuICAgICAgZnVuYy5hcHBseSggY29udGV4dCwgYXJncyApO1xyXG4gICAgICBsYXN0UmFuID0gRGF0ZS5ub3coKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNsZWFyVGltZW91dCggbGFzdEZ1bmMgKTtcclxuICAgICAgbGFzdEZ1bmMgPSB3aW5kb3cuc2V0VGltZW91dCggZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICggRGF0ZS5ub3coKSAtIGxhc3RSYW4gPj0gbGltaXQgKSB7XHJcbiAgICAgICAgICBmdW5jLmFwcGx5KCBjb250ZXh0LCBhcmdzICk7XHJcbiAgICAgICAgICBsYXN0UmFuID0gRGF0ZS5ub3coKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sIGxpbWl0IC0gKCBEYXRlLm5vdygpIC0gbGFzdFJhbiApICk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc21vb3RoU2Nyb2xsVG8oIHBvczogbnVtYmVyICk6IHZvaWQge1xyXG4gIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG8oIHtcclxuICAgIHRvcDogcG9zLFxyXG4gICAgYmVoYXZpb3I6ICdzbW9vdGgnLFxyXG4gIH0gKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNtb290aFNjcm9sbFRvRWxlbWVudCggZWxlbWVudDogSFRNTEVsZW1lbnQsIHVzZUJyb3dzZXJEZWZhdWx0czogYm9vbGVhbiA9IHRydWUgKTogdm9pZCB7XHJcbiAgaWYgKCAhdXNlQnJvd3NlckRlZmF1bHRzICkge1xyXG4gICAgY29uc3QgdGFyZ2V0WSA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgd2luZG93LnNjcm9sbFk7XHJcbiAgICBjb25zdCBkdXJhdGlvbiA9IDEwMDA7IC8vIER1cmHDp8OjbyBmaXhhIGVtIG1pbGlzc2VndW5kb3MgKDEgc2VndW5kbylcclxuICAgIHNtb290aFNjcm9sbCggdGFyZ2V0WSwgZHVyYXRpb24gKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGRvY3VtZW50LmJvZHkuc2Nyb2xsVG8oIHtcclxuICAgIHRvcDogZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS55LFxyXG4gICAgbGVmdDogZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS54LFxyXG4gICAgYmVoYXZpb3I6ICdzbW9vdGgnLFxyXG4gIH0gKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNlbGVjdE9wdGlvbkJ5VGV4dCggaWRTZWxlY3RFbGVtZW50OiBzdHJpbmcsIHNlYXJjaFRleHQ6IHN0cmluZywgY29udGFpbnM6IGJvb2xlYW4gPSBmYWxzZSApOiB2b2lkIHtcclxuICBjb25zdCBzZWxlY3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIGlkU2VsZWN0RWxlbWVudCApIGFzIEhUTUxTZWxlY3RFbGVtZW50O1xyXG5cclxuICBpZiAoICFzZWxlY3RFbGVtZW50ICkge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgb3B0aW9uc0VsZW1lbnRvU2VsZWN0ID0gWy4uLnNlbGVjdEVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCggJ29wdGlvbicgKV07XHJcblxyXG4gIGxldCBzZWxlY3RlZE9wdGlvbjtcclxuICBpZiAoIGNvbnRhaW5zICkge1xyXG4gICAgc2VsZWN0ZWRPcHRpb24gPSBvcHRpb25zRWxlbWVudG9TZWxlY3RcclxuICAgICAgLmZpbHRlciggZWwgPT4gZWwudGV4dENvbnRlbnQgJiYgZWwudGV4dENvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyggc2VhcmNoVGV4dC50b0xvd2VyQ2FzZSgpICkgKVswXS52YWx1ZTtcclxuICB9IGVsc2Uge1xyXG4gICAgc2VsZWN0ZWRPcHRpb24gPSBvcHRpb25zRWxlbWVudG9TZWxlY3RcclxuICAgICAgLmZpbHRlciggZWwgPT4gZWwudGV4dENvbnRlbnQgJiYgZWwudGV4dENvbnRlbnQudG9Mb3dlckNhc2UoKSA9PT0gc2VhcmNoVGV4dC50b0xvd2VyQ2FzZSgpIClbMF0udmFsdWU7XHJcbiAgfVxyXG5cclxuICBzZWxlY3RFbGVtZW50LnZhbHVlID0gc2VsZWN0ZWRPcHRpb247XHJcbn1cclxuXHJcbiIsIlxyXG4vLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTYyNDU3NjcvY3JlYXRpbmctYS1ibG9iLWZyb20tYS1iYXNlNjQtc3RyaW5nLWluLWphdmFzY3JpcHRcclxuLy8vIERpdmlkZSB1bSBhcnF1aXZvIGJpbsOhcmlvIGVtIHbDoXJpYXMgcGFydGVzLCBwYXJhIHF1ZSBhIGNvbnZlcnPDo28gc2VqYSBvdGltaXphZGEsIGUgcmV0b3JuYSB1bWEgYmxvYiBjb20gbyBhcnF1aXZvXHJcblxyXG5pbXBvcnQgeyBpc051bGxPckVtcHR5IH0gZnJvbSAnLi9TdHJpbmdUb29scyc7XHJcblxyXG4vLy8gQHBhcmFtIG9uUHJvZ3Jlc3NvIFVtIGNhbGxiYWNrIHF1ZSByZWNlYmUgYSBwb3JjZW50YWdlbSBkZSBwcm9ncmVzc28gYXR1YWwgZGEgY29udmVyc8Ojb1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYmFzZTY0VG9CbG9iKCB0ZXh0b0Jhc2U2NDogc3RyaW5nLCBjb250ZW50VHlwZTogc3RyaW5nLCB0YW1hbmhvUGFydGVzID0gMTAyNCwgb25Qcm9ncmVzcyA9ICggcHJvZ3Jlc3NvQXR1YWw6IG51bWJlciApID0+IHsgY29uc29sZS5sb2coIHByb2dyZXNzb0F0dWFsICkgfSApIHtcclxuICBjb25zdCBieXRlQXJyYXlzID0gbmV3IEFycmF5PFVpbnQ4QXJyYXk+KCk7XHJcbiAgY29uc3QgZmlsZVNpemUgPSB0ZXh0b0Jhc2U2NC5sZW5ndGg7XHJcblxyXG4gIC8vLyBwcmVlbmNoZSBgYnl0ZUFycmF5c2AgY29tIG9zIGJ5dGVzIGRvIGFycXVpdm8gcGVnYW5kbyB1bWEgcGFydGUgZGUgXCJ0YW1hbmhvUGFydGVzXCIgcG9yIHZlelxyXG4gIGZvciAoIGxldCBvZmZzZXQgPSAwOyBvZmZzZXQgPCBmaWxlU2l6ZTsgb2Zmc2V0ICs9IHRhbWFuaG9QYXJ0ZXMgKSB7XHJcbiAgICAvLy8gcGVnYW5kbyB1bSBwYXJ0ZSBkZSB0YW1hbmhvIHt0YW1hbmhvUGFydGVzfSBkbyBhcnF1aXZvXHJcbiAgICBjb25zdCBjaHVuayA9IHRleHRvQmFzZTY0LnNsaWNlKCBvZmZzZXQsIG9mZnNldCArIHRhbWFuaG9QYXJ0ZXMgKTtcclxuXHJcbiAgICAvLy8gY29udmVydGVuZG8gYSBwYXJ0ZSBlbSB1bSBhcnJheSBjb20gY2FkYSBieXRlIGRlc3NlIHBlZGHDp28gZG8gYXJxdWl2b1xyXG4gICAgY29uc3QgYXJyQnl0ZXNDaHVuayA9IG5ldyBBcnJheTxudW1iZXI+KCBjaHVuay5sZW5ndGggKTtcclxuICAgIGZvciAoIGxldCBpID0gMDsgaSA8IGNodW5rLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICBhcnJCeXRlc0NodW5rW2ldID0gY2h1bmsuY2hhckNvZGVBdCggaSApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vLyB0cmFuc2Zvcm1hbmRvIGVzc2UgYXJyYXkgZW0gdW0gYXJyYXkgY29tIGNhbXBvcyBkbyB0YW1hbmhvIGRlIHVtIGJ5dGVcclxuICAgIC8vLyBlIHVuaW5kbyBhcyBwYXJ0ZXMgasOhIGNvbmNsdcOtZGFzIGRvIGFycXVpdm9cclxuICAgIGJ5dGVBcnJheXMucHVzaCggbmV3IFVpbnQ4QXJyYXkoIGFyckJ5dGVzQ2h1bmsgKSApO1xyXG5cclxuICAgIC8vLyBDaGFtYW5kbyBjYWxsYmFjayBxdWUgZXhpYmUgbyBwcm9ncmVzc28gcXVhbmRvIG8gcGFzc28gYXR1YWwgZm9yIGNvbmNsdcOtZG9cclxuICAgIGF3YWl0IG9uUHJvZ3Jlc3MoICggb2Zmc2V0IC8gZmlsZVNpemUgKSAqIDEwMCApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG5ldyBCbG9iKCBieXRlQXJyYXlzLCB7IHR5cGU6IGNvbnRlbnRUeXBlIH0gKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRvd25sb2FkRmlsZUZyb21CbG9iKCBibG9iOiBCbG9iLCB0aXRsZTogc3RyaW5nICkge1xyXG4gIGxldCBmaWxlID0gVVJMLmNyZWF0ZU9iamVjdFVSTCggYmxvYiApO1xyXG5cclxuICBpZiAoIGZpbGUgKSB7XHJcbiAgICBsZXQgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdhJyApO1xyXG4gICAgYS5ocmVmID0gZmlsZTtcclxuICAgIGEuZG93bmxvYWQgPSB0aXRsZTtcclxuICAgIGEuY2xpY2soKTtcclxuICAgIGEucmVtb3ZlKCk7XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmlsZUV4dGVuc2lvbiggZmlsZU5hbWU6IHN0cmluZyApOiBzdHJpbmcge1xyXG4gIGlmICggaXNOdWxsT3JFbXB0eSggZmlsZU5hbWUgKSApIHJldHVybiAnJztcclxuXHJcbiAgY29uc3QgZGVmYXVsdEZpbGVTcmMgPSBmaWxlTmFtZS5zcGxpdCggJy4nICkucG9wKCk7XHJcbiAgaWYgKCBkZWZhdWx0RmlsZVNyYyAmJiBkZWZhdWx0RmlsZVNyYyAhPT0gZmlsZU5hbWUgKSB7XHJcbiAgICByZXR1cm4gZGVmYXVsdEZpbGVTcmM7XHJcbiAgfVxyXG5cclxuICBjb25zdCBmaWxlVHlwZVN0ciA9IGZpbGVOYW1lLnNwbGl0KCAnLycgKS5wb3AoKTtcclxuICBpZiAoIGZpbGVUeXBlU3RyICYmIGZpbGVUeXBlU3RyICE9PSBmaWxlTmFtZSApIHtcclxuICAgIHJldHVybiBmaWxlVHlwZVN0cjtcclxuICB9XHJcblxyXG4gIHJldHVybiAnJztcclxufSIsImV4cG9ydCBmdW5jdGlvbiByZW1vdmVBY2NlbnRzKCBzdHI6IHN0cmluZyApIHtcclxuICByZXR1cm4gc3RyLm5vcm1hbGl6ZSggJ05GRCcgKS5yZXBsYWNlKCAvW1xcdTAzMDAtXFx1MDM2Zl0vZywgXCJcIiApO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2FwaXRhbGl6ZUZpcnN0TGV0dGVyKCBzdHI6IHN0cmluZyApOiBzdHJpbmcge1xyXG4gIGlmICggdHlwZW9mIHN0ciAhPT0gJ3N0cmluZycgKSB7XHJcbiAgICByZXR1cm4gJyc7XHJcbiAgfVxyXG4gIHJldHVybiBzdHIuY2hhckF0KCAwICkudG9VcHBlckNhc2UoKSArIHN0ci5zdWJzdHJpbmcoIDEgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNlYXJjaFRlcm0oIHN0cmluZ0FycmF5OiBzdHJpbmdbXSwgc2VhcmNoVGVybTogc3RyaW5nICk6IHN0cmluZ1tdIHtcclxuICByZXR1cm4gc3RyaW5nQXJyYXlcclxuICAgIC5maWx0ZXIoICggdjogc3RyaW5nICkgPT4gdi50b0xvd2VyQ2FzZSgpLmluZGV4T2YoIHNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKSApID4gLTEgKVxyXG4gICAgLnNsaWNlKCAwLCAxMCApXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB6ZXJvQmVmb3JlKCBuOiBudW1iZXIgKSB7XHJcbiAgcmV0dXJuIG4udG9TdHJpbmcoKS5wYWRTdGFydCggMiwgJzAnICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc051bGxPckVtcHR5KCBzdHI6IHN0cmluZyApIHtcclxuICByZXR1cm4gdHlwZW9mIHN0ciAhPT0gJ3N0cmluZycgfHwgIXN0ciB8fCBzdHIgPT09ICcnXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0b1Bob25lTnVtYmVyKCBpbnB1dFRleHQ6IHN0cmluZyApIHtcclxuICBjb25zdCBjbGVhbk51bWJlciA9IGlucHV0VGV4dC5yZXBsYWNlKCAvXFxEL2csICcnICk7XHJcblxyXG4gIGxldCByZXN1bHQ7XHJcbiAgaWYgKCBjbGVhbk51bWJlci5sZW5ndGggPD0gMTAgKSB7XHJcbiAgICBjb25zdCByZWdleCA9IC9eKFxcZHsyfSkoXFxkezR9KShcXGR7MCw0fSkkLztcclxuICAgIHJlc3VsdCA9IGNsZWFuTnVtYmVyLnJlcGxhY2UoIHJlZ2V4LCAnKCQxKSAkMi0kMycgKTtcclxuICB9IGVsc2Uge1xyXG4gICAgY29uc3QgcmVnZXggPSAvXihcXGR7Mn0pKFxcZHs1fSkoXFxkezAsNH0pJC87XHJcbiAgICByZXN1bHQgPSBjbGVhbk51bWJlci5yZXBsYWNlKCByZWdleCwgJygkMSkgJDItJDMnICk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcmVzdWx0O1xyXG59IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSAobW9kdWxlKSA9PiB7XG5cdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuXHRcdCgpID0+IChtb2R1bGVbJ2RlZmF1bHQnXSkgOlxuXHRcdCgpID0+IChtb2R1bGUpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCB7IGE6IGdldHRlciB9KTtcblx0cmV0dXJuIGdldHRlcjtcbn07IiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MzUzKTtcbiJdLCJuYW1lcyI6WyJBdWRpb0NvbXBvbmVudCIsIk9iamVjdEV2ZW50TGlzdGVuZXIiLCJzcmMiLCJhdWRpb0VsZW1lbnQiLCJfY29udGFpbmVyIiwiX2Jsb2NrSW50ZXJhY3Rpb24iLCJfZGl2QmxvY2tJbnRlcmFjdGlvbiIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsInN1cGVyIiwidGhpcyIsImNvbnRhaW5lciIsImJsb2NrSW50ZXJhY3Rpb24iLCJhdWRpb0VsZW1lbnRJZCIsImlkIiwiY2xhc3NMaXN0IiwiYWRkIiwiZ2V0SW52aXNpYmxlRGl2QmxvY2tJbnRlcmFjdGlvbiIsInNldHVwSW52aXNpYmxlRGl2QmxvY2tJbnRlcmFjdGlvbiIsImRpdkJsb2NrSW50ZXJhY3Rpb24iLCJwYXVzZWQiLCJmaWxlTmFtZSIsInF1ZXJ5U2VsZWN0b3IiLCJjdXJyZW50VGltZSIsInQiLCJwbGF5V2l0aG91dFRyaWdnZXJFdmVudHMiLCJwbGF5UHJvbWlzZSIsInBsYXkiLCJ1bmRlZmluZWQiLCJ0aGVuIiwiXyIsImNhdGNoIiwic3RvcCIsInNldENsYXNzZXNQbGF5aW5nIiwicGF1c2VXaXRob3V0VHJpZ2dlckV2ZW50cyIsInBhdXNlIiwic2V0Q2xhc3Nlc1BhdXNlZCIsInJlbW92ZSIsImNhbGxFdmVudHNCeU5hbWUiLCJ0b2dnbGUiLCJtdXRlIiwidm9sdW1lIiwidW5tdXRlIiwic2VlayIsInNlZWtUaW1lIiwiX3JlbG9hZEJ1ZmZlciIsImRpbWVuc2lvbnMiLCJnZXRFbGVtZW50RGltZW5zaW9ucyIsImF1ZGlvQ29tcG9uZW50IiwiZWxlbWVudEludmlzaWJsZURpdiIsImNyZWF0ZUludmlzaWJsZURpdkFib3ZlUGFyZW50IiwicGFyZW50RWxlbWVudCIsInBvc2l0aW9uIiwidG9wIiwibGVmdCIsIndpZHRoIiwiaGVpZ2h0Iiwic3R5bGUiLCJkaXNwbGF5IiwiekluZGV4IiwiYWRkRXZlbnRMaXN0ZW5lciIsImNyZWF0ZUF1ZGlvQ29tcG9uZW50T25Cb2R5IiwiYXVkaW9Db21wb25lbnRDb250YWluZXIiLCJBdWRpb0NvbXBvbmVudEZhY3RvcnkiLCJidWlsZE9uQm9keSIsImNyZWF0ZUF1ZGlvQ29tcG9uZW50IiwiZG9jdW1lbnQiLCJib2R5IiwiYnVpbGQiLCJDb21wb25lbnRDb250YWluZXIiLCJwbGF5ZXJDb25maWciLCJjcmVhdGVJbnZpc2libGVQbGF5ZXIiLCJidWlsZFN1YkNvbXBvbmVudHMiLCJwYXJlbnQiLCJfZWxlbWVudCIsInRlbXBsYXRlRWxlbWVudCIsImNvbXBvbmVudE5hbWUiLCJzdWJDb21wb25lbnRDb3VudEJ5TmFtZSIsIk1hcCIsInN1YkNvbXBvbmVudHMiLCJ0ZW1wbGF0ZSIsImdldEVsZW1lbnRCeUlkIiwiRXJyb3IiLCJjcmVhdGVFbGVtZW50IiwiY29udGVudCIsImFwcGVuZENoaWxkIiwiZ2V0VGVtcGxhdGVDbG9uZU5vZGVzIiwiY2xvbmVOb2RlIiwiY2hpbGRyZW4iLCJidWlsZFNpbmdsZVN1YkNvbXBvbmVudCIsImNvbXBvbmVudCIsImhhcyIsInNldCIsImNvbXBvbmVudENvdW50IiwiZ2V0IiwiY2FwaXRhbGl6ZUZpcnN0TGV0dGVyIiwiZWxlbWVudElkIiwiaXRlbSIsImluc2VydEFkamFjZW50RWxlbWVudCIsIlN0cmluZyIsInByb3RvdHlwZSIsImlzTnVsbE9yRW1wdHkiLCJ0cnVuY2F0ZSIsIm1heCIsImRlY29yYXRvciIsImxlbmd0aCIsInN1YnN0cmluZyIsInRvU3RyaW5nIiwicmVtb3ZlQWNjZW50cyIsIm5vcm1hbGl6ZSIsInJlcGxhY2UiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInplcm9CZWZvcmUiLCJwYWRTdGFydCIsImV2ZW50c0J5TmFtZSIsImV2ZW50TmFtZSIsImV2ZW50IiwidG9Mb3dlckNhc2UiLCJwdXNoIiwiZ2V0RXZlbnRzQnlOYW1lIiwiZXZlbnRBcmdzIiwiZm9yRWFjaCIsImUiLCJhc3luYyIsImFyclNvdXJjZXMiLCJnZXRFbGVtZW50RnJvbUhUTUwiLCJhdWRpb0VsZW1lbnRIVE1MIiwiaGlkZUVsZW1lbnQiLCJhdXRvUGxheSIsImF1dG9wbGF5IiwibXV0ZWQiLCJsb29wIiwicHJlbG9hZCIsInRyaW1FbmQiLCJhdWRpb0VsZW1lbnRQYXJhbXNCeVBsYXllckNvbmZpZyIsIm1hcCIsInNvdXJjZUVsZW1lbnRIVE1MIiwicmVkdWNlIiwiYWNjIiwibmV4dCIsImdldEZpbGVFeHRlbnNpb24iLCJwbGF5QnV0dG9uQ1NTIiwiZGljdEtleXNCeUFjdGlvbktleWRvd25PbmNlIiwiZGljdEtleXNCeUFjdGlvbktleWRvd25SZXBlYXQiLCJkaWN0S2V5c0J5QWN0aW9uS2V5dXAiLCJodG1sIiwidHJpbSIsImlubmVySFRNTCIsInJlc3VsdCIsIkFycmF5IiwiZnJvbSIsImVsZW1lbnQiLCJyZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiaW52aXNpYmxlRGl2Iiwib3BhY2l0eSIsInBvaW50ZXJFdmVudHMiLCJzZXRBdHRyaWJ1dGUiLCJ3aW5kb3ciLCJldnQiLCJyZXBlYXQiLCJwYWlyIiwiY29kZSIsImtiRXZlbnQiLCJydW5Pbmx5T25jZUtleWRvd25BY3Rpb25zIiwicnVuS2V5ZG93bkFjdGlvbnNSZXBlYXQiLCJkZWZhdWx0RmlsZVNyYyIsInNwbGl0IiwicG9wIiwiZmlsZVR5cGVTdHIiLCJzdHIiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsIm4iLCJnZXR0ZXIiLCJfX2VzTW9kdWxlIiwiZCIsImEiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsIm9iaiIsInByb3AiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJ2YWx1ZSIsIl9fd2VicGFja19leHBvcnRzX18iXSwic291cmNlUm9vdCI6IiJ9